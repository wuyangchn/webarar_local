const FILLED_POINTS_COLOR="#337ab7",rich_format={sub:{verticalAlign:"bottom",fontSize:10,fontFamily:"Microsoft Sans Serif",fontWeight:"bold"},sup:{verticalAlign:"top",fontSize:10,fontFamily:"Microsoft Sans Serif",fontWeight:"bold"}};function myParse(e){return"string"==typeof e||e instanceof String?(e=e.replace(/\bNaN\b/g,'"*isNaN*"').replace(/-\bInfinity\b/g,'"*isNegativeInfinity*"').replace(/\bInfinity\b/g,'"*isInfinity*"'),JSON.parse(e,function(e,t){return"*isNaN*"===t?NaN:"*isInfinity*"===t?1/0:"*isNegativeInfinity*"===t?-1/0:t})):e}function closePopupMessage(e=!0){var t=document.getElementById("popupContainer"),a=document.getElementById("popupMessage"),i=document.getElementById("popupTitle"),n=document.getElementById("popupContinueButton"),o=document.getElementById("popupCancelButton");return t.style.display="none",i.textContent="",a.textContent="",n.style.display="none",o.style.display="none",e}function showPopupMessage(e,t,a=!0,i=void 0){var n=document.getElementById("popupContainer"),o=document.getElementById("popupTitle"),s=document.getElementById("popupMessage");let l=document.getElementById("popupContinueButton"),r=document.getElementById("popupCancelButton");return o.textContent=e,s.innerHTML=t,n.style.display="block",a?(n.onclick=()=>!1,l.style.display="inline-block",r.style.display="inline-block",l.focus()):(void 0===i?(i=1500,n.onclick=()=>{closePopupMessage(!1)}):n.onclick=()=>!1,delay(i).then(e=>{console.log(e),closePopupMessage(!0)}).catch(e=>{console.error("Error:",e),closePopupMessage(!1)})),new Promise(function(e,t){l.addEventListener("click",function(){closePopupMessage(!0),e(!0)}),r.addEventListener("click",function(){closePopupMessage(!1),e(!1)})})}function showErrorMessage(e,t,a){showPopupMessage("Error",`Status: ${t}<br>Message: `+e.responseJSON?.msg,!0)}const stringToBoolean=e=>{if("boolean"==typeof e)return e;switch(e?.toLowerCase().trim()){case"true":case"1":return!0;default:return!1}},delay=a=>new Promise((t,e)=>{setTimeout(e=>{t("Waited for some seconds.")},a)});class AjaxRequest{constructor(e,t,a){this.url=e,this.content=t,this.async=a,this.__response=this.send()}send(){let i;return $.ajax({url:this.url,type:"POST",data:JSON.stringify({content:this.content,cache_key:cache_key,user_uuid:localStorage.getItem("fingerprint")}),async:this.async,contentType:"application/json",success:function(e,t,a){i=e}}),i}get response(){return this.__response}get results(){return this.__response.res}get massage(){return this.__response.msg}get status(){return this.__response.status}}function addNametoBlankList(a){var e=document.createElement("li"),e=(e.className="list-group-item",e.innerText=a,e.onclick=function(){let e=$("#inputBlankSequences");var t;e.val().includes(a)?(t=a,e.val(e.val().replace(t+";",""))):(t=a,e.val(e.val()+t+";"))},document.getElementById("listGroupBlankName").appendChild(e),document.createElement("button"));e.type="button",e.className="list-group-item",e.innerText="...",e.onclick=function(e){$("#modal-blank-info-title").text(a);var t=getBlankInfo(a);$("#experiment-time").text(t[0].time),$("#table-blank-info").bootstrapTable("load",t),$("#modal-blank-info").modal("show")},document.getElementById("listGroupBlankBtn").appendChild(e)}function addNewBlankButtonClicked(){var e=$("#outputBlankSequences").val(),t=($("#outputBlankSequences").val(""),$("#inputBlankSequences").val(""),e.split(";")),i=myRawData.sequence.filter((e,t)=>e.is_blank).map((e,t)=>e.name);for(let e=0;e<t.length;e++){let a=t[e];var n,o=newSequencesList.filter((e,t)=>e.name===a)[0];o.is_blank?i.includes(a)?showPopupMessage("Information",`Blank with name ${a} exists.`,!1):(addNametoBlankList(a),(n=document.createElement("option")).value=a,n.innerText=a,myRawData.sequence.push(...newSequencesList.filter((e,t)=>e.name===a))):showPopupMessage("Information",`Sequence with name ${a} is a ${o.type_str} sequence, but a blank sequence required.`,!1)}$("#table-sequences").bootstrapTable("destroy"),initialTable(myRawData.sequence.filter((e,t)=>e.is_blank).map((e,t)=>e.name)),updateSequenceTable(),corrBlankMethodChanged(myRawData.sequence.filter((e,t)=>e.is_blank&&!e.is_estimated))}function rawFilesChanged(){let i=$("#raw_file_list");var e;""!==$("#file-input-1").val()&&(e=new FormData(document.getElementById("rawFileForm")),$.ajax({url:url_raw_files_changed,type:"POST",data:e,async:!0,processData:!1,contentType:!1,mimeType:"multipart/form-data",success:function(e){$("#file-input-1").val("");e=JSON.parse(e).files;let t=i.bootstrapTable("getData");$.each(e,function(e,a){i.bootstrapTable("insertRow",{index:t.length+e,row:{file_name:a.name,file_path:a.path,filter:`<select class="input-sm input-filter-selection" style="width: 200px" onchange="change_input_filter(this)">${a.filter_list.map((e,t)=>e.toUpperCase()===a.filter.toUpperCase()?"<option selected>"+e+"</option>":"<option>"+e+"</option>").join("")}$</select>`,operation:'<button type="button" class="btn btn-danger" onclick="removeRawFile(id)" id="btn-raw-file-'+t.length+'">Remove</button>'}})})}}))}function change_input_filter(t){var e=$("#raw_file_list"),a=e.bootstrapTable("getData"),i=t.parentElement.parentElement.getAttribute("data-index"),n=t.options;for(let e=0;e<n.length;e++)$(n[e]).attr("selected",e===t.selectedIndex);a[i].filter=t.outerHTML,e.bootstrapTable("updateRow",{index:i,row:a})}function removeRawFile(t){var e=$("#raw_file_list"),a=e.bootstrapTable("getData");a.splice(Number(t.slice(13)),1);for(let e=Number(t.slice(13));e<a.length;e++)a[e].operation='<button type="button" class="btn btn-danger" onclick="removeRawFile(id)" id="btn-raw-file-'+e+'">Remove</button>';e.bootstrapTable("load",a),$("#raw-file-table-input").val(JSON.stringify({files:e.bootstrapTable("getData")}))}function getEmptyBlank(){$.ajax({url:url_raw_empty_blank,type:"POST",data:JSON.stringify({cache_key:myRawCacheKey}),contentType:"application/json",dataType:"text",success:function(e){e=(e=myParse(e)).new_sequence;$("#outputBlankSequences").val(e.name),newSequencesList.push(e)}})}function importBlank(){var e;""!==$("#file-input-import-blank").val()&&($("#file-input-cache-key").val(myRawCacheKey),e=new FormData(document.getElementById("form-import-blank-file")),$.ajax({url:url_raw_import_blank_file,type:"POST",data:e,processData:!1,contentType:!1,mimeType:"multipart/form-data",dataType:"text",success:function(e){$("#file-input-import-blank").val("");e=(e=myParse(e)).sequences;newSequencesList.push(...e),$("#outputBlankSequences").val(e.map((e,t)=>e.name).join(";"))},error:function(e,t,a){showErrorMessage(e,t,a)}}))}function export_sequence(){var e,t=$("#modal-export-sequence");let o=$("#modal-export-sequence-body");t.is(":visible")?0!==(e=$(".export-sequence-select").map((e,t)=>t.checked).get()).filter((e,t)=>e).length&&($.ajax({url:url_raw_export_sequence,type:"POST",data:JSON.stringify({selected:e,is_blank:e.map((e,t)=>myRawData.sequence[t].is_blank),fitting_method:e.map((e,t)=>myRawData.sequence[t].fitting_method),cache_key:myRawCacheKey}),processData:!1,contentType:!1,mimeType:"multipart/form-data",success:function(e){e=myParse(e),document.getElementById("export_sequence_link").href=e.href,document.getElementById("export_sequence_link").click()}}),document.getElementById("export_sequence_link").href="",t.modal("hide")):(o.empty(),$.each(myRawData.sequence.filter((e,t)=>!e.is_estimated),(e,t)=>{var a=document.createElement("div"),i=document.createElement("input"),n=document.createElement("label");i.type="checkbox",i.id=t.name,i.style.marginLeft="0px",i.className="export-sequence-select",a.className="checkbox-inline checkbox",a.style.width="250px",a.style.margin="0 0 0 0",n.htmlFor=t.name,n.appendChild(document.createTextNode(t.name)),a.append(i),a.append(n),o.append(a)}),t.modal("show"))}function export_sequence_select_all(){$(".export-sequence-select").each(function(e,t){$(this).prop("checked",!0)})}function export_sequence_deselect_all(){$(".export-sequence-select").each(function(e,t){$(this).prop("checked",!1)})}function filesToExportChanged(){let n=$("#export_arr_file_list");var e;""!==$("#files_to_export").val()&&(e=new FormData(document.getElementById("smpParamsInputForm")),$.ajax({url:url_multi_files,type:"POST",data:e,async:!0,processData:!1,contentType:!1,mimeType:"multipart/form-data",success:function(e){$("#files_to_export").val("");e=JSON.parse(e).files;let a=n.bootstrapTable("getData"),i=["Age Spectra"];$.each(e,function(e,t){n.bootstrapTable("insertRow",{index:a.length+e,row:{file_name:t.name,file_path:t.path,diagram:`<select class="input-sm input-filter-selection" style="width: 150px">${i.map((e,t)=>e.toUpperCase()==="Age Spectra".toUpperCase()?"<option selected>"+e+"</option>":"<option>"+e+"</option>").join("")}$</select>`}})})}}))}function createSmChart(e,t){e=echarts.init(e,null,{renderer:"svg"});return e.setOption(getExtrapolateDefaultOption()),e.setOption(t),e.setOption({title:{left:"5%",top:"5%",textStyle:{fontSize:12,fontWeight:"normal"}},legend:{show:!1}}),e}function showParamProject(e,t){var a=e?e.value:void 0;if(e&&!t)if(e.id.toString().includes("irra")){if(t="irra",!$("#irraParamsRadio1").is(":checked"))return}else if(e.id.toString().includes("calc")){if(t="calc",!$("#calcParamsRadio1").is(":checked"))return}else if(e.id.toString().includes("smp")){if(t="smp",!$("#smpParamsRadio1").is(":checked"))return}else if(e.id.toString().includes("inputFilter")){if(t="input-filter",!$("#inputFilterParamsRadio1").is(":checked"))return}else{if(!e.id.toString().includes("thermo"))return;if(t="thermo",!$("#thermoParamsRadio1").is(":checked"))return}$.ajax({url:url_show_param_projects,type:"POST",data:JSON.stringify({name:a,type:t,cache_key:"undefined"!=typeof cache_key?cache_key:void 0}),contentType:"application/json",success:function(i){if("success"===i.status&&i.param){if("irra"===t&&(e=document.getElementsByClassName(t+"-params"),irradiationCyclesChanged(Number(i.param[28])),$.each(e,function(e,t){t.value=i.param[e]})),"input-filter"===t||"calc"===t||"smp"===t||"thermo"===t){let a=document.getElementsByClassName(t+"-params");var e=document.getElementsByClassName(t+"-check-box");$.each(a,function(e,t){t.value=i.param[e]}),$.each(e,function(e,t){t.checked=stringToBoolean(i.param[e+a.length])}),initialRatioSelectChanged()}}else showPopupMessage("Error",i.msg,!0)},error:function(e,t,a){showErrorMessage(e,t,a)}})}function changeSubmitType(){$('input[name="paramsRadio"][value="option2"]').is(":checked")?($("#submitBtn").text("Submit"),$("#deleteBtn").hide(),$('select[name="projectName"]').attr("disabled",!0)):($("#submitBtn").text("Save"),$("#deleteBtn").show(),$('select[name="projectName"]').attr("disabled",!1))}function chartScatterClicked(e){$.ajax({url:url_raw_data_points_click,type:"POST",data:JSON.stringify({selectionForAll:document.getElementById("applySelectionToAll").checked,sequence_index:current_page-1,data_index:e.dataIndex,isotopic_index:getCurrentIsotope(),cache_key:myRawCacheKey}),contentType:"application/json",dataType:"text",success:function(e){e=myParse(e),myRawData.sequence[current_page-1]=e.sequence,updateCharts(smCharts,chartBig,current_page-1,!1)}})}function corrBlankMethodChanged(n=[]){if(0!==(n=0===n.length?myRawData.sequence.filter((e,t)=>e.is_blank&&!e.is_estimated):n).length){var t=myRawData.sequence.filter((e,t)=>!e.is_blank);let e=[];switch($("#corrBlankMethod").val()){case"0":e=t.map(function(t,e){for(let e=n.length-1;0<=e;e--)if(n[e].index<t.index)return n[e].name;return n[0].name});break;case"1":e=t.map(function(t,e){for(let e=0;e<n.length;e++)if(n[e].index>t.index)return n[e].name;return n[n.length-1].name});break;case"2":e=t.map(function(a,e){var t,i;return(n[0].index>a.index?n[0]:n[n.length-1].index<a.index?n[n.length-1]:(t=n.filter(function(e,t){return a.index>e.index&&a.index<n[t+1].index})[0],i=n[n.indexOf(t)+1],Math.abs(t.index-a.index)<=Math.abs(i.index-a.index)?t:i)).name});break;case"3":e=t.map(function(e,t){return"Interpolated Blank"})}$.each(e,function(e,t){$("#blank-sele"+Number(e+1)).val(t)})}}function deleteParamObject(e){editParams({url:url_edit_param_object,name:$("#name3").val(),pin:$("#pin3").val(),email:"",params:getParamsByObjectName(e),type:e,flag:"delete"})}function saveParamObject(e){editParams({url:url_edit_param_object,name:$("#name2").val(),pin:$("#pin2").val(),email:"",params:getParamsByObjectName(e),type:e,flag:"update"})}function submitParamObject(e){editParams({url:url_edit_param_object,name:$("#name1").val(),pin:$("#pin1").val(),email:"",params:getParamsByObjectName(e),type:e,flag:"create"})}function editParams(t){$.ajax({url:t.url,type:"POST",data:JSON.stringify({name:t.name,pin:t.pin,email:t.email,params:t.params,type:t.type,flag:t.flag}),contentType:"application/json",success:function(e){$("#modal-submit").modal("hide"),$("#modal-delete").modal("hide"),$("#modal-save").modal("hide"),$("#modal-submit").find($("input:not(:empty)")).val(""),$("#modal-save").find($("input:not(:empty)")).val(""),"create"===t.flag&&showPopupMessage("Information","Params set created!",!1),"delete"===t.flag&&showPopupMessage("Information","Params set deleted!",!1),"update"===t.flag&&showPopupMessage("Information","Params set updated!",!1)},error:function(e,t,a){showErrorMessage(e,t,a)}})}function fitMethodChanged(){let t=$("#fitMethod");t.blur(),$.ajax({url:url_raw_change_fitting_method,type:"POST",data:JSON.stringify({sequence_index:current_page-1,isotope_index:getCurrentIsotope(),fitting_index:Number(t.val()),cache_key:myRawCacheKey}),processData:!1,contentType:!1,mimeType:"multipart/form-data",success:function(e){myRawData.sequence[current_page-1].fitting_method[getCurrentIsotope()]=Number(t.val())}})}function getAverageofBlanks(){var e=document.getElementById("inputBlankSequences").value,t=e.includes(";")?";":" ",e=e.split(t);-1!==e.indexOf("")&&e.splice(e.indexOf(""),1);let a;try{a=e.map(function(e,t){if(""!==e)return getBlankInfo(e)})}catch(e){return void showPopupMessage("Information","The blank sequences don\\'t exist. Please check if a whitespace may be in the names and use a semicolon as a delimiter.",!1)}$.ajax({url:url_raw_average_blanks,type:"POST",data:JSON.stringify({blanks:a,cache_key:myRawCacheKey}),contentType:"application/json",dataType:"text",success:function(e){e=(e=myParse(e)).new_sequence;$("#outputBlankSequences").val(e.name),newSequencesList.push(e)}})}function getInterpolatedBlank(){var e=document.getElementById("inputBlankSequences").value,t=e.includes(";")?";":" ";let o=e.split(t);if(-1!==o.indexOf("")&&o.splice(o.indexOf(""),1),0!==o.length){let e;try{e=o.map(function(e,t){if(""!==e)return getBlankInfo(e)})}catch(e){return void showPopupMessage("Information","The blank sequences don't exist. Please check if a whitespace may be in the names and use a semicolon as a delimiter.",!1)}let n=e.map(function(e,t){return[e[0].time,e[0].intercept,e[1].intercept,e[2].intercept,e[3].intercept,e[4].intercept]}),i=(showModalDialog("modal-dialog-interpolate-blank"),getLinkedChart("figure-main","figure-01","figure-02","figure-03","figure-04","figure-05"));$.each(i,function(e,t){var a=[transpose(n)[0],transpose(n)[0===e?1:e]],i=myRawData.sequence.filter((e,t)=>o.includes(e.name)||!e.is_blank).map((e,t)=>e.datetime),a={linear:getRegressionResults(a,"linear",i),quadratic:getRegressionResults(a,"quadratic",i),polynomial:getRegressionResults(a,"polynomial",i),exponential:getRegressionResults(a,"exponential",i),power:getRegressionResults(a,"power",i),average:getRegressionResults(a,"average",i)};t.setOption({title:{text:(0===e?"Blank interpolation ":"")+["Ar36","Ar37","Ar38","Ar39","Ar40"][0===e?0:e-1]},yAxis:{name:0===e?"Intensity (fA)":"",axisTick:{show:0===e},axisLabel:{show:0===e}},xAxis:{name:0===e?"Time":"",type:"time",nameLocation:"middle",nameGap:-20,nameTextStyle:{fontSize:18,fontWeight:"bold"},axisTick:{show:0===e},axisLabel:{formatter:"{dd} {MMM} {HH}:{mm}:{ss}",rotate:10,show:0===e}},series:[{id:"FilledPoints",encode:{x:0,y:0===e?1:e},data:n},{id:"UnfilledPoints",encode:{x:0,y:0===e?1:e},data:[]},{id:"LineRegression",data:transpose(a.linear.line_data)},{id:"QuadRegression",data:transpose(a.quadratic.line_data)},{id:"PolyRegression",data:transpose(a.polynomial.line_data)},{id:"ExpRegression",data:transpose(a.exponential.line_data)},{id:"PowRegression",data:transpose(a.power.line_data)},{id:"Average",data:transpose(a.average.line_data)}],graphic:[{id:"LinesResults",style:{font:'16px "", Consolas, monospace',text:text_table([["","Standard Error of Estimate","R2"],["Linear",a.linear.sey,a.linear.r2],["Quadratic",a.quadratic.sey,a.quadratic.r2],["Polynomial",a.polynomial.sey,a.polynomial.r2],["Exponential",a.exponential.sey,a.exponential.r2],["Power",a.power.sey,a.power.r2],["Average",a.average.sey,a.average.r2]],{hsep:"  ",align:["l","l","l"]})}}],animation:!1}),t.resize()}),$('#modal-dialog-interpolate-blank :button[name="apply"]').on("click",e=>{var t=$('#modal-dialog-interpolate-blank select[name="blankInterpolate"]');let a=Array(5);for(let e=0;e<5;e++)if(a[e]=getSeriesById(["LineRegression","QuadRegression","PolyRegression","ExpRegression","PowRegression","Average"][t.eq(e).val()],i[e+1].getOption().series).data,0===a[e].length)return void showPopupMessage("Information",`Results unavailable, please select another fitting method for Ar${["36","37","38","39","40"][e]}!`,!1);a=transpose(a),$.ajax({url:url_raw_interpolated_blanks,type:"POST",data:JSON.stringify({interpolated_blank:a,cache_key:myRawCacheKey}),contentType:"application/json",dataType:"text",success:function(e){e=myParse(e),myRawData.interpolated_blank=e.sequences}}),newSequencesList.push({index:"undefined",name:"Interpolated Blank",datetime:"",data:null,flag:null,type_str:"blank",results:[[["Interpolated Blank",NaN,NaN,NaN]],[["Interpolated Blank",NaN,NaN,NaN]],[["Interpolated Blank",NaN,NaN,NaN]],[["Interpolated Blank",NaN,NaN,NaN]],[["Interpolated Blank",NaN,NaN,NaN]]],coefficients:[],fitting_method:[0,0,0,0,0],is_blank:!0,is_unknown:!1,is_air:!1,is_estimated:!0}),$("#outputBlankSequences").val("Interpolated Blank"),showModalDialog("modal-dialog-blank")})}}function getBlankInfo(a){let i=myRawData.sequence.filter((e,t)=>e.name===a)[0];return[i.results[0][i.fitting_method[0]],i.results[1][i.fitting_method[1]],i.results[2][i.fitting_method[2]],i.results[3][i.fitting_method[3]],i.results[4][i.fitting_method[4]]].map(function(e,t){return{isotope:["Ar36","Ar37","Ar38","Ar39","Ar40"][t],intercept:e[0],"absolute err":e[1],"relative err":e[2],r2:e[3],time:i.datetime,name:a}})}function getCurrentIsotope(){for(let e=0;e<smCharts.length;e++)if(smCharts[e].getOption().series[0].color===FILLED_POINTS_COLOR)return e}function getExtrapolateDefaultOption(){return{title:{text:"",subtext:"",left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{axisPointer:{type:"none"},confine:!0,trigger:"axis",showContent:!1},legend:{show:!0,top:"5%",data:["Filled Points","Unfilled Points","Line Regression","Quad Regression","Poly Regression","Exp Regression","Pow Regression","Average"]},grid:{show:!0,borderWidth:1,borderColor:"#333",top:"5%",left:"5%",bottom:"5%",right:"5%"},xAxis:{name:"",type:"value",nameLocation:"middle",nameGap:-20,nameTextStyle:{fontSize:18,fontWeight:"bold"},axisLabel:{show:!1},axisTick:{show:!1},splitLine:{show:!1},axisLine:{show:!1,onZero:!1}},yAxis:{name:"",type:"value",scale:!0,nameLocation:"middle",nameGap:-25,nameTextStyle:{fontSize:18,fontWeight:"bold"},splitLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},axisLine:{show:!1,onZero:!1}},series:[{id:"FilledPoints",name:"Filled Points",type:"scatter",color:"#222222",symbolSize:10,data:[],z:3},{id:"UnfilledPoints",name:"Unfilled Points",type:"scatter",color:"#FFFFFF",symbolSize:10,data:[],z:3,itemStyle:{normal:{borderColor:"#222222",borderWidth:2}}},{id:"LineRegression",name:"Line Regression",type:"line",color:"#5cb85c",clip:!0,triggerLineEvent:!1,lineStyle:{color:"#5cb85c"},showSymbol:!1,symbolSize:0,data:[],z:0},{id:"QuadRegression",name:"Quad Regression",type:"line",color:"#d8c400",clip:!0,triggerLineEvent:!1,lineStyle:{color:"#d8c400"},showSymbol:!1,symbolSize:0,data:[],z:0},{id:"PolyRegression",name:"Poly Regression",type:"line",color:"#f0ad4e",clip:!0,triggerLineEvent:!1,lineStyle:{color:"#f0ad4e"},showSymbol:!1,symbolSize:0,data:[],z:0},{id:"ExpRegression",name:"Exp Regression",type:"line",color:"#d9534f",clip:!0,triggerLineEvent:!1,lineStyle:{color:"#d9534f"},showSymbol:!1,symbolSize:0,data:[],z:0},{id:"PowRegression",name:"Pow Regression",type:"line",color:"#329ea8",clip:!0,triggerLineEvent:!1,lineStyle:{color:"#329ea8"},showSymbol:!1,symbolSize:0,data:[],z:0},{id:"Average",name:"Average",type:"line",color:"#808080",clip:!0,triggerLineEvent:!1,lineStyle:{color:"#808080",type:"dashed"},showSymbol:!1,symbolSize:0,data:[],z:0}],graphic:[{id:"LinesResults",type:"text",z:0,draggable:!0,x:100,y:400,style:{fill:"#FF0000",overflow:"break",font:'16px "", Consolas, monospace'}}]}}function getParamsByObjectName(e){let a=[];var t=document.getElementsByClassName(e+"-params"),e=document.getElementsByClassName(e+"-check-box");return $.each(t,function(e,t){a.push("number"===t.type?t.valueAsNumber:t.value)}),$.each(e,function(e,t){a.push(t.checked)}),a}function getLineData(e,t,a,i){return e[t-1][a-1][i-1]}function getScatterData(e,t,a){try{return e[t-1][a-1]}catch(e){return[]}}function initialTable(n){$("#table-sequences").bootstrapTable({clickToSelect:!1,uniqueId:"id",columns:[{field:"checked",checkbox:!0,width:20},{field:"id",title:"Sequence",width:20},{field:"label",title:"Label",width:50},{field:"unknown",title:"Unknown",width:200},{field:"blank",title:"Blank",width:200,formatter:function(e,t,a){let i="";a+=1;return $.each(n,function(e,t){i=i+"<option value='"+t+"'>"+t+"</option>"}),'<select id="blank-sele'+a+'" name="blankSelectinTable" onchange="blankSeleChanged(id)" style="width:100%; height: 100%; border: none; padding: 0 0 0 0">'+i+"</select>"}}]}),$("#table-blank-info").bootstrapTable({clickToSelect:!1,columns:[{field:"isotope",title:"Isotope",width:20},{field:"intercept",title:"Intercept",width:150},{field:"absolute err",title:"1s",width:150},{field:"relative err",title:"%1s",width:150},{field:"r2",title:"R2",width:150}]})}function blankSeleChanged(e){console.log(e)}function irradiationCyclesChanged(t){var a=document.getElementById("irradtionTimeContainer");a.innerHTML="";for(let e=0;e<t;e++)a.innerHTML=a.innerHTML+'<div class="form-inline"><label style="width: 90px; text-align: left">End Time</label><label><input type="datetime-local" class="irra-params" style="width: 200px;"><label style="width: 80px; text-align: right">Duration</label><input type="number" class="irra-params" style="width: 100px;">hour(s)</label></div>'}function seqStateChanged(){let t=$("#isBlank").is(":checked"),a=$("#isRemoved").is(":checked");$.ajax({url:url_raw_change_seq_state,type:"POST",data:JSON.stringify({sequence_index:current_page-1,is_blank:t,is_removed:a,cache_key:myRawCacheKey}),processData:!1,contentType:!1,mimeType:"multipart/form-data",success:function(e){myRawData.sequence[current_page-1].is_blank=t,myRawData.sequence[current_page-1].is_removed=a}})}function lastSequence(){0<current_page-1&&showSequence(current_page-1)}function nextSequence(){current_page+1<=max_page&&showSequence(current_page+1)}function setSmChartClickListen(a,e){for(let t=0;t<a.length;t++)a[t].getZr().on("click",function(e){a[t].setOption({series:[{color:FILLED_POINTS_COLOR},{itemStyle:{normal:{borderColor:FILLED_POINTS_COLOR}}}]});for(let e=0;e<a.length;e++)e!==t&&a[e].setOption({series:[{color:"#222"},{itemStyle:{normal:{borderColor:"#222"}}}]});showSequence(current_page),e.target});a[0].setOption({series:[{color:FILLED_POINTS_COLOR},{itemStyle:{normal:{borderColor:FILLED_POINTS_COLOR}}}]})}function showModal(e){$(".modal:visible").modal("hide"),$("#"+e).modal("show")}function showModalDialog(e){$(".modal-dialog:visible").attr("hidden",!0),$("#"+e).attr("hidden",!1)}function showSequence(t){var a=document.getElementsByName("sequenceBtn");for(let e=0;e<a.length;e++)a[e].className="btn btn-default btn-no-outline",myRawData.sequence[e].is_blank&&(a[e].className="btn btn-grey btn-no-outline"),myRawData.sequence[e].is_removed&&(a[e].className="btn btn-danger btn-no-outline"),a[e].innerText===t.toString()&&(a[e].className="btn btn-primary");current_page=t,$("#page_num").text(current_page+"/"+max_page),(1===current_page?($("#last_page").attr("disabled",!0),$("#next_page")):current_page===max_page?($("#next_page").attr("disabled",!0),$("#last_page")):($("#last_page").attr("disabled",!1),$("#next_page"))).attr("disabled",!1),updateCharts(smCharts,chartBig,t-1,!0),$("#fitMethod").val(myRawData.sequence[t-1].fitting_method[getCurrentIsotope()]),$("#isBlank").prop("checked",myRawData.sequence[t-1].is_blank),$("#isRemoved").prop("checked",myRawData.sequence[t-1].is_removed)}function submitDelete(){$("#modal-delete").modal("show"),$("#name3").val($('select[name="projectName"]:first').val())}function submitExtrapolate(){myRawData.sequence.filter((e,t)=>!e.is_blank);let t=myRawData.sequence.filter((e,t)=>e.is_blank);0===t.length&&$.ajax({url:url_raw_empty_blank,type:"POST",data:JSON.stringify({cache_key:myRawCacheKey}),async:!1,contentType:"application/json",success:function(e){e=myParse(e.new_sequence);t=[e],myRawData.sequence.push(e)}}),$("#table-sequences").bootstrapTable("destroy"),initialTable(t.filter(e=>!e.is_removed).map((e,t)=>e.name)),updateSequenceTable(),corrBlankMethodChanged(t);for(var e=document.getElementById("listGroupBlankName");e.hasChildNodes();)e.removeChild(e.lastChild);for(var a=document.getElementById("listGroupBlankBtn");a.hasChildNodes();)a.removeChild(a.lastChild);$.each(t.map((e,t)=>e.name),function(e,t){addNametoBlankList(t)}),showModal("modal-settings")}function submitOrSave(){"Submit"===$("#submitBtn").text()?$("#modal-submit").modal("show"):($("#modal-save").modal("show"),$("#name2").val($('select[name="projectName"]:first').val()))}function submitRawData(){var e=$("#table-sequences").bootstrapTable("getSelections"),t=(e.map((e,t)=>{e.blank=$("#blank-sele"+e.id).find("option:selected").text()}),{}),a={},i={},n=(t.useProject=$("#irraParamsRadio1").is(":checked"),t.project=$("#irraProjectName").text(),t.useInput=$("#irraParamsRadio2").is(":checked"),t.param=getParamsByObjectName("irra"),a.useProject=$("#calcParamsRadio1").is(":checked"),a.project=$("#calcProjectName").text(),a.useInput=$("#calcParamsRadio2").is(":checked"),a.param=getParamsByObjectName("calc"),i.useProject=$("#smpParamsRadio1").is(":checked"),i.project=$("#smpProjectName").text(),i.useInput=$("#smpParamsRadio2").is(":checked"),i.param=getParamsByObjectName("smp"),Array.prototype.map.call(document.getElementsByClassName("sample-info"),(e,t)=>e.value));$.ajax({url:url_raw_submit,type:"POST",data:JSON.stringify({irradiationParams:t,calculationParams:a,sampleParams:i,sampleInfo:n,selectedSequences:e,fittingMethod:myRawData,cache_key:myRawCacheKey,fingerprint:localStorage.getItem("fingerprint")}),contentType:"application/json",success:function(e){$('input[name="fingerprint"]').val(localStorage.getItem("fingerprint")),$("#fingerprint-form").submit()}})}function getSelectedData(e,i){return[e.map(function(e,a){return e.map(function(e,t){return 0===t||i[a][t]?e:NaN})}),e.map(function(e,a){return e.map(function(e,t){return 0!==t&&i[a][t]?NaN:e})})]}function generateLinesData(t,a=0,e=200,i=20){var n=[],o=(e-a)/i;for(let e=0;e<=i;e+=1)n.push([a+e*o,t(a+e*o)]);return n}function updateCharts(e,t,i,n){var[o,s]=getSelectedData(myRawData.sequence[i].data,myRawData.sequence[i].flag);let l=myRawData.sequence[i].coefficients;for(let a=0;a<e.length;a++){var r=Math.max(...o.concat(s).map((e,t)=>e[2*a+1]).filter(e=>!Number.isNaN(e))),r={xAxis:{min:0,max:r},series:[{name:"Filled Points",data:o,encode:{x:2*a+1,y:2*a+2},label:{show:!1,position:"top",formatter:e=>e.dataIndex+1}},{name:"Unfilled Points",data:s,encode:{x:2*a+1,y:2*a+2},label:{show:!1,position:"top",formatter:e=>e.dataIndex+1}},{name:"Line Regression",tooltip:{formatter:"Linear"},data:generateLinesData(e=>l[a][0][0]+e*l[a][0][1],0,r,1)},{name:"Quad Regression",tooltip:{formatter:"Quadratic"},data:generateLinesData(e=>l[a][1][0]+e*l[a][1][1]+e*e*l[a][1][2],0,r)},{name:"Exp Regression",tooltip:{formatter:"Exponential"},data:generateLinesData(e=>l[a][2][0]*l[a][2][1]**e+l[a][2][2],0,r)},{name:"Pow Regression",tooltip:{formatter:"Power"},data:generateLinesData(e=>l[a][3][0]*e**l[a][3][1]+l[a][3][2],0,r)},{name:"Average",tooltip:{formatter:"Average"},data:generateLinesData(e=>l[a][4][0],0,r,1)}],animation:n};e[a].setOption(r),e[a].getOption().series[0].color===FILLED_POINTS_COLOR&&(t.setOption(r),r=[["","Intercept","Standard error","Relative error","R2"],["Linear"].concat(myRawData.sequence[i].results[a][0]),["Quadratic"].concat(myRawData.sequence[i].results[a][1]),["Exponential"].concat(myRawData.sequence[i].results[a][2]),["Power"].concat(myRawData.sequence[i].results[a][3]),["Average"].concat(myRawData.sequence[i].results[a][4])],t.setOption({title:{text:`${myRawData.sequence[i].name}  ${myRawData.sequence[i].datetime}  `+["Ar36","Ar37","Ar38","Ar39","Ar40"][a]},graphic:[{id:"LinesResults",type:"text",z:0,draggable:!0,style:{fill:"#FF0000",overflow:"break",text:text_table(r),font:'16px "", Consolas, monospace'}}]}))}}function updateSequenceTable(){var t=[],a=myRawData.sequence.filter((e,t)=>!e.is_blank);for(let e=0;e<a.length;e++)t.push({checked:!a[e].is_removed,id:e+1,unknown:a[e].name,label:a[e].type_str});$("#table-sequences").bootstrapTable("load",t)}function paramsRadioChanged(e){var t=$(`#${e}ParamsInputForm`).find($("input"));$(`#${e}ParamsRadio1`).is(":checked")?(showParamProject(document.getElementById(e+"ProjectName")),$(`#${e}ParamsInputForm`).find($('select,input[type="checkbox"],input[type="radio"]')).attr("disabled",!0),t.css("background-color","#eee"),t.css("border-color","#ccc"),t.attr("readOnly",!0)):($(`#${e}ParamsInputForm`).find($('select,input[type="checkbox"],input[type="radio"]')).attr("disabled",!1),t.css("background-color","#fff"),t.removeAttr("border-color"),t.attr("readOnly",!1)),"smp"===e&&initialRatioSelectChanged()}function getSeriesById(t,e){return(e=e||[{id:""}])[e.findIndex(e=>e.id===t)]}function getLinkedChart(e,...t){let i=echarts.init(document.getElementById(e),null,{renderer:"svg"}),r=t.map((e,t)=>{e=echarts.init(document.getElementById(e),null,{renderer:"svg"});return e.setOption(getExtrapolateDefaultOption()),e.setOption({title:{left:"5%",top:"5%",textStyle:{fontSize:12,fontWeight:"normal"}},legend:{show:!1},graphic:[{id:"LinesResults",invisible:!0,type:"text",draggable:!0,style:{fill:"#FF0000",overflow:"break",font:'16px "", Consolas, monospace',text:""}}]}),e}),c=(a,e=null)=>{var e=(e=null===e?r[a]:e).getOption(),t=e.series;i.setOption({title:{text:"Blank interpolation "+e.title[0].text},series:t.map((e,t)=>{var a=!e.name.includes("Points");return{id:e.id,data:e.data,encode:e.encode,symbolSize:a?5:10,symbol:a?"emptyrect":"circle",showSymbol:!0}}),graphic:[{id:"LinesResults",invisible:!1,type:"text",draggable:!0,style:{fill:"#FF0000",overflow:"break",font:'16px "", Consolas, monospace',text:e.graphic[0].elements[0].style.text}}]});for(let e=0;e<r.length;e++)r[e].setOption({series:[{id:"FilledPoints",color:e!==a?"#222222":FILLED_POINTS_COLOR},{id:"UnfilledPoints",itemStyle:{normal:{borderColor:e!==a?"#222222":FILLED_POINTS_COLOR}}}]});$('#modal-dialog-interpolate-blank select[name="blankInterpolate"]').attr("style",(e,t)=>e===a?"":"display: none")},n=e=>{var t=e.encode.y[0]-1,a=e.dataIndex,i=e.data,n=!e.seriesName.includes("Unfilled"),o=r[t].getOption(),s=getSeriesById("FilledPoints",o.series).data,l=getSeriesById("UnfilledPoints",o.series).data,n=((n?(s.splice(a,1),l):(l.splice(a,1),s)).push(i),[transpose(s)[e.encode.x[0]],transpose(s)[e.encode.y[0]]]),a=myRawData.sequence.map((e,t)=>e.datetime),i={linear:getRegressionResults(n,"linear",a),quadratic:getRegressionResults(n,"quadratic",a),polynomial:getRegressionResults(n,"polynomial",a),exponential:getRegressionResults(n,"exponential",a),power:getRegressionResults(n,"power",a),average:getRegressionResults(n,"average",a)};r[t].setOption({series:[{id:"FilledPoints",encode:getSeriesById("FilledPoints",o.series).encode,data:s},{id:"UnfilledPoints",encode:getSeriesById("UnfilledPoints",o.series).encode,data:l},{id:"LineRegression",data:transpose(i.linear.line_data)},{id:"QuadRegression",data:transpose(i.quadratic.line_data)},{id:"PolyRegression",data:transpose(i.polynomial.line_data)},{id:"ExpRegression",data:transpose(i.exponential.line_data)},{id:"PowRegression",data:transpose(i.power.line_data)},{id:"Average",data:transpose(i.average.line_data)}],graphic:[{id:"LinesResults",invisible:!0,type:"text",style:{fill:"#FF0000",overflow:"break",font:'16px "", Consolas, monospace',text:text_table([["","Standard Error of Estimate","R2"],["Linear",i.linear.sey,i.linear.r2],["Quadratic",i.quadratic.sey,i.quadratic.r2],["Polynomial",i.polynomial.sey,i.polynomial.r2],["Exponential",i.exponential.sey,i.exponential.r2],["Power",i.power.sey,i.power.r2],["Average",i.average.sey,i.average.r2]],{hsep:"  ",align:["l","l","l"]})}}]}),c(t,r[t])};return i.setOption(getExtrapolateDefaultOption()),$.each(r,(t,a)=>{a.getZr().on("click",function(e){c(t,a),e.target}),a.on("click","series.scatter",function(e){n(e)})}),i.on("click","series.scatter",function(e){n(e)}),c(0),[i,...r]}function getRegressionResults(e,t,a){let i={r2:"None",sey:"None",line_data:[]};return $.ajax({url:url_get_regression_result,type:"POST",data:JSON.stringify({data:e,method:t,x:a}),async:!1,contentType:"application/json",success:function(e,t,a){i=e},error:function(e,t,a){showErrorMessage(e,t,a)}}),i}function traverseDirectory(e){let n=e.createReader();return new Promise((a,e)=>{var i=[];!function t(){n.readEntries(e=>{e.length?(i.push(Promise.all(e.map(a=>a.isFile?new Promise((e,t)=>a.file(e,t)):traverseDirectory(a)))),t()):a(Promise.all(i))},e)}()})}function dropHandler(e){e.preventDefault();let l=[];var t,a=[];if(e.dataTransfer.items)for(var i of[...e.dataTransfer.items])"file"===i.kind&&(t=i.getAsFile(),(i=i.webkitGetAsEntry()).isDirectory?a.push(i):l.push(t));new FormData;let n=()=>{for(let s=0;s<l.length;s++)if(!(5242880<l[s].size)){let t="",a="";var e=l[s].name.split(".").at(-1);switch(e){case"arr":t=`open_${e}_file`,a="file-input-2";break;case"xls":t="open_full_xls_file",a="file-input-3";break;case"age":t=`open_${e}_file`,a="file-input-4";break;default:continue}let i=null,n=new DataTransfer,o=e=>{e.getElementById("button_index").value=t,i=e.getElementById(a),n.items.add(l[s]),i.files=n.files,e.getElementById("file-submit").click()};if(1===l.length)o(document);else{let e=window.open(url_calc_view);e.onload=()=>{o(e.document)}}}};0===a.length?n():(1<a.length&&showPopupMessage("Error","Only one directory on the top level is supported.",!0),traverseDirectory(a[0]).then(e=>{Promise.all(e[0]).then(e=>{l.push(...e),n()})}))}function dragOverHandler(e){e.preventDefault()}function extendData(e){var t=JSON.parse(JSON.stringify(e));for(let e=t.length;e<default_row_count;e++)t.push([null]);return t}function clickExportBtn(){switch(document.getElementById("exportChoicesLabel").selectedIndex){case 0:exportSmp(url_export_xls);break;case 1:exportSmp(url_export_pdf,!0,!1);break;case 2:saveChart(!0)}}function exportSmp(e,t=!0,a=!1){$.ajax({url:e,type:"POST",data:JSON.stringify({cache_key:cache_key,user_uuid:localStorage.getItem("fingerprint"),figure_id:getCurrentTableId(),merged_pdf:a}),contentType:"application/json",beforeSend:function(){t&&showPopupMessage("Information","Exporting, this may take a few moments, please wait...",!1,3e5)},success:function(e){"success"===e.status?(e.href.includes("arr")&&(document.getElementById("download-arr").href=e.href,document.getElementById("download-arr").innerText=e.href.toString().split("/").slice(-1)[0]),t&&(closePopupMessage(),showPopupMessage("Information","Exporting successfully. Starting download.",!1),document.getElementById("export_path_link").href=e.href,document.getElementById("export_path_link").click(),setConsoleText("Export Successfully! "+e.href))):showPopupMessage("Error",e.msg,!0),document.getElementById("export_path_link").href=""}})}async function saveChart(e=!0){let t="svg";"figure_7"===getCurrentTableId()&&(t="png");var a=chart.getDataURL({type:t}),i=document.getElementById("export_path_link"),n=sampleComponents[0].sample.name+" "+$("#"+getCurrentTableId()).val()+".svg";if(e)"figure_7"===getCurrentTableId()?setConsoleText("3D plot cannot be exported currently"):(i.href=a,i.setAttribute("download",n),i.click(),i.setAttribute("download",""));else{let l=new Image;l.src=a,l.onload=()=>{let e;var t,a=(e=("figure_7"===getCurrentTableId()?document.getElementsByTagName("canvas")[0]:(o=(s=document.getElementsByTagName("svg")[0]).getAttribute("width"),s=s.getAttribute("height"),a=(t=document.createElement("canvas")).getContext("2d"),t.setAttribute("width",o),t.setAttribute("height",s),a.drawImage(l,0,0,o,s),t)).toDataURL("image/png")).split("base64,")[1],i=atob(a),n=new Array(i.length);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);var o=new Uint8Array(n),s=new Blob([o],{type:"image/png"});navigator.clipboard.write([new ClipboardItem({[s.type]:s})]),setConsoleText("Current figure has been copied to clipboard!")}}}function initialRatioSelectChanged(){var e=$(".input-initial-ratio"),t="2"!==$("#initialRatioSelect").val();e.prop("disabled",t),e.css("background-color",t?"#eee":"#fff")}const requestQueue=[];let isProcessing=!1;function addToQueue(e){requestQueue.push(e),isProcessing||processQueue()}function processQueue(){if(0<requestQueue.length){const i=requestQueue.shift();isProcessing=!0,$.ajax({url:i.url,type:i.type,data:i.data,async:i.async||!0,contentType:i.contentType||"application/json",success:function(e){i.success(e),processQueue()},error:function(e,t,a){i.error(e,t,a),processQueue()}})}else isProcessing=!1}async function clickPoints(e){var t,a,i;isProcessing||(t=["set1","set2"][isochronLine1Btn.checked?0:1],a=getCurrentTableId(),change_selection(e.data[5],t,1),re_plot_isochrons({calc_figure_2:!0,calc_figure_3:!0,calc_figure_4:!0,calc_figure_5:!0,calc_figure_6:!0,calc_figure_7:!0}),re_plot_age_spectra(),i=findDiff(sampleComponentsBackup,sampleComponents),$.ajax({url:url_update_components_diff,type:"POST",data:JSON.stringify({diff:i,cache_key:cache_key}),contentType:"application/json",success:function(e){sampleComponentsBackup=JSON.parse(JSON.stringify(sampleComponents))}}),showPage(a),setConsoleText("Clicked："+e.seriesName+", "+t+", Label: "+e.data[5]))}function getSetById(e,t){for(var[a,i]of Object.entries(sampleComponents[e]))if("object"==typeof i&&null!==i&&i.hasOwnProperty("id")&&i.id===t)return i}function apply3DSetting(){var e,t,a,i,n,o=$(".setting-dialog:visible").attr("id"),s=sampleComponents[getCurrentTableId()];"3Daxis-setting-in-dialog"===o&&(o=document.getElementsByName("3d_xMax")[0].value,e=document.getElementsByName("3d_xMin")[0].value,t=document.getElementsByName("3d_yMax")[0].value,a=document.getElementsByName("3d_yMin")[0].value,i=document.getElementsByName("3d_zMax")[0].value,n=document.getElementsByName("3d_zMin")[0].value,s.xaxis.max=o,s.xaxis.min=e,s.yaxis.max=t,s.yaxis.min=a,s.zaxis.max=i,s.zaxis.min=n,showPage(getCurrentTableId()))}async function clickSaveTable(){let i;document.getElementById("inputType");if("0"===getCurrentTableId())i={sample:{name:$("#inputName").val(),type:$("#inputType option:selected").text(),material:$("#inputMaterial").val(),location:$("#inputLocation").val()},researcher:{name:$("#inputResearcher").val()},laboratory:{name:$("#inputLaboratory").val(),info:$("#inputLaboratoryMore").val(),analyst:$("#inputAnalyst").val()}};else if(i=hot.getSourceData(),0<rows_to_delete.length)return void await showPopupMessage("Please confirm ...","The following rows will be deleted: "+rows_to_delete,!0).then(e=>{for(var t of["1","2","3","4","5","6","7","8"])t===getCurrentTableId()?sampleComponents[t].data=i.filter((e,t)=>1<e.length):sampleComponents[t].data=sampleComponents[t].data.filter((e,t)=>!rows_to_delete.includes(t)&&1<e.length);rows_to_delete=[];var a=findDiff(sampleComponentsBackup,sampleComponents);$.ajax({url:url_update_components_diff,type:"POST",data:JSON.stringify({diff:a,cache_key:cache_key}),contentType:"application/json",success:function(e){sampleComponentsBackup=JSON.parse(JSON.stringify(sampleComponents)),showPopupMessage("Information","Successfully saved!",!1),setConsoleText("Changes Saved")}})});$.ajax({url:url_update_handsontable,type:"POST",async:!1,data:JSON.stringify({btn_id:getCurrentTableId(),recalculate:!1,cache_key:cache_key,user_uuid:localStorage.getItem("fingerprint"),data:i,rows_to_delete:rows_to_delete}),contentType:"application/json",beforeSend:function(){showPopupMessage("Information","Saving, please wait...",!1,3e5)},success:function(e){e=myParse(e.changed_components);assignDiff(sampleComponents,e),"0"===getCurrentTableId()&&$("#sample_name_title").text($("#inputName").val()),showPopupMessage("Information","Successfully saved!",isochron_marks_changed=!1),setConsoleText("Changes Saved")}})}function clickSetIrraParams(){$("#irraParamsRadio1").prop("checked",!1),$("#irraParamsRadio2").prop("checked",!0),paramsRadioChanged("irra"),showParamProject(void 0,"irra"),$("#editIrraParams").modal("show")}function clickSetCalcParams(){$("#calcParamsRadio1").prop("checked",!1),$("#calcParamsRadio2").prop("checked",!0),paramsRadioChanged("calc"),showParamProject(void 0,"calc"),$("#editCalcParams").modal("show")}function clickSetSmpParams(){$("#smpParamsRadio1").prop("checked",!1),$("#smpParamsRadio2").prop("checked",!0),paramsRadioChanged("smp"),showParamProject(void 0,"smp"),$("#editSmpParams").modal("show")}function clickRecalc(){let a=[];$.each($("#recalculationForm :checkbox"),(e,t)=>a.push(t.checked)),a.every((e,t,a)=>!e)||$.ajax({url:url_recalculation,type:"POST",data:JSON.stringify({cache_key:cache_key,content:{checked_options:a}}),contentType:"application/json",beforeSend:function(){a[11]?showPopupMessage("Information","Using Monte Carlo simulation, this may take a few minutes depending on the number of sequences involved, please wait...",!1,3e5):showPopupMessage("Information","Recalculation starts, please wait...",!1,3e5)},success:async function(e){$("#promptModal").remove(),await delay(500);e=myParse(e.res);sampleComponents=assignDiff(sampleComponents,e),showPage(getCurrentTableId()),closePopupMessage(),showPopupMessage("Information","Recalculation was successfully finished!",!0),setConsoleText("Recalculation was successful")},error:function(e,t,a){showErrorMessage(e,t,a)}})}function clickUploadPicture(){var e=$("#sample_photo_input");e.val(""),e.click(),e.change(function(){var e=new FormData;e.append("picture",$("#sample_photo_input")[0].files[0]),$.ajax({url:url_update_sample_photo,type:"POST",processData:!1,cache:!1,contentType:!1,data:e,success:function(e){document.getElementById("sample_picture").setAttribute("src",e.picture),showUploadPictureBtn()}})})}function getCurrentTableId(){var t=document.getElementsByName("table_name");for(let e=0;e<t.length;e++)if(t[e].classList.contains("active"))return t[e].id}function getTime(){var e=new Date,t=e.getMonth()+1;return e.getFullYear()+"/"+t+"/"+e.getDate()+"/ "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}function readParams(e){$.ajax({url:url_set_params,type:"POST",data:JSON.stringify({params:getParamsByObjectName(e),type:e,cache_key:cache_key}),contentType:"application/json",success:function(e){var t;"success"===e.status?(t=myParse(e.changed_components),sampleComponents=assignDiff(sampleComponents,t),showPage(getCurrentTableId()),showPopupMessage("Information","Changes have been saved!",!1)):showPopupMessage("Error",e.msg,!0)}})}function autoChartScale(){$.ajax({url:url_get_auto_scale,type:"POST",data:JSON.stringify({figure_id:getCurrentTableId(),cache_key:cache_key,user_uuid:localStorage.getItem("fingerprint")}),contentType:"application/json",success:function(e){"success"===e.status&&($("input[name='xMin']").val(e.xMin),$("input[name='xMax']").val(e.xMax),$("input[name='yMin']").val(e.yMin),$("input[name='yMax']").val(e.yMax))}})}function showPage(e){isochron_marks_changed&&(confirm("Save changes to isochron table?")?clickSaveTable():isochron_marks_changed=!1);var t=document.getElementsByName("table_name"),a=JSON.parse(JSON.stringify(sampleComponents)),i=sampleComponents[e];for(let e=0;e<t.length;e++)t[e].classList.remove("active");switch(document.getElementById(e).classList.add("active"),setConsoleText(document.getElementById(e).innerText),e){case"0":tableContainer.hide(),tableBtnDiv.show(),sampleInfoContainer.show(),figureContainer.hide(),figure3DContainer.hide(),figureRightContainer.hide(),figureBtnDiv.hide(),$("#sample_name_title").text(sampleComponents[0].sample.name),$("#inputName").val(sampleComponents[0].sample.name),$("#inputType").val(sampleComponents[0].sample.type),$("#inputMaterial").val(sampleComponents[0].sample.material),$("#inputLocation").val(sampleComponents[0].sample.location),$("#inputResearcher").val(sampleComponents[0].researcher.name),$("#inputLaboratory").val(sampleComponents[0].laboratory.name),$("#inputLaboratoryMore").val(sampleComponents[0].laboratory.info),$("#inputAnalyst").val(sampleComponents[0].laboratory.analyst);break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":var n=sampleComponents[e];showTable(),hot.updateSettings({colHeaders:n.header,data:extendData(n.data),columns:n.coltypes});break;case"figure_1":case"figure_2":case"figure_3":case"figure_4":case"figure_5":case"figure_6":showFigure(),setRightSideText(),chart.clear(),(chart=("figure_1"===e?getSpectraEchart:getIsochronEchart)(chart,e,!0)).resize(),getChartInterval(chart,i);break;case"figure_7":showFigure(),setRightSideText(),figureContainer.hide(),figure3DContainer.show(),chart_3D.clear(),(chart_3D=get3DEchart(chart_3D,e,!0)).resize();break;case"figure_8":showFigure(),chart.clear(),(chart=getDegasPatternEchart(chart,e,!1)).resize(),i.xaxis.min=chart._model._componentsMap.get("xAxis")[0].axis.scale._extent[0],i.xaxis.max=chart._model._componentsMap.get("xAxis")[0].axis.scale._extent[1],i.yaxis.min=chart._model._componentsMap.get("yAxis")[0].axis.scale._extent[0],i.yaxis.max=chart._model._componentsMap.get("yAxis")[0].axis.scale._extent[1],i.xaxis.split_number=chart._model._componentsMap.get("xAxis")[0].axis.getTicksCoords().length-1,i.yaxis.split_number=chart._model._componentsMap.get("yAxis")[0].axis.getTicksCoords().length-1,i.xaxis.interval=5,i.yaxis.interval=chart._model._componentsMap.get("yAxis")[0].axis.scale.getInterval();break;case"figure_9":showFigure(),chart.clear(),(chart=getAgeDistributionEchart(chart,e,!1)).resize(),getChartInterval(chart,i)}updateStyles(a),clickEditFigureStyle(!1)}function showTable(){tableContainer.show(),tableBtnDiv.show(),sampleInfoContainer.hide(),figureContainer.hide(),figure3DContainer.hide(),figureRightContainer.hide(),figureBtnDiv.hide()}function showFigure(){tableContainer.hide(),tableBtnDiv.hide(),sampleInfoContainer.hide(),figureContainer.show(),figure3DContainer.hide(),figureRightContainer.show(),figureBtnDiv.show()}function showUploadPictureBtn(){var e=$("#upload_picture_btn");e.is(":hidden")?e.show():e.hide()}function setConsoleText(e){exampleConsole.innerText=getTime()+" "+e,console.log(getTime()+" "+e),document.getElementById("sample_name_console").innerText=sampleComponents[0].sample.name,document.getElementById("page-title").innerText=sampleComponents[0].sample.name}function setRightSideText(){var a=getCurrentTableId();let i=[];if("figure_7"===a&&(n=sampleComponents[0].results.isochron.figure_7,i=[`z = ${n[0].m1.toFixed(2)} x ${0<n[0].m2?"+":"-"} 
            ${Math.abs(n[0].m2).toFixed(2)} y ${0<n[0].k?"+":"-"} 
            `+Math.abs(n[0].k).toFixed(2),`t = ${n[0].age.toFixed(2)} ± ${n[0].s1.toFixed(2)} | ${n[0].s2.toFixed(2)} | `+n[0].s3.toFixed(2),`MSWD = ${n[0].MSWD.toFixed(2)}, r2 = ${n[0].R2.toFixed(2)}, Di = ${n[0].iter}, 
            χ2 = ${n[0].Chisq.toFixed(2)}, p = ${n[0].Pvalue.toFixed(2)}, avg. error = ${n[0].rs.toFixed(2)}%`,`<sup>40</sup>Ar/<sup>36</sup>Ar = ${n[0].initial.toFixed(2)} ± `+n[0].sinitial.toFixed(2),"","","","","","",`z = ${n[1].m1.toFixed(2)} x ${0<n[1].m2?"+":"-"} 
            ${Math.abs(n[1].m2).toFixed(2)} y ${0<n[1].k?"+":"-"} 
            `+Math.abs(n[1].k).toFixed(2),`t = ${n[1].age.toFixed(2)} ± ${n[1].s1.toFixed(2)} | ${n[1].s2.toFixed(2)} | `+n[1].s3.toFixed(2),`MSWD = ${n[1].MSWD.toFixed(2)}, r2 = ${n[1].R2.toFixed(2)}, Di = ${n[1].iter}, 
            χ2 = ${n[1].Chisq.toFixed(2)}, p = ${n[1].Pvalue.toFixed(2)}, avg. error = ${n[1].rs.toFixed(2)}%`,`<sup>40</sup>Ar/<sup>36</sup>Ar = ${n[1].initial.toFixed(2)} ± `+n[1].sinitial.toFixed(2),"","Unselected",`Age = ${n[2].age.toFixed(2)} ± `+n[2].s1.toFixed(2),`<sup>40</sup>Ar/<sup>36</sup>Ar = ${n[2].initial.toFixed(2)} ± `+n[2].sinitial.toFixed(2),""]),["figure_1","figure_2","figure_3","figure_4","figure_5","figure_6"].includes(a)){var n=sampleComponents[0].results.isochron.figure_2[0],o=sampleComponents[0].results.isochron.figure_2[1],s=sampleComponents[0].results.isochron.figure_3[0],l=sampleComponents[0].results.isochron.figure_3[1],r=sampleComponents[0].results.age_plateau[0],c=sampleComponents[0].results.age_plateau[1],m=sampleComponents[0].results.age_spectra[0],p=sampleComponents[0].results.age_spectra[1],d=sampleComponents[0].results.age_spectra.TGA,u=sampleComponents[0].results.isochron[a];let e,t;t="figure_1"!==a?(e=`y = ${u[0].k.toFixed(4)} + ${u[0].m1.toFixed(4)}x`,`y = ${u[1].k.toFixed(4)} + ${u[1].m1.toFixed(4)}x`):e="...",i=["Normal Isochron",n.age.toFixed(2)+" ± "+n.s2.toFixed(2),"Inverse Isochron",s.age.toFixed(2)+" ± "+s.s2.toFixed(2),"Weighted Age",m.age.toFixed(2)+" ± "+m.s1.toFixed(2),"Initial Ratio Corrected",r.age.toFixed(2)+" ± "+r.s2.toFixed(2),"Regression Line",e,"Normal Isochron",o.age.toFixed(2)+" ± "+o.s2.toFixed(2),"Inverse Isochron",l.age.toFixed(2)+" ± "+l.s2.toFixed(2),"Weighted Age",p.age.toFixed(2)+" ± "+p.s1.toFixed(2),"Initial Ratio Corrected",c.age.toFixed(2)+" ± "+c.s2.toFixed(2),"Regression Line",t,"Total Age",d.age.toFixed(2)+" ± "+d.s2.toFixed(2)]}var t=document.getElementsByClassName("right-info");for(let e=0;e<t.length;e++)t[e].innerHTML=void 0===i[e]?" ":i[e]}function assignDiff(t,a){return Object.keys(a).map(e=>{Object.keys(t).includes(e)?t[e]="object"!=typeof t[e]||t[e]instanceof Array||null===t[e]?a[e]:assignDiff(t[e],a[e]):t[e]=a[e]}),t}function sendDiff(t){$.ajax({url:url_update_components_diff,type:"POST",async:!0,data:JSON.stringify({diff:t,cache_key:cache_key}),contentType:"application/json",success:function(e){assignDiff(sampleComponents,t)}})}function findDiff(e,t){var a,i={};if(isPlainObject(t))for(const n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)?isPlainObject(t[n])?(a=findDiff(e[n],t[n]),0<Object.keys(a).length&&(i[n]=a)):JSON.stringify(e[n])!==JSON.stringify(t[n])&&(i[n]=t[n]):i[n]=t[n]);return i}function isPlainObject(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function dispatchClickComponents(e,t,a=null){if("figure_9"===getCurrentTableId())switch(t){case"bar":$("#histogram-element-name").html(e.seriesName),showSettingDialog("histogram-setting-in-dialog");break;case"line":$("#kde-element-name").html(e.seriesName),showSettingDialog("kde-setting-in-dialog");break;case"custom":$("#agebar-element-name").html(e.seriesName),showSettingDialog("agebar-setting-in-dialog");break;case"text":$("#text-element-name").html(null===a?e.seriesName:a),showSettingDialog("texts-setting-in-dialog")}else switch(t){case"scatter":$("#scatter-series-name").html(e.seriesName),showSettingDialog("scatters-setting-in-dialog");break;case"line":$("#line-series-name").html(e.seriesName),showSettingDialog("lines-setting-in-dialog");break;case"text":$("#text-element-name").html(null===a?e.seriesName:a),showSettingDialog("texts-setting-in-dialog");break;case"custom":$("#custom-series-name").html(e.seriesName),showSettingDialog("custom-setting-in-dialog")}initialSettingDialog()}function showSettingDialog(e){for(var t of document.getElementsByClassName("setting-attr-dialog"))t.id===document.getElementById(e).parentElement.id?t.show():t.close();$(".setting-dialog:visible").hide(),$("#"+e).show()}function closeSettingDialog(){for(var e of document.getElementsByClassName("setting-attr-dialog"))e.close()}function clickEditFigureStyle(a=!0){let i=document.getElementsByClassName("setting-attr-dialog"),n=null,o=!1;var e=e=>{n=document.getElementById(e);for(var t of i)t.open&&(o=!0),t.id!==n.id&&t.close();a?n.open?n.close():n.show():o?n.show():n.close()};switch(getCurrentTableId()){case"figure_7":e("3DfigurePropertiesDialog"),n.open&&$("#3Daxis-setting-in-dialog").show();break;case"figure_8":e("degasPatternPropertiesDialog"),n.open&&$.each($("#degasPatternPropertiesDialog :checkbox"),(e,t)=>{try{t.setAttribute("checked",sampleComponents.figure_8.info[e])}catch(e){}});break;case"figure_9":e("ageDistributionPropertiesDialog"),n.open&&showSettingDialog("figure-9-axis-setting");break;default:e("figurePropertiesDialog"),n.open&&showSettingDialog("axis-setting-in-dialog")}initialSettingDialog()}function initialSettingDialog(n=null){try{var o,s=null===n?sampleComponents[getCurrentTableId()]:sampleComponents[n];let a=chart.getOption(),e,t,i=(e,t)=>a.series[e].name===t?a.series[e]:i(e+1,t);$("#axis-setting-in-dialog").is(":hidden")||($("#axis-setting-in-dialog :input[name='xMin']").val(a.xAxis[0].min),$("#axis-setting-in-dialog :input[name='xMax']").val(a.xAxis[0].max),$("#axis-setting-in-dialog :input[name='yMin']").val(a.yAxis[0].min),$("#axis-setting-in-dialog :input[name='yMax']").val(a.yAxis[0].max),$("#axis-setting-in-dialog :input[name='ticksInside']").prop("checked",a.xAxis[0].axisTick.inside),$("#axis-setting-in-dialog :input[name='showXSplitLine']").prop("checked",a.xAxis[0].splitLine.show),$("#axis-setting-in-dialog :input[name='showYSplitLine']").prop("checked",a.yAxis[0].splitLine.show),$("#axis-setting-in-dialog :input[name='showText1']").prop("checked",s.text1.show),$("#axis-setting-in-dialog :input[name='showText2']").prop("checked",s.text2.show),$("#axis-setting-in-dialog :input[name='showTitle']").prop("checked",a.title.show),$("#axis-setting-in-dialog :input[name='showLabel']").prop("checked",a.series[0].label.show)),$("#figure-9-axis-setting").is(":hidden")||($("#figure-9-axis-setting :input[name='xMin']").val(a.xAxis[0].min),$("#figure-9-axis-setting :input[name='xMax']").val(a.xAxis[0].max),$("#figure-9-axis-setting :input[name='yMin']").val(a.yAxis[0].min),$("#figure-9-axis-setting :input[name='yMax']").val(a.yAxis[0].max),$("#figure-9-axis-setting :input[name='ticksInside']").prop("checked",a.xAxis[0].axisTick.inside),$("#figure-9-axis-setting :input[name='showXSplitLine']").prop("checked",a.xAxis[0].splitLine.show),$("#figure-9-axis-setting :input[name='showYSplitLine']").prop("checked",a.yAxis[0].splitLine.show),$("#figure-9-axis-setting :input[name='showTitle']").prop("checked",a.title.show),$("#figure-9-axis-setting :input[name='showText1']").prop("checked",s.text1.show)),$("#scatters-setting-in-dialog").is(":hidden")||(e=$("#scatter-series-name").html(),t=i(0,"Series Name"===e?"Unselected Points":e),$("input[name='fillingColor']").val("red"===t.color?"#FF0000":t.color),$("input[name='borderColor']").val(t.itemStyle.borderColor),$("input[name='borderWidth']").val(t.itemStyle.borderWidth),$("input[name='opacity']").val(t.itemStyle.opacity),$("input[name='symbolSize']").val(t.symbolSize),$("#scatters-setting-in-dialog :input[name='showEllipse']").prop("checked",s.ellipse.show),$("#scatters-setting-in-dialog :input[name='showErrBar']").prop("checked",s.errline.show)),$("#lines-setting-in-dialog").is(":hidden")||(e=$("#line-series-name").html(),t=i(0,e),$("input[name='lineWidth']").val(t.lineStyle.width),$("input[name='lineColor']").val(t.color),$("select[name='lineType']").val(t.lineStyle.type)),$("#custom-setting-in-dialog").is(":hidden")||(e=$("#custom-series-name").html(),t=i(0,e),$("input[name='errLineColor']").val(t.itemStyle.color)),$("#texts-setting-in-dialog").is(":hidden")||(e=$("#text-element-name").html(),o=getSetById(null===n?getCurrentTableId():n,e),$("#texts-setting-in-dialog select[name='textWeight']").val(o.font_weight),$("#texts-setting-in-dialog :input[name='textSize']").val(o.font_size),$("#texts-setting-in-dialog :input[name='textFamily']").val(o.font_family),$("#texts-setting-in-dialog :input[name='textColor']").val(o.color),$("#texts-setting-in-dialog textarea[name='textContent']").val(o.text)),$("#histogram-setting-in-dialog").is(":hidden")||($("#histogram-setting-in-dialog :input[name='binStart']").val(s.set1.bin_start),$("#histogram-setting-in-dialog select[name='binRule']").val(s.set1.bin_rule),$("#histogram-setting-in-dialog :input[name='binCount']").val(s.set1.bin_count),$("#histogram-setting-in-dialog :input[name='binWidth']").val(s.set1.bin_width),$("#histogram-setting-in-dialog :input[name='fillingColor']").val(s.set1.color),$("#histogram-setting-in-dialog :input[name='borderWidth']").val(s.set1.border_width),$("#histogram-setting-in-dialog select[name='borderType']").val(s.set1.border_type),$("#histogram-setting-in-dialog :input[name='borderColor']").val(s.set1.border_color),$("#histogram-setting-in-dialog :input[name='opacity']").val(s.set1.opacity),$("#histogram-setting-in-dialog :input[name='showLabel']").prop("checked",s.set1.label.show),$("#histogram-setting-in-dialog :input[name='labelColor']").val(s.set1.label.color)),$("#kde-setting-in-dialog").is(":hidden")||($("#kde-setting-in-dialog select[name='bandKernel']").val(s.set2.band_kernel),$("#kde-setting-in-dialog select[name='bandAutoWidth']").val(s.set2.auto_width),$("#kde-setting-in-dialog :input[name='bandWidth']").val(s.set2.band_width),$("#kde-setting-in-dialog :input[name='bandPoints']").val(s.set2.band_points),$("#kde-setting-in-dialog :input[name='bandExtend']").prop("checked",s.set2.band_extend),$("#kde-setting-in-dialog :input[name='bandMaximize']").prop("checked",s.set2.band_maximize),$("#kde-setting-in-dialog :input[name='lineWidth']").val(s.set2.line_width),$("#kde-setting-in-dialog :input[name='lineColor']").val(s.set2.color),$("#kde-setting-in-dialog select[name='lineType']").val(s.set2.line_type),$("#kde-setting-in-dialog :input[name='opacity']").val(s.set2.opacity)),$("#agebar-setting-in-dialog").is(":hidden")||($("#agebar-setting-in-dialog :input[name='fillingColor']").val(s.set3.color),$("#agebar-setting-in-dialog :input[name='borderColor']").val(s.set3.border_color),$("#agebar-setting-in-dialog :input[name='borderWidth']").val(s.set3.border_width),$("#agebar-setting-in-dialog select[name='borderType']").val(s.set3.border_type),$("#agebar-setting-in-dialog select[name='verticalAlign']").val(s.set3.vertical_align),$("#agebar-setting-in-dialog :input[name='barInterval']").val(s.set3.bar_interval),$("#agebar-setting-in-dialog :input[name='barHeight']").val(s.set3.bar_height),$("#agebar-setting-in-dialog :input[name='opacity']").val(s.set3.opacity))}catch(e){console.log(e),closeSettingDialog()}}function applySettingDialog(){var e=$(".setting-dialog:visible").attr("id");let t=chart.getOption();var a=sampleComponents[getCurrentTableId()];let i=null;var n,o,s=JSON.parse(JSON.stringify(sampleComponents));"texts-setting-in-dialog"===e&&(o=$("#text-element-name").html(),(n=getSetById(getCurrentTableId(),o)).font_weight=$("#texts-setting-in-dialog select[name='textWeight']").val(),n.font_size=Number($("#texts-setting-in-dialog :input[name='textSize']").val()),n.font_family=$("#texts-setting-in-dialog :input[name='textFamily']").val(),n.color=$("#texts-setting-in-dialog :input[name='textColor']").val(),n.text=$("#texts-setting-in-dialog textarea[name='textContent']").val(),t=o.includes("title")?{title:{show:n.show,text:n.text,left:"center",top:"6%",textStyle:{color:n.color,fontWeight:n.font_weight,fontFamily:n.font_family,fontSize:n.font_size},triggerEvent:!0,z:0}}:{series:[{id:o,name:o,type:"scatter",symbol:"circle",data:[n.pos],encode:{x:0,y:1},itemStyle:{color:"none"},label:{show:n.show,position:"inside",color:n.color,fontSize:n.font_size,fontFamily:n.font_family,fontWeight:n.font_weight,rich:rich_format,formatter:n.text}}]},chart.setOption(t)),"axis-setting-in-dialog"===e&&(a.xaxis.max=$("#axis-setting-in-dialog :input[name='xMax']").val(),a.xaxis.min=$("#axis-setting-in-dialog :input[name='xMin']").val(),a.yaxis.max=$("#axis-setting-in-dialog :input[name='yMax']").val(),a.yaxis.min=$("#axis-setting-in-dialog :input[name='yMin']").val(),a.xaxis.ticks_inside=$("#axis-setting-in-dialog :input[name='ticksInside']").is(":checked"),a.yaxis.ticks_inside=$("#axis-setting-in-dialog :input[name='ticksInside']").is(":checked"),a.xaxis.show_splitline=$("#axis-setting-in-dialog :input[name='showXSplitLine']").is(":checked"),a.yaxis.show_splitline=$("#axis-setting-in-dialog :input[name='showYSplitLine']").is(":checked"),a.text1.show=$("#axis-setting-in-dialog :input[name='showText1']").is(":checked"),a.text2.show=$("#axis-setting-in-dialog :input[name='showText2']").is(":checked"),a.title.show=$("#axis-setting-in-dialog :input[name='showTitle']").is(":checked"),a.label.show=$("#axis-setting-in-dialog :input[name='showLabel']").is(":checked"),showPage(getCurrentTableId())),"figure-9-axis-setting"===e&&(a.xaxis.max=$("#figure-9-axis-setting :input[name='xMax']").val(),a.xaxis.min=$("#figure-9-axis-setting :input[name='xMin']").val(),a.yaxis.max=$("#figure-9-axis-setting :input[name='yMax']").val(),a.yaxis.min=$("#figure-9-axis-setting :input[name='yMin']").val(),a.xaxis.ticks_inside=$("#figure-9-axis-setting :input[name='ticksInside']").is(":checked"),a.yaxis.ticks_inside=$("#figure-9-axis-setting :input[name='ticksInside']").is(":checked"),a.xaxis.show_splitline=$("#figure-9-axis-setting :input[name='showXSplitLine']").is(":checked"),a.yaxis.show_splitline=$("#figure-9-axis-setting :input[name='showYSplitLine']").is(":checked"),a.text1.show=$("#figure-9-axis-setting :input[name='showText1']").is(":checked"),a.title.show=$("#figure-9-axis-setting :input[name='showTitle']").is(":checked"),t={title:{show:a.title.show},xAxis:{max:a.xaxis.max,min:a.xaxis.min,axisTick:{inside:a.xaxis.ticks_inside},splitLine:{show:a.xaxis.show_splitline}},yAxis:{max:a.yaxis.max,min:a.yaxis.min,axisTick:{inside:a.yaxis.ticks_inside},splitLine:{show:a.yaxis.show_splitline}}},showPage(getCurrentTableId())),"histogram-setting-in-dialog"===e&&((o=getSetById(getCurrentTableId(),"Histogram")).bin_start=Number($("#histogram-setting-in-dialog :input[name='binStart']").val()),o.bin_rule=$("#histogram-setting-in-dialog select[name='binRule']").val(),o.bin_count=Number($("#histogram-setting-in-dialog :input[name='binCount']").val()),o.bin_width=Number($("#histogram-setting-in-dialog :input[name='binWidth']").val()),o.color=$("#histogram-setting-in-dialog :input[name='fillingColor']").val(),o.border_color=$("#histogram-setting-in-dialog :input[name='borderColor']").val(),o.border_width=$("#histogram-setting-in-dialog :input[name='borderWidth']").val(),o.border_type=$("#histogram-setting-in-dialog select[name='borderType']").val(),o.opacity=$("#histogram-setting-in-dialog :input[name='opacity']").val(),o.label.show=$("#histogram-setting-in-dialog :input[name='showLabel']").is(":checked"),o.label.color=$("#histogram-setting-in-dialog :input[name='labelColor']").val(),o.label.show=$("#histogram-setting-in-dialog :input[name='showLabel']").is(":checked")),"kde-setting-in-dialog"===e&&((n=getSetById(getCurrentTableId(),"KDE")).band_kernel=$("#kde-setting-in-dialog select[name='bandKernel']").val(),n.auto_width=$("#kde-setting-in-dialog select[name='bandAutoWidth']").val(),n.band_width=Number($("#kde-setting-in-dialog :input[name='bandWidth']").val()),n.band_points=Number($("#kde-setting-in-dialog :input[name='bandPoints']").val()),n.band_extend=$("#kde-setting-in-dialog :input[name='bandExtend']").is(":checked"),n.band_maximize=$("#kde-setting-in-dialog :input[name='bandMaximize']").is(":checked"),n.color=$("#kde-setting-in-dialog :input[name='lineColor']").val(),n.line_type=$("#kde-setting-in-dialog select[name='lineType']").val(),n.line_width=$("#kde-setting-in-dialog :input[name='lineWidth']").val(),n.opacity=$("#kde-setting-in-dialog :input[name='opacity']").val()),"agebar-setting-in-dialog"===e&&((o=getSetById(getCurrentTableId(),"Age Bar")).color=$("#agebar-setting-in-dialog :input[name='fillingColor']").val(),o.border_color=$("#agebar-setting-in-dialog :input[name='borderColor']").val(),o.border_width=Number($("#agebar-setting-in-dialog :input[name='borderWidth']").val()),o.line_type=$("#agebar-setting-in-dialog select[name='borderType']").val(),o.vertical_align=$("#agebar-setting-in-dialog select[name='verticalAlign']").val(),o.bar_interval=$("#agebar-setting-in-dialog :input[name='barInterval']").val(),o.bar_height=$("#agebar-setting-in-dialog :input[name='barHeight']").val(),o.opacity=$("#agebar-setting-in-dialog :input[name='opacity']").val()),"scatters-setting-in-dialog"===e&&(i=$("#scatter-series-name").html(),(n=getSetById(getCurrentTableId(),i)).color=$("#scatters-setting-in-dialog :input[name='fillingColor']").val(),n.border_color=$("#scatters-setting-in-dialog :input[name='borderColor']").val(),n.symbol_size=$("#scatters-setting-in-dialog :input[name='symbolSize']").val(),n.border_width=$("#scatters-setting-in-dialog :input[name='borderWidth']").val(),n.opacity=$("#scatters-setting-in-dialog :input[name='opacity']").val(),a.ellipse.show=$("#scatters-setting-in-dialog :input[name='showEllipse']").is(":checked"),a.errline.show=$("#scatters-setting-in-dialog :input[name='showErrBar']").is(":checked"),t={series:[{name:i,color:n.color,symbolSize:n.symbol_size,itemStyle:{borderColor:n.border_color,borderWidth:n.border_width,opacity:n.opacity}},{name:"Ellipse",coordinateSystem:a.ellipse.show?"cartesian2d":"geo"},{name:"Error Lines"}]},chart.setOption(t)),"lines-setting-in-dialog"===e&&(i=$("#line-series-name").html(),(o=getSetById(getCurrentTableId(),i)).line_width=$("input[name='lineWidth']").val(),o.color=$("input[name='lineColor']").val(),o.line_type=$("select[name='lineType']").val(),t={series:[{name:i,color:o.color,lineStyle:{width:Number(o.line_width),type:o.line_type}}]},chart.setOption(t)),"custom-setting-in-dialog"===e&&(a.errline.color=$("input[name='errLineColor']").val(),t={series:[{name:$("#custom-series-name").html(),itemStyle:{color:a.errline.color}}]},chart.setOption(t)),chart.resize(),getChartInterval(chart,a),updateStyles(s)}function updateStyles(e){const o=(e,t)=>{var a,i,n={};for(a in e)"object"!=typeof e[a]||Array.isArray(e[a])||null===e[a]?JSON.stringify(e[a])!==JSON.stringify(t[a])&&(n[a]=t[a]):(i=o(e[a],t[a]),JSON.stringify(i)!==JSON.stringify({})&&(n[a]=i));return n};e=o(e,sampleComponents);0!==Object.keys(e).length&&$.ajax({url:url_update_components_diff,type:"POST",data:JSON.stringify({diff:e,cache_key:cache_key,user_uuid:localStorage.getItem("fingerprint")}),contentType:"application/json",success:function(e){"figure_9"===getCurrentTableId()&&(sampleComponents=assignDiff(sampleComponents,e),chart.clear(),(chart=getAgeDistributionEchart(chart,getCurrentTableId(),!1)).resize(),initialSettingDialog()),setConsoleText("Changes have been applied!")}})}function changeDegasPlot(){let a=[];$.each($("#degasPatternPropertiesDialog :checkbox"),(e,t)=>a.push(t.checked)),sampleComponents.figure_8.info=a,showPage("figure_8")}function getIsochronData(t,e,a=5){let i=transpose(t);return 0===i.length?[]:e.map(e=>i[t[a].indexOf(e+1)])}function getAgeBarData(e){2===e.length&&e.push(new Array(e[0].length));var t=transpose(e);t.sort((e,t)=>e[0]-t[0]);for(let e=0;e<t.length;e++)t[e][2]=(e+.5)/t.length;return t}function transpose(a){if(0===a.length)return a;const e=a.length;var i=a[0].length,n=new Array(i).fill().map(()=>new Array(e).fill(0));for(let t=0;t<e;t++)for(let e=0;e<i;e++)n[e][t]=a[t][e];return n}function renderErrBarItem(t,e){var a=sampleComponents[getCurrentTableId()].errline;let i=1,n=1;var o=e=>e=[e[0]<t.coordSys.x?t.coordSys.x:e[0]>t.coordSys.x+t.coordSys.width?t.coordSys.x+t.coordSys.width:e[0],e[1]<t.coordSys.y?t.coordSys.y:e[1]>t.coordSys.y+t.coordSys.height?t.coordSys.y+t.coordSys.height:e[1]],s=e=>{return e[0]===t.coordSys.x||e[0]===t.coordSys.x+t.coordSys.width||e[1]===t.coordSys.y||e[1]===t.coordSys.y+t.coordSys.height?0:1},l=o(e.coord([e.value(0)-e.value(1),e.value(2)])),r=o(e.coord([e.value(0)+e.value(1),e.value(2)])),c=o(e.coord([e.value(0),e.value(2)-e.value(3)])),o=o(e.coord([e.value(0),e.value(2)+e.value(3)]));return l[1]!==t.coordSys.y&&l[1]!==t.coordSys.y+t.coordSys.height||(i=0),c[0]!==t.coordSys.x&&c[0]!==t.coordSys.x+t.coordSys.width||(n=0),{type:"group",children:[{type:"line",ignore:!a.show,transition:["shape"],shape:{x1:l[0],y1:l[1],x2:r[0],y2:r[1]},style:e.style({lineWidth:i,stroke:e.visual("color")})},{type:"line",ignore:!a.show,transition:["shape"],shape:{x1:c[0],y1:c[1],x2:o[0],y2:o[1]},style:e.style({lineWidth:n,stroke:e.visual("color")})},{type:"line",ignore:!a.show,transition:["shape"],shape:{x1:l[0],y1:l[1]-3,x2:l[0],y2:l[1]+3},style:e.style({lineWidth:s(l),stroke:e.visual("color")})},{type:"line",ignore:!a.show,transition:["shape"],shape:{x1:r[0],y1:r[1]-3,x2:r[0],y2:r[1]+3},style:e.style({lineWidth:s(r),stroke:e.visual("color")})},{type:"line",ignore:!a.show,transition:["shape"],shape:{x1:c[0]-3,y1:c[1],x2:c[0]+3,y2:c[1]},style:e.style({lineWidth:s(c),stroke:e.visual("color")})},{type:"line",ignore:!a.show,transition:["shape"],shape:{x1:o[0]-3,y1:o[1],x2:o[0]+3,y2:o[1]},style:e.style({lineWidth:s(o),stroke:e.visual("color")})}]}}function renderAgeBarItem(t,e){var a=sampleComponents[getCurrentTableId()].set3;e.value(1);const i=a.bar_height,n=a.bar_interval,o=a.vertical_align;n,n;var a=e.coord([e.value(0)-e.value(1),0]),s=e.coord([e.value(0)+e.value(1),0]);return s[0]<t.coordSys.x+t.coordSys.width&&a[0]>t.coordSys.x?{type:"rect",z2:9,shape:{x:a[0],y:(e=>{switch(o){case"spread":return(1-e)*(t.coordSys.height-n)+t.coordSys.y;case"bottom":return t.coordSys.height-(t.dataIndex+1)*n-(t.dataIndex+1)*i+t.coordSys.y;default:return(1-e)*(t.coordSys.height-n)+t.coordSys.y}})(e.value(2)),width:s[0]-a[0],height:i,r:0},style:e.style()}:{type:"rect",ignore:!0}}function getIsochronEchart(e,a,t){let i=sampleComponents[a],n=(console.log(i.line1.data),console.log(i.line2.data),sampleComponents[0].results.isochron[a]);t={title:{show:i.title.show,text:i.title.text,left:"center",top:"6%",textStyle:{color:i.title.color,fontWeight:i.title.font_weight,fontFamily:i.title.font_family,fontSize:i.title.font_size},triggerEvent:!0,z:0},tooltip:{axisPointer:{type:"none"},confine:!0,trigger:"axis",formatter:e=>tooltipText},grid:{show:!1,borderWidth:1,borderColor:"#222",z:100,top:"5%",left:"8%",bottom:"5%",right:"1%"},legend:{top:0,data:[{name:"Unselected Points"},{name:"Points Set 1"},{name:"Points Set 2"},{name:"Line for Set 1"},{name:"Line for Set 2"},{name:"Error Lines",icon:"path://M231.24 14.96l0 -14.96 156.22 0 0 29.93 -156.22 0 0 -14.96zm63.15 261.95l0 -261.95 29.93 0 0 261.95 -29.93 0zm-63.15 0l0 -14.96 156.22 0 0 29.93 -156.22 0 0 -14.96z M14.96 224.05l-14.96 0 0 -156.22 29.93 0 0 156.22 -14.96 0zm588.78 -63.15l-588.78 0 0 -29.93 588.78 0 0 29.93zm0 63.15l-14.96 0 0 -156.22 29.93 0 0 156.22 -14.96 0z"},{name:"Text for Set 1",itemStyle:{color:i.text1.color},icon:"path://M344.1 42.65l0 23.6 -16.07 0 0 45.5c0,9.24 0.14,14.61 0.46,16.13 0.31,1.52 1,2.78 2.11,3.79 1.08,0.97 2.4,1.48 3.96,1.48 2.19,0 5.33,-0.94 9.46,-2.85l1.96 23.09c-5.44,2.96 -11.6,4.44 -18.49,4.44 -4.22,0 -8.01,-0.9 -11.4,-2.71 -3.39,-1.8 -5.87,-4.15 -7.44,-7 -1.6,-2.89 -2.68,-6.75 -3.31,-11.65 -0.49,-3.46 -0.74,-10.46 -0.74,-21.04l0 -49.18 -10.77 0 0 -23.6 10.77 0 0 -22.3 23.42 -17.54 0 39.84 16.07 0zm-156.49 112.36l31.97 -57.88 -30.61 -54.48 28.61 0 15.67 30.89 16.64 -30.89 27.47 0 -30.07 53.22 32.8 59.14 -28.58 0 -18.27 -34.82 -18.18 34.82 -27.47 0zm-41.94 -35.5l23.43 4.98c-2.99,10.86 -7.75,19.12 -14.22,24.82 -6.5,5.67 -14.62,8.52 -24.34,8.52 -15.42,0 -26.85,-6.39 -34.23,-19.16 -5.84,-10.25 -8.78,-23.17 -8.78,-38.79 0,-18.62 3.85,-33.23 11.51,-43.77 7.67,-10.57 17.38,-15.84 29.12,-15.84 13.17,0 23.57,5.52 31.21,16.56 7.61,11.04 11.26,27.96 10.91,50.77l-58.65 0c0.17,8.8 2.05,15.66 5.67,20.57 3.59,4.91 8.09,7.36 13.45,7.36 3.68,0 6.75,-1.26 9.23,-3.79 2.51,-2.52 4.39,-6.6 5.67,-12.23zm-109.42 35.5l0 -128.81 -36.25 0 0 -26.2 97.12 0 0 26.2 -36.08 0 0 128.81 -24.8 0zm110.79 -65.6c-0.17,-8.62 -1.91,-15.19 -5.24,-19.67 -3.33,-4.51 -7.38,-6.75 -12.17,-6.75 -5.1,0 -9.32,2.38 -12.65,7.11 -3.33,4.73 -4.96,11.19 -4.9,19.31l34.97 0z"},{name:"Text for Set 2",itemStyle:{color:i.text2.color},icon:"path://M344.1 42.65l0 23.6 -16.07 0 0 45.5c0,9.24 0.14,14.61 0.46,16.13 0.31,1.52 1,2.78 2.11,3.79 1.08,0.97 2.4,1.48 3.96,1.48 2.19,0 5.33,-0.94 9.46,-2.85l1.96 23.09c-5.44,2.96 -11.6,4.44 -18.49,4.44 -4.22,0 -8.01,-0.9 -11.4,-2.71 -3.39,-1.8 -5.87,-4.15 -7.44,-7 -1.6,-2.89 -2.68,-6.75 -3.31,-11.65 -0.49,-3.46 -0.74,-10.46 -0.74,-21.04l0 -49.18 -10.77 0 0 -23.6 10.77 0 0 -22.3 23.42 -17.54 0 39.84 16.07 0zm-156.49 112.36l31.97 -57.88 -30.61 -54.48 28.61 0 15.67 30.89 16.64 -30.89 27.47 0 -30.07 53.22 32.8 59.14 -28.58 0 -18.27 -34.82 -18.18 34.82 -27.47 0zm-41.94 -35.5l23.43 4.98c-2.99,10.86 -7.75,19.12 -14.22,24.82 -6.5,5.67 -14.62,8.52 -24.34,8.52 -15.42,0 -26.85,-6.39 -34.23,-19.16 -5.84,-10.25 -8.78,-23.17 -8.78,-38.79 0,-18.62 3.85,-33.23 11.51,-43.77 7.67,-10.57 17.38,-15.84 29.12,-15.84 13.17,0 23.57,5.52 31.21,16.56 7.61,11.04 11.26,27.96 10.91,50.77l-58.65 0c0.17,8.8 2.05,15.66 5.67,20.57 3.59,4.91 8.09,7.36 13.45,7.36 3.68,0 6.75,-1.26 9.23,-3.79 2.51,-2.52 4.39,-6.6 5.67,-12.23zm-109.42 35.5l0 -128.81 -36.25 0 0 -26.2 97.12 0 0 26.2 -36.08 0 0 128.81 -24.8 0zm110.79 -65.6c-0.17,-8.62 -1.91,-15.19 -5.24,-19.67 -3.33,-4.51 -7.38,-6.75 -12.17,-6.75 -5.1,0 -9.32,2.38 -12.65,7.11 -3.33,4.73 -4.96,11.19 -4.9,19.31l34.97 0z"}]},xAxis:[{name:i.xaxis.title.text,type:"value",nameLocation:"middle",nameGap:25,max:i.xaxis.max,min:i.xaxis.min,splitLine:{show:i.xaxis.show_splitline},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}},axisLabel:{showMaxLabel:!1,color:"#222"},axisTick:{inside:i.xaxis.ticks_inside},nameTextStyle:{fontSize:16,fontFamily:"Microsoft Sans Serif",rich:{sub:{verticalAlign:"bottom",fontSize:10,fontFamily:"Microsoft Sans Serif"},sup:{verticalAlign:"top",fontSize:10,fontFamily:"Microsoft Sans Serif"}}},zlevel:9},{splitLine:{show:!1},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}}},{id:"xaxis_for_text",type:"value",show:!1,min:0,max:100,position:"bottom"}],yAxis:[{name:i.yaxis.title.text,type:"value",nameLocation:"middle",nameGap:50,max:i.yaxis.max,min:i.yaxis.min,splitLine:{show:i.yaxis.show_splitline},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}},axisLabel:{showMaxLabel:!0,color:"#222",formatter:function(e){return getScientificCounting(e)}},axisTick:{inside:i.yaxis.ticks_inside},nameTextStyle:{fontSize:16,fontFamily:"Microsoft Sans Serif",rich:{sub:{verticalAlign:"bottom",fontSize:10,fontFamily:"Microsoft Sans Serif"},sup:{verticalAlign:"top",fontSize:10,fontFamily:"Microsoft Sans Serif"}}},zlevel:9},{splitLine:{show:!1},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}}},{id:"yaxis_for_text",type:"value",show:!1,min:0,max:100,position:"left"},{id:"special_yaixs",type:"value",splitLine:{show:!1},axisLine:{show:!1,onZero:!1},position:"left",min:i.yaxis.min,max:i.yaxis.max,interval:("figure_2"===a?298.56:"figure_3"===a?.0033:i.yaxis.max)-i.yaxis.min,axisTick:{show:!1,inside:!0},axisLabel:{formatter:(e,t)=>("figure_2"===a||"figure_3"===a)&&1===t?"⇦Atmospheric argon ratio":"",show:i.label.show,inside:!0}}],series:[{name:"Unselected Points",type:"scatter",color:i.set3.color,symbolSize:i.set3.symbol_size,z:2,data:getIsochronData(i.data,i.set3.data),encode:{x:0,y:2},itemStyle:{borderColor:i.set3.border_color,borderWidth:i.set3.border_width,opacity:i.set3.opacity},label:{show:i.label.show,formatter:"{@[5]}",position:i.label.position,distance:i.label.distance,offset:i.label.offset,color:i.label.color}},{name:"Points Set 1",type:"scatter",color:i.set1.color,symbolSize:i.set1.symbol_size,z:2,data:getIsochronData(i.data,i.set1.data),encode:{x:0,y:2},itemStyle:{borderColor:i.set1.border_color,borderWidth:i.set1.border_width,opacity:i.set1.opacity},label:{show:i.label.show,formatter:"{@[5]}",position:i.label.position,distance:i.label.distance,offset:i.label.offset,color:i.label.color}},{name:"Points Set 2",type:"scatter",color:i.set2.color,symbolSize:i.set2.symbol_size,z:2,data:getIsochronData(i.data,i.set2.data),encode:{x:0,y:2},itemStyle:{borderColor:i.set2.border_color,borderWidth:i.set2.border_width,opacity:i.set2.opacity},label:{show:i.label.show,formatter:"{@[5]}",position:i.label.position,distance:i.label.distance,offset:i.label.offset,color:i.label.color}},{name:"Line for Set 1",type:"line",color:i.line1.color,z:0,data:i.line1.data,showSymbol:!1,clip:!0,triggerLineEvent:!0,label:{show:!1,formatter:""},lineStyle:{width:i.line1.line_width,type:i.line1.line_type}},{name:"Line for Set 2",type:"line",color:i.line2.color,z:0,data:i.line2.data,showSymbol:!1,clip:!0,triggerLineEvent:!0,label:{show:!1,formatter:""},lineStyle:{width:i.line2.line_width,type:i.line2.line_type}},{name:"Error Lines",type:"custom",data:transpose(i.data),itemStyle:{color:i.errline.color},renderItem:renderErrBarItem,label:{show:!1,formatter:""}},{name:"Ellipse",type:"lines",data:i.ellipse.data.map((e,t)=>({coords:[...e,e[0]]})),polyline:!0,coordinateSystem:i.ellipse.show?"cartesian2d":"geo",xAxisIndex:0,yAxisIndex:0,silent:!0,lineStyle:{color:i.ellipse.border_color,curveness:.5,width:i.ellipse.border_width,type:i.ellipse.border_type}},{id:"Text for Set 1",name:"Text for Set 1",yAxisIndex:2,xAxisIndex:2,type:"scatter",symbol:"circle",data:[i.text1.pos],encode:{x:0,y:1},itemStyle:{color:"none"},label:{show:3<=i.set1.data.length&&i.text1.show,position:"inside",color:i.text1.color,fontSize:i.text1.font_size,fontFamily:i.text1.font_family,fontWeight:i.text1.font_weight,rich:rich_format,formatter:e=>""!==i.text1.text?i.text1.text:`t = ${n[0].age.toFixed(2)} ± ${n[0].s1.toFixed(2)} | ${n[0].s2.toFixed(2)} | ${n[0].s3.toFixed(2)} Ma
${"figure_2"===a||"figure_3"===a?"({sup|40}Ar/{sup|36}Ar){sub|0}":"({sup|40}Ar/{sup|38}Ar){sub|Cl}"} = ${n[0].initial.toFixed(2)} ± ${n[0].sinitial.toFixed(2)}
MSWD = ${n[0].MSWD.toFixed(2)}, R{sup|2} = ${n[0].R2.toFixed(4)}
χ{sup|2} = ${n[0].Chisq.toFixed(2)}, p = ${n[0].Pvalue.toFixed(2)}
avg error = ${n[0].rs.toFixed(4)}%`}},{id:"Text for Set 2",name:"Text for Set 2",yAxisIndex:2,xAxisIndex:2,type:"scatter",symbol:"circle",data:[i.text2.pos],encode:{x:0,y:1},itemStyle:{color:"none"},label:{show:3<=i.set2.data.length&&i.text2.show,position:"inside",color:i.text2.color,fontSize:i.text2.font_size,fontFamily:i.text2.font_family,fontWeight:i.text2.font_weight,rich:rich_format,formatter:e=>""!==i.text2.text?i.text2.text:`t = ${n[1].age.toFixed(2)} ± ${n[1].s1.toFixed(2)} | ${n[1].s2.toFixed(2)} | ${n[1].s3.toFixed(2)} Ma
${"figure_2"===a||"figure_3"===a?"({sup|40}Ar/{sup|36}Ar){sub|0}":"({sup|40}Ar/{sup|38}Ar){sub|Cl}"} = ${n[1].initial.toFixed(2)} ± ${n[1].sinitial.toFixed(2)}
MSWD = ${n[1].MSWD.toFixed(2)}, R{sup|2} = ${n[1].R2.toFixed(4)}
χ{sup|2} = ${n[1].Chisq.toFixed(2)}, p = ${n[1].Pvalue.toFixed(2)}
avg error = ${n[1].rs.toFixed(4)}%`}}],animation:t,animationDuration:500};return e.setOption(t),e}function get3DEchart(e,t,a){var i=(a,i,n,o,s,l,r,c,m)=>{var p,d,u;let g=[];for(let t=0;t<=200;t++)for(let e=0;e<=200;e++)g=g.concat([(p=a+(i-a)/200*t,d=n+(o-n)/200*e,(u=void 0)===p&&(p=(u-c*d-m)/r),void 0===d&&(d=(u-r*p-m)/c),void 0===u&&(u=r*p+c*d+m),[Number(p),Number(d),Number(u)])]);return g.map((e,t)=>e[2]>l||e[2]<s?[e[0],e[1],"-"]:e)},t=sampleComponents[t],n=sampleComponents[0].results.isochron.figure_7,i={title:{show:t.title.show,text:t.title.text,left:"center",top:"6%",textStyle:{color:t.title.color,fontWeight:t.title.font_weight,fontFamily:t.title.font_family,fontSize:t.title.font_size},triggerEvent:!0,z:0},tooltip:{axisPointer:{type:"none"},confine:!0,trigger:"axis",formatter:e=>tooltipText},legend:{top:0},grid3D:{show:!0},xAxis3D:{name:t.xaxis.title.text,type:"value",max:t.xaxis.max,min:t.xaxis.min,nameTextStyle:{fontSize:16,fontFamily:"Microsoft YaHei",rich:{sub:{verticalAlign:"bottom",fontSize:10},sup:{verticalAlign:"top",fontSize:10}}}},yAxis3D:{name:t.yaxis.title.text,type:"value",max:t.yaxis.max,min:t.yaxis.min,nameTextStyle:{fontSize:16,fontFamily:"Microsoft YaHei",rich:{sub:{verticalAlign:"bottom",fontSize:10},sup:{verticalAlign:"top",fontSize:10}}}},zAxis3D:{name:t.zaxis.title.text,type:"value",max:t.zaxis.max,min:t.zaxis.min,nameTextStyle:{fontSize:16,fontFamily:"Microsoft YaHei",rich:{sub:{verticalAlign:"bottom",fontSize:10},sup:{verticalAlign:"top",fontSize:10}}}},series:[{name:"Unselected Points",type:"scatter3D",color:t.set3.color,symbolSize:t.set3.symbol_size,z:2,coordinateSystemstring:"cartesian3D",data:getIsochronData(t.data,t.set3.data,9),encode:{x:0,y:2,z:4},itemStyle:{borderColor:t.set3.border_color,borderWidth:t.set3.border_width,opacity:t.set3.opacity}},{name:"Points Set 1",type:"scatter3D",color:t.set1.color,symbolSize:t.set1.symbol_size,z:2,data:getIsochronData(t.data,t.set1.data,9),encode:{x:0,y:2,z:4},itemStyle:{borderColor:t.set1.border_color,borderWidth:t.set1.border_width,opacity:t.set1.opacity}},{name:"Points Set 2",type:"scatter3D",color:t.set2.color,symbolSize:t.set2.symbol_size,z:2,data:getIsochronData(t.data,t.set2.data,9),encode:{x:0,y:2,z:4},itemStyle:{borderColor:t.set2.border_color,borderWidth:t.set2.border_width,opacity:t.set2.opacity}},{name:"Unselected Surface",type:"surface",wireframe:{show:!1},itemStyle:{opacity:1},data:i(t.xaxis.min,t.xaxis.max,t.yaxis.min,t.yaxis.max,t.zaxis.min,t.zaxis.max,n[2].m1,n[2].m2,n[2].k)},{name:"Set 1 Surface",type:"surface",wireframe:{show:!1},itemStyle:{opacity:1},data:i(t.xaxis.min,t.xaxis.max,t.yaxis.min,t.yaxis.max,t.zaxis.min,t.zaxis.max,n[0].m1,n[0].m2,n[0].k)},{name:"Set 2 Surface",type:"surface",wireframe:{show:!1},itemStyle:{opacity:1},data:i(t.xaxis.min,t.xaxis.max,t.yaxis.min,t.yaxis.max,t.zaxis.min,t.zaxis.max,n[1].m1,n[1].m2,n[1].k)}]};return chart_3D.setOption(i),chart_3D}function getSpectraEchart(e,t,a){let i=sampleComponents[t],n=sampleComponents[0].results.age_plateau;t={title:{show:i.title.show,text:i.title.text,left:"center",top:"6%",textStyle:{color:i.title.color,fontWeight:i.title.font_weight,fontFamily:i.title.font_family,fontSize:i.title.font_size},triggerEvent:!0,z:0},tooltip:{axisPointer:{type:"none"},confine:!0,trigger:"axis",formatter:e=>tooltipText},legend:{top:0,data:[{name:"Spectra Line 1"},{name:"Spectra Line 2"},{name:"Set1 Line 1"},{name:"Set1 Line 2"},{name:"Set2 Line 1"},{name:"Set2 Line 2"},{name:"Text for Set 1",itemStyle:{color:i.text1.color},icon:"path://M344.1 42.65l0 23.6 -16.07 0 0 45.5c0,9.24 0.14,14.61 0.46,16.13 0.31,1.52 1,2.78 2.11,3.79 1.08,0.97 2.4,1.48 3.96,1.48 2.19,0 5.33,-0.94 9.46,-2.85l1.96 23.09c-5.44,2.96 -11.6,4.44 -18.49,4.44 -4.22,0 -8.01,-0.9 -11.4,-2.71 -3.39,-1.8 -5.87,-4.15 -7.44,-7 -1.6,-2.89 -2.68,-6.75 -3.31,-11.65 -0.49,-3.46 -0.74,-10.46 -0.74,-21.04l0 -49.18 -10.77 0 0 -23.6 10.77 0 0 -22.3 23.42 -17.54 0 39.84 16.07 0zm-156.49 112.36l31.97 -57.88 -30.61 -54.48 28.61 0 15.67 30.89 16.64 -30.89 27.47 0 -30.07 53.22 32.8 59.14 -28.58 0 -18.27 -34.82 -18.18 34.82 -27.47 0zm-41.94 -35.5l23.43 4.98c-2.99,10.86 -7.75,19.12 -14.22,24.82 -6.5,5.67 -14.62,8.52 -24.34,8.52 -15.42,0 -26.85,-6.39 -34.23,-19.16 -5.84,-10.25 -8.78,-23.17 -8.78,-38.79 0,-18.62 3.85,-33.23 11.51,-43.77 7.67,-10.57 17.38,-15.84 29.12,-15.84 13.17,0 23.57,5.52 31.21,16.56 7.61,11.04 11.26,27.96 10.91,50.77l-58.65 0c0.17,8.8 2.05,15.66 5.67,20.57 3.59,4.91 8.09,7.36 13.45,7.36 3.68,0 6.75,-1.26 9.23,-3.79 2.51,-2.52 4.39,-6.6 5.67,-12.23zm-109.42 35.5l0 -128.81 -36.25 0 0 -26.2 97.12 0 0 26.2 -36.08 0 0 128.81 -24.8 0zm110.79 -65.6c-0.17,-8.62 -1.91,-15.19 -5.24,-19.67 -3.33,-4.51 -7.38,-6.75 -12.17,-6.75 -5.1,0 -9.32,2.38 -12.65,7.11 -3.33,4.73 -4.96,11.19 -4.9,19.31l34.97 0z"},{name:"Text for Set 2",itemStyle:{color:i.text2.color},icon:"path://M344.1 42.65l0 23.6 -16.07 0 0 45.5c0,9.24 0.14,14.61 0.46,16.13 0.31,1.52 1,2.78 2.11,3.79 1.08,0.97 2.4,1.48 3.96,1.48 2.19,0 5.33,-0.94 9.46,-2.85l1.96 23.09c-5.44,2.96 -11.6,4.44 -18.49,4.44 -4.22,0 -8.01,-0.9 -11.4,-2.71 -3.39,-1.8 -5.87,-4.15 -7.44,-7 -1.6,-2.89 -2.68,-6.75 -3.31,-11.65 -0.49,-3.46 -0.74,-10.46 -0.74,-21.04l0 -49.18 -10.77 0 0 -23.6 10.77 0 0 -22.3 23.42 -17.54 0 39.84 16.07 0zm-156.49 112.36l31.97 -57.88 -30.61 -54.48 28.61 0 15.67 30.89 16.64 -30.89 27.47 0 -30.07 53.22 32.8 59.14 -28.58 0 -18.27 -34.82 -18.18 34.82 -27.47 0zm-41.94 -35.5l23.43 4.98c-2.99,10.86 -7.75,19.12 -14.22,24.82 -6.5,5.67 -14.62,8.52 -24.34,8.52 -15.42,0 -26.85,-6.39 -34.23,-19.16 -5.84,-10.25 -8.78,-23.17 -8.78,-38.79 0,-18.62 3.85,-33.23 11.51,-43.77 7.67,-10.57 17.38,-15.84 29.12,-15.84 13.17,0 23.57,5.52 31.21,16.56 7.61,11.04 11.26,27.96 10.91,50.77l-58.65 0c0.17,8.8 2.05,15.66 5.67,20.57 3.59,4.91 8.09,7.36 13.45,7.36 3.68,0 6.75,-1.26 9.23,-3.79 2.51,-2.52 4.39,-6.6 5.67,-12.23zm-109.42 35.5l0 -128.81 -36.25 0 0 -26.2 97.12 0 0 26.2 -36.08 0 0 128.81 -24.8 0zm110.79 -65.6c-0.17,-8.62 -1.91,-15.19 -5.24,-19.67 -3.33,-4.51 -7.38,-6.75 -12.17,-6.75 -5.1,0 -9.32,2.38 -12.65,7.11 -3.33,4.73 -4.96,11.19 -4.9,19.31l34.97 0z"}]},grid:{show:!1,borderWidth:1,borderColor:"#222",z:5,top:"5%",left:"8%",bottom:"5%",right:"1%"},xAxis:[{name:i.xaxis.title.text,type:"value",nameLocation:"middle",nameGap:25,max:i.xaxis.max,min:i.xaxis.min,splitLine:{show:i.xaxis.show_splitline},axisTick:{inside:i.xaxis.ticks_inside},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}},axisLabel:{showMaxLabel:!0,color:"#222"},nameTextStyle:{fontSize:16,fontFamily:"Microsoft YaHei",rich:{sub:{verticalAlign:"bottom",fontSize:10},sup:{verticalAlign:"top",fontSize:10}}},zlevel:9},{splitLine:{show:!1},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}}},{id:"xaxis_for_text",type:"value",show:!1,min:0,max:100,position:"bottom"}],yAxis:[{name:i.yaxis.title.text,type:"value",nameLocation:"middle",nameGap:50,max:i.yaxis.max,min:i.yaxis.min,splitLine:{show:i.yaxis.show_splitline},axisTick:{inside:i.xaxis.ticks_inside},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}},axisLabel:{showMaxLabel:!0,color:"#222",showMinLabel:!1,formatter:function(e){return getScientificCounting(e)}},nameTextStyle:{fontSize:16,fontFamily:"Microsoft YaHei",rich:{sub:{verticalAlign:"bottom",fontSize:10},sup:{verticalAlign:"top",fontSize:10}}},zlevel:9},{splitLine:{show:!1},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}}},{id:"yaxis_for_text",type:"value",show:!1,min:0,max:100,position:"bottom"}],series:[{name:"Spectra Line 1",type:"line",color:i.line1.color,encode:{x:0,y:1},data:i.data,seriesLayoutBy:"row",symbolSize:0,z:2,triggerLineEvent:!0,lineStyle:{width:i.line1.line_width,type:i.line1.line_type},label:{show:i.label.show,formatter:e=>e.dataIndex%2==0?e.dataIndex/2+1:"",position:i.line1.label.position,distance:i.line1.label.distance,offset:i.line1.label.offset,color:i.line1.label.color}},{name:"Spectra Line 2",type:"line",color:i.line2.color,encode:{x:0,y:2},data:i.data,seriesLayoutBy:"row",symbolSize:0,z:2,triggerLineEvent:!0,lineStyle:{width:i.line2.line_width,type:i.line2.line_type},label:{show:i.label.show,formatter:e=>e.name,position:i.line2.label.position,distance:i.line2.label.distance,offset:i.line2.label.offset,color:i.line2.label.color}},{name:"Set1 Line 1",type:"line",color:i.line3.color,encode:{x:0,y:1},data:i.set1.data,seriesLayoutBy:"row",symbol:"none",z:4,triggerLineEvent:!0,lineStyle:{width:i.line3.line_width,type:i.line3.line_type},label:{show:i.line3.label.show,formatter:e=>"",position:i.line3.label.position,distance:i.line3.label.distance,offset:i.line3.label.offset,color:i.line3.label.color}},{name:"Set1 Line 2",type:"line",color:i.line4.color,encode:{x:0,y:2},data:i.set1.data,seriesLayoutBy:"row",symbol:"none",z:4,triggerLineEvent:!0,lineStyle:{width:i.line4.line_width,type:i.line4.line_type},label:{show:i.line4.label.show,formatter:e=>"",position:i.line4.label.position,distance:i.line4.label.distance,offset:i.line4.label.offset,color:i.line4.label.color}},{name:"Set2 Line 1",type:"line",color:i.line5.color,encode:{x:0,y:1},data:i.set2.data,seriesLayoutBy:"row",symbol:"none",z:4,triggerLineEvent:!0,lineStyle:{width:i.line5.line_width,type:i.line5.line_type},label:{show:i.line5.label.show,formatter:e=>"",position:i.line5.label.position,distance:i.line5.label.distance,offset:i.line5.label.offset,color:i.line5.label.color}},{name:"Set2 Line 2",type:"line",color:i.line6.color,encode:{x:0,y:2},data:i.set2.data,seriesLayoutBy:"row",symbol:"none",z:4,triggerLineEvent:!0,lineStyle:{width:i.line6.line_width,type:i.line6.line_type},label:{show:i.line6.label.show,formatter:e=>"",position:i.line6.label.position,distance:i.line6.label.distance,offset:i.line6.label.offset,color:i.line6.label.color}},{name:"Set4 Line 1",type:"line",color:i.line7.color,encode:{x:0,y:1},data:i.set4.data,seriesLayoutBy:"row",symbol:"none",z:4,triggerLineEvent:!0,lineStyle:{width:0,type:i.line7.line_type},label:{show:i.line7.label.show,formatter:e=>"",position:i.line7.label.position,distance:i.line7.label.distance,offset:i.line7.label.offset,color:i.line7.label.color}},{name:"Set4 Line 2",type:"line",color:i.line8.color,encode:{x:0,y:2},data:i.set4.data,seriesLayoutBy:"row",symbol:"none",z:4,triggerLineEvent:!0,lineStyle:{width:0,type:i.line8.line_type},label:{show:i.line8.label.show,formatter:e=>"",position:i.line8.label.position,distance:i.line8.label.distance,offset:i.line8.label.offset,color:i.line8.label.color}},{name:"Set5 Line 1",type:"line",color:i.line9.color,encode:{x:0,y:1},data:i.set5.data,seriesLayoutBy:"row",symbol:"none",z:4,triggerLineEvent:!0,lineStyle:{width:0,type:i.line9.line_type},label:{show:i.line9.label.show,formatter:e=>"",position:i.line9.label.position,distance:i.line9.label.distance,offset:i.line9.label.offset,color:i.line9.label.color}},{name:"Set5 Line 2",type:"line",color:i.line10.color,encode:{x:0,y:2},data:i.set5.data,seriesLayoutBy:"row",symbol:"none",z:4,triggerLineEvent:!0,lineStyle:{width:0,type:i.line10.line_type},label:{show:i.line10.label.show,formatter:e=>"",position:i.line10.label.position,distance:i.line10.label.distance,offset:i.line10.label.offset,color:i.line10.label.color}},{id:"Text for Set 1",name:"Text for Set 1",yAxisIndex:2,xAxisIndex:2,type:"scatter",symbol:"circle",z:5,data:[i.text1.pos],encode:{x:0,y:1},itemStyle:{color:"none"},label:{show:"Unknown"!==sampleComponents[0].sample.type||3<=i.set1.data.length&&i.text1.show,position:"inside",color:i.text1.color,fontSize:i.text1.font_size,fontFamily:i.text1.font_family,fontWeight:i.text1.font_weight,rich:rich_format,formatter:e=>(""===i.text1.text&&("Unknown"===sampleComponents[0].sample.type&&(i.text1.text=`t = ${n[0].age.toFixed(2)} ± ${n[0].s1.toFixed(2)} | ${n[0].s2.toFixed(2)} | ${n[0].s3.toFixed(2)} Ma
WMF = ${n[0].F.toFixed(2)} ± ${n[0].sF.toFixed(2)}, n = ${n[0].Num}
MSWD = ${n[0].MSWD.toFixed(2)}, ∑{sup|39}Ar = ${n[0].Ar39.toFixed(2)}%
χ{sup|2} = ${n[0].Chisq.toFixed(2)}, p = `+n[0].Pvalue.toFixed(2)),"Standard"===sampleComponents[0].sample.type&&(i.text1.text=`WMJ = ${n[0].F.toFixed(8)} ± ${n[0].sF.toFixed(8)} 
n = ${n[0].Num}, MSWD = ${n[0].MSWD.toFixed(2)}
χ{sup|2} = ${n[0].Chisq.toFixed(2)}, p = `+n[0].Pvalue.toFixed(2)),"Air"===sampleComponents[0].sample.type)&&(i.text1.text=`WMMDF = ${n[0].F.toFixed(8)} ± ${n[0].sF.toFixed(8)} 
n = ${n[0].Num}, MSWD = ${n[0].MSWD.toFixed(2)}
χ{sup|2} = ${n[0].Chisq.toFixed(2)}, p = `+n[0].Pvalue.toFixed(2)),i.text1.text)}},{id:"Text for Set 2",name:"Text for Set 2",yAxisIndex:2,xAxisIndex:2,type:"scatter",symbol:"circle",z:5,data:[i.text2.pos],encode:{x:0,y:1},itemStyle:{color:"none"},label:{show:"Unknown"!==sampleComponents[0].sample.type||3<=i.set2.data.length&&i.text2.show,position:"inside",color:i.text2.color,fontSize:i.text2.font_size,fontFamily:i.text2.font_family,fontWeight:i.text2.font_weight,rich:rich_format,formatter:e=>(""===i.text2.text&&(console.log(sampleComponents[0].sample.type),"Unknown"===sampleComponents[0].sample.type&&(i.text2.text=`t = ${n[1].age.toFixed(2)} ± ${n[1].s1.toFixed(2)} | ${n[1].s2.toFixed(2)} | ${n[1].s3.toFixed(2)} Ma
WMF = ${n[1].F.toFixed(2)} ± ${n[1].sF.toFixed(2)}, n = ${n[1].Num}
MSWD = ${n[1].MSWD.toFixed(2)}, ∑{sup|39}Ar = ${n[1].Ar39.toFixed(2)}%
χ{sup|2} = ${n[1].Chisq.toFixed(2)}, p = `+n[1].Pvalue.toFixed(2)),"Standard"===sampleComponents[0].sample.type&&(i.text2.text=`WMJ = ${n[1].F.toFixed(8)} ± ${n[1].sF.toFixed(8)} 
n = ${n[1].Num}, MSWD = ${n[1].MSWD.toFixed(2)}
χ{sup|2} = ${n[1].Chisq.toFixed(2)}, p = `+n[1].Pvalue.toFixed(2)),"Air"===sampleComponents[0].sample.type)&&(i.text2.text=""),i.text2.text)}}],animation:a,animationDuration:500};return e.setOption(t),e}function getDegasPatternEchart(e,t,a){let i=sampleComponents[t];return e.setOption({title:{show:!0,text:i.title.text,left:"center",top:"6%",textStyle:{color:i.title.color,fontWeight:i.title.font_weight,fontFamily:i.title.font_family,fontSize:i.title.font_size},triggerEvent:!0,z:0},grid:{show:!1,borderWidth:1,borderColor:"#222",z:100,top:"5%",left:"8%",bottom:"5%",right:"1%"},legend:{top:0},xAxis:[{name:"Sequence",type:"category",nameLocation:"middle",nameGap:25,axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}},axisLabel:{showMaxLabel:!1,color:"#222"},axisTick:{inside:i.xaxis.ticks_inside},nameTextStyle:{fontSize:16,fontFamily:"Microsoft Sans Serif",rich:{sub:{verticalAlign:"bottom",fontSize:10,fontFamily:"Microsoft Sans Serif"},sup:{verticalAlign:"top",fontSize:10,fontFamily:"Microsoft Sans Serif"}}}},{splitLine:{show:!1},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}}}],yAxis:[{name:"Argon Isotopes (%)",type:"value",nameLocation:"middle",nameGap:50,axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}},axisLabel:{showMaxLabel:!0,color:"#222"},axisTick:{inside:i.xaxis.ticks_inside},nameTextStyle:{fontSize:16,fontFamily:"Microsoft Sans Serif",rich:{sub:{verticalAlign:"bottom",fontSize:10,fontFamily:"Microsoft Sans Serif"},sup:{verticalAlign:"top",fontSize:10,fontFamily:"Microsoft Sans Serif"}}}},{splitLine:{show:!1},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}}}],series:i.data.map((e,t)=>{let a=i.info[t]?e:[];return a=a.map((e,t)=>[t+1,e]),{name:["Ar36a","Ar37Ca","Ar38Cl","Ar39K","Ar40r","Ar36","Ar37","Ar38","Ar39","Ar40"][t],type:"line",symbolSize:6,z:2,data:a,silent:!0,lineStyle:{width:1,type:"solid"},itemStyle:{borderColor:"#222",borderWidth:2,opacity:.8}}}),animation:a,animationDuration:500}),e}function getAgeDistributionEchart(e,t,a){let i=sampleComponents[t];return e.setOption({title:{show:i.title.show,text:i.title.text,left:"center",top:"6%",textStyle:{color:i.title.color,fontWeight:i.title.font_weight,fontFamily:i.title.font_family,fontSize:i.title.font_size},triggerEvent:!0,z:0},grid:{show:!1,borderWidth:1,borderColor:"#222",z:100,top:"5%",left:"8%",bottom:"5%",right:"1%"},legend:{top:0,data:[{name:"Age Histogram",itemStyle:{color:i.set1.color},icon:"path://M 37.324299,21.721424 h 3.262378 V 36.67212 h -3.262378 z M 24.005784,9.4330969 h 3.239762 V 36.660812 h -3.239762 z M 10.676947,17.663985 h 3.23779 v 18.995841 h -3.23779 z"},{name:"Age KDE",itemStyle:{color:"none",borderWidth:2,borderColor:i.set2.color},icon:"path://M 1.5520654,44.012985 c 0,0 6.2442905,0.450416 7.9538597,-5.673277 C 12.855863,26.340201 14.068504,8.2787213 15.832858,8.2581363 c 1.934649,-0.02257 3.759255,22.0511597 7.050013,30.3454467 2.219128,5.593265 11.354467,8.15283 14.371339,-0.25328 4.941435,-13.768644 10.816686,-9.276938 13.283894,0.439755"},{name:"Age Bar",itemStyle:{color:i.set3.color},icon:"path://M 20.015251,37.758931 v 3.262378 H 5.0645552 v -3.262378 z M 40.854715,24.429108 v 3.262378 H 19.030694 v -3.262378 z M 47.452914,11.099285 v 3.262378 H 32.502218 v -3.262378 z"},{name:"Text for Set 1",itemStyle:{color:i.text1.color},icon:"path://M344.1 42.65l0 23.6 -16.07 0 0 45.5c0,9.24 0.14,14.61 0.46,16.13 0.31,1.52 1,2.78 2.11,3.79 1.08,0.97 2.4,1.48 3.96,1.48 2.19,0 5.33,-0.94 9.46,-2.85l1.96 23.09c-5.44,2.96 -11.6,4.44 -18.49,4.44 -4.22,0 -8.01,-0.9 -11.4,-2.71 -3.39,-1.8 -5.87,-4.15 -7.44,-7 -1.6,-2.89 -2.68,-6.75 -3.31,-11.65 -0.49,-3.46 -0.74,-10.46 -0.74,-21.04l0 -49.18 -10.77 0 0 -23.6 10.77 0 0 -22.3 23.42 -17.54 0 39.84 16.07 0zm-156.49 112.36l31.97 -57.88 -30.61 -54.48 28.61 0 15.67 30.89 16.64 -30.89 27.47 0 -30.07 53.22 32.8 59.14 -28.58 0 -18.27 -34.82 -18.18 34.82 -27.47 0zm-41.94 -35.5l23.43 4.98c-2.99,10.86 -7.75,19.12 -14.22,24.82 -6.5,5.67 -14.62,8.52 -24.34,8.52 -15.42,0 -26.85,-6.39 -34.23,-19.16 -5.84,-10.25 -8.78,-23.17 -8.78,-38.79 0,-18.62 3.85,-33.23 11.51,-43.77 7.67,-10.57 17.38,-15.84 29.12,-15.84 13.17,0 23.57,5.52 31.21,16.56 7.61,11.04 11.26,27.96 10.91,50.77l-58.65 0c0.17,8.8 2.05,15.66 5.67,20.57 3.59,4.91 8.09,7.36 13.45,7.36 3.68,0 6.75,-1.26 9.23,-3.79 2.51,-2.52 4.39,-6.6 5.67,-12.23zm-109.42 35.5l0 -128.81 -36.25 0 0 -26.2 97.12 0 0 26.2 -36.08 0 0 128.81 -24.8 0zm110.79 -65.6c-0.17,-8.62 -1.91,-15.19 -5.24,-19.67 -3.33,-4.51 -7.38,-6.75 -12.17,-6.75 -5.1,0 -9.32,2.38 -12.65,7.11 -3.33,4.73 -4.96,11.19 -4.9,19.31l34.97 0z"}]},xAxis:[{name:i.xaxis.title.text,type:"value",nameLocation:"middle",nameGap:25,min:i.xaxis.min,max:i.xaxis.max,axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}},splitLine:{show:i.xaxis.show_splitline},axisLabel:{showMaxLabel:!1,color:"#222"},axisTick:{inside:i.xaxis.ticks_inside},nameTextStyle:{fontSize:16,fontFamily:"Microsoft Sans Serif",rich:{sub:{verticalAlign:"bottom",fontSize:10,fontFamily:"Microsoft Sans Serif"},sup:{verticalAlign:"top",fontSize:10,fontFamily:"Microsoft Sans Serif"}}}},{splitLine:{show:!1},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}}},{id:"xaxis_for_text",type:"value",show:!1,min:0,max:100,position:"bottom"}],yAxis:[{name:i.yaxis.title.text,type:"value",nameLocation:"middle",nameGap:50,min:i.yaxis.min,max:i.yaxis.max,axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}},splitLine:{show:i.yaxis.show_splitline},axisLabel:{showMaxLabel:!1,color:"#222"},axisTick:{inside:i.yaxis.ticks_inside},nameTextStyle:{fontSize:16,fontFamily:"Microsoft Sans Serif",rich:{sub:{verticalAlign:"bottom",fontSize:10,fontFamily:"Microsoft Sans Serif"},sup:{verticalAlign:"top",fontSize:10,fontFamily:"Microsoft Sans Serif"}}}},{id:"KDE Yaxis",type:"value",min:0,max:function(e){return i.set2.band_maximize?e.max*(i.yaxis.max-i.yaxis.min)/Math.max(...i.set1.data[1]):null},splitLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#222",width:1}}},{id:"yaxis_for_text",type:"value",show:!1,min:0,max:100,position:"left"}],series:[{name:"Age Histogram",data:transpose(i.set1.data),type:"bar",barWidth:"100%",encode:{x:0,y:1},z:i.set1.index,yAxisIndex:0,bargap:i.set1.bin_gap,itemStyle:{color:i.set1.color,borderColor:i.set1.border_color,opacity:i.set1.opacity,borderType:i.set1.line_type,borderWidth:i.set1.border_width},label:{show:i.set1.label.show,position:"top",formatter:function(e){return 0===e.data[1]?"":`${e.data[1]}
${e.data[2][0]}~`+e.data[2][1]},color:i.set1.label.color,opacity:1}},{name:"Age KDE",data:transpose(i.set2.data),type:"line",z:i.set2.index,symbolSize:i.set2.symbol_size,symbol:i.set2.symbol,yAxisIndex:1,triggerLineEvent:!0,lineStyle:{color:i.set2.color,type:i.set2.line_type,width:i.set2.line_width,opacity:i.set2.opacity}},{name:"Age Bar",type:"custom",data:getAgeBarData(i.set3.data.slice(0,2)),itemStyle:{color:i.set3.color,borderWidth:i.set3.border_width,borderColor:i.set3.border_color,borderType:i.set3.border_type},renderItem:renderAgeBarItem,label:{show:i.set3.label.show,formatter:""}},{id:"Text for Set 1",name:"Text for Set 1",yAxisIndex:2,xAxisIndex:2,type:"scatter",symbol:"circle",data:[i.text1.pos],encode:{x:0,y:1},itemStyle:{color:"none"},label:{show:i.text1.show,position:"inside",color:i.text1.color,fontSize:i.text1.font_size,fontFamily:i.text1.font_family,fontWeight:i.text1.font_weight,rich:rich_format,formatter:i.text1.text}}],animation:a,animationDuration:500}),e}function getScientificCounting(o){if(0===o)return"0";if(!(1e5<=Math.abs(o)||Math.abs(o)<=1e-5))return o;if(0<(o+"").indexOf("e"))return(o+"").replace(/e/,"E");{var s,l=o.toString();let t=1,a=0,i=0,n=1;for(let e=0;e<l.length;e++)(n="."===l[e]?0:n)?a++:i++;if(Math.abs(o)<1){for(let e=2;e<l.length;e++)if("0"===l[e])t++;else if("."!==l[e])break;let e=parseFloat(o);return(e=(e*=Math.pow(10,t)).toFixed(1)).toString()+"e-"+t}if(1<a){s=a-1;let e=parseFloat(o);return e/=Math.pow(10,s),(e=1<i?e.toFixed(1):e).toString()+"e"+s}}}function getChartInterval(e,t){t.xaxis.split_number=e._model._componentsMap.get("xAxis")[0].axis.getTicksCoords().length-1,t.yaxis.split_number=e._model._componentsMap.get("yAxis")[0].axis.getTicksCoords().length-1,t.xaxis.interval=e._model._componentsMap.get("xAxis")[0].axis.scale.getInterval(),t.yaxis.interval=e._model._componentsMap.get("yAxis")[0].axis.scale.getInterval()}function change_selection(t,e,a=0){if(!((t-=a)<0||!e in{set1:0,set2:1,set3:2})){let i={set1:[...sampleComponents.figure_2.set1.data],set2:[...sampleComponents.figure_2.set2.data],set3:[...sampleComponents.figure_2.set3.data]};if(i[e].includes(t))i[e]=i[e].filter(function(e){return e!==t}),i.set3.push(t);else{for(var[n,o]of Object.entries(i))o.includes(t)&&(i[n]=o.filter(function(e){return e!==t}));i[e].push(t)}for(var[s,l]of Object.entries(i))i[s]=[...l].sort((e,t)=>e-t);["figure_2","figure_3","figure_4","figure_5","figure_6","figure_7"].forEach(e=>{for(var[t,a]of Object.entries(i))sampleComponents[e][t].data=[...a]}),sampleComponents[7].data=sampleComponents[7].data.map((e,t)=>(e[2]=i.set1.includes(t)?1:i.set2.includes(t)?2:"",e)),sampleComponents[0].results.selection=dict_update(sampleComponents[0].results.selection,{0:{data:i.set1},1:{data:i.set2},2:{data:i.set3}})}}function re_plot_isochrons(e={}){var{calc_figure_2:e=!0,calc_figure_3:t=!0,calc_figure_4:a=!1,calc_figure_5:z=!1,calc_figure_6:R=!1,calc_figure_7:B=!1}=e;let i,n,o,s,l,r,c,E,O,m,q,W,p,d,u,g,h,x,f,y,b,_,w,v,S,C,j,$,k,P,T,F,N,I,L;var M={set1:0,set2:1,set3:2};let D,A;e&&(i="figure_2",D=[sampleComponents[i].xaxis.min,sampleComponents[i].xaxis.max],A=[sampleComponents[i].yaxis.min,sampleComponents[i].yaxis.max],n="set1",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[$,k,P,T]=[p,d,u,g],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[],n="set2",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[$,k,P,T]=[p,d,u,g],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[]),t&&(i="figure_3",D=[sampleComponents[i].xaxis.min,sampleComponents[i].xaxis.max],A=[sampleComponents[i].yaxis.min,sampleComponents[i].yaxis.max],n="set1",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[$,k]=[1/p,Math.abs(d)/p**2],[P,T]=york2(r,c,s,l,m).slice(0,2),[P,T]=[1/P,Math.abs(T)/P**2],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[],n="set2",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[$,k]=[1/p,Math.abs(d)/p**2],[P,T]=york2(r,c,s,l,m).slice(0,2),[P,T]=[1/P,Math.abs(T)/P**2],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[]),a&&(i="figure_4",D=[sampleComponents[i].xaxis.min,sampleComponents[i].xaxis.max],A=[sampleComponents[i].yaxis.min,sampleComponents[i].yaxis.max],n="set1",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[$,k,P,T]=[p,d,u,g],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[],n="set2",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[$,k,P,T]=[p,d,u,g],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[]),z&&(i="figure_5",D=[sampleComponents[i].xaxis.min,sampleComponents[i].xaxis.max],A=[sampleComponents[i].yaxis.min,sampleComponents[i].yaxis.max],n="set1",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[$,k]=[1/p,Math.abs(d)/p**2],[P,T]=york2(r,c,s,l,m).slice(0,2),[P,T]=[1/P,Math.abs(T)/P**2],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[],n="set2",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[$,k]=[1/p,Math.abs(d)/p**2],[P,T]=york2(r,c,s,l,m).slice(0,2),[P,T]=[1/P,Math.abs(T)/P**2],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[]),R&&(i="figure_6",D=[sampleComponents[i].xaxis.min,sampleComponents[i].xaxis.max],A=[sampleComponents[i].yaxis.min,sampleComponents[i].yaxis.max],n="set1",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[P,T,$,k]=[p,d,u,g],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[],n="set2",[s,l,r,c,m]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,5),o=york2(s,l,r,c,m),sampleComponents[i][["text1","text2","text3"][M[n]]].text="",!1!==o?([p,d,u,g,y,b,_,w,f,v,S,C]=o,[P,T,$,k]=[p,d,u,g],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g}),sampleComponents[i][["line1","line2","line3"][M[n]]].data=getLinePoints(D,A,[p,u])):sampleComponents[i][["line1","line2","line3"][M[n]]].data=[]),B&&(a=(t=(e=numeric.transpose(sampleComponents[8].data))[6][0])*e[7][0]/100,i="figure_7",n="set1",[s,l,r,c,E,O,m,q,W]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,9),!1!==(o=wtd3DRegression(s,l,r,c,E,O,m,q,W))&&([p,d,u,g,h,x,j,y,f,b,_,w,v,S,C]=o,[$,k]=[(u+h*t)*(-1/p),errDiv(u+h*t,errAdd(g,errMul(h,x,t,a)),-p,d)],[P,T]=[p,d],[P,T]=[1/P,Math.abs(T)/P**2],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g,S:j,m2:h,sm2:x})),n="set2",[s,l,r,c,E,O,m,q,W]=arr_slice(sampleComponents[i].data,sampleComponents[i][n].data).slice(0,9),!1!==(o=wtd3DRegression(s,l,r,c,E,O,m,q,W))&&([p,d,u,g,h,x,j,y,f,b,_,w,v,S,C]=o,[$,k]=[(u+h*t)*(-1/p),errDiv(u+h*t,errAdd(g,errMul(h,x,t,a)),-p,d)],[P,T]=[p,d],[P,T]=[1/P,Math.abs(T)/P**2],[F,N,I,L]=calc_age(P,T),dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:v,F:P,MSWD:y,Pvalue:S,R2:f,abs_conv:b,age:F,conv:b,initial:$,iter:_,k:p,m1:u,mag:w,rs:C,s1:N,s2:I,s3:L,sF:T,sinitial:k,sk:d,sm1:g,S:j,m2:h,sm2:x})),n="set3",dict_update(sampleComponents[0].results.isochron[i][M[n]],{Chisq:NaN,F:NaN,MSWD:NaN,Pvalue:NaN,R2:NaN,abs_conv:NaN,age:NaN,conv:NaN,initial:NaN,iter:NaN,k:NaN,m1:NaN,mag:NaN,rs:NaN,s1:NaN,s2:NaN,s3:NaN,sF:NaN,sinitial:NaN,sk:NaN,sm1:NaN,S:NaN,m2:NaN,sm2:NaN})),setConsoleText("Replot isochron completed.")}function re_plot_age_spectra(){var e=numeric.transpose(sampleComponents[6].data),t=(sampleComponents.figure_1.data=ageSpectraPoints(e[9],e[4],e[5]),(e,a)=>e.map((e,t)=>{if(t>=Math.min(...a)&&t<=Math.max(...a))return e}).filter((e,t)=>void 0!==e));let a,i,n,o,s,l,r,c,m,p,d;try{d=numeric.transpose(t(numeric.transpose([e[2],e[3]]),sampleComponents.figure_2.set1.data)),[a,i,r,c,m,p]=weightedMeanValue(d[0],d[1]),[n,o,s,l]=calc_age(a,i),dict_update(sampleComponents[0].results.age_spectra[0],{Ar39:arr_sum(t(e[9],sampleComponents.figure_2.set1.data)),F:a,MSWD:c,Pvalue:p,Num:r,age:n,s1:o,s2:s,s3:l,sF:i,rs:NaN,Chisq:m})}catch(e){}try{d=numeric.transpose(t(numeric.transpose([e[2],e[3]]),sampleComponents.figure_2.set2.data)),[a,i,r,c,m,p]=weightedMeanValue(d[0],d[1]),[n,o,s,l]=calc_age(a,i),dict_update(sampleComponents[0].results.age_spectra[1],{Ar39:arr_sum(t(e[9],sampleComponents.figure_2.set2.data)),F:a,MSWD:c,Pvalue:p,Num:r,age:n,s1:o,s2:s,s3:l,sF:i,rs:NaN,Chisq:m})}catch(e){}const u=numeric.transpose(sampleComponents[8].data);t=u[117];const g=t.map((e,t)=>0===Number(e)?sampleComponents[0].results.isochron.figure_3[0].initial:1===Number(e)?sampleComponents[0].results.isochron.figure_2[0].initial:u[118][t]),h=t.map((e,t)=>0===Number(e)?sampleComponents[0].results.isochron.figure_3[0].sinitial:1===Number(e)?sampleComponents[0].results.isochron.figure_2[0].sinitial:u[119][t]),x=t.map((e,t)=>0===Number(e)?sampleComponents[0].results.isochron.figure_3[1].initial:1===Number(e)?sampleComponents[0].results.isochron.figure_2[1].initial:u[120][t]),f=t.map((e,t)=>0===Number(e)?sampleComponents[0].results.isochron.figure_3[1].sinitial:1===Number(e)?sampleComponents[0].results.isochron.figure_2[1].sinitial:u[121][t]);var t=numeric.transpose(sampleComponents[4].data),y=numeric.transpose(sampleComponents[3].data);const b=y[10],_=y[11],w=t[2],v=t[3],S=t[32],C=t[33],$=t[22],k=t[23];let P,T,F;try{F="set1",d=b.map((e,t)=>calcAr40r_39k(g[t],h[t],w[t],v[t],$[t],k[t],b[t],_[t],S[t],C[t])),T=numeric.transpose(b.map((e,t)=>calc_age(...d[t],t))),P=ageSpectraPoints(e[9],T[0],T[2],sampleComponents.figure_2[F].data),sampleComponents.figure_1[F].data=P,d=numeric.transpose(d.map((e,t)=>{if(t>=Math.min(...sampleComponents.figure_2[F].data)&&t<=Math.max(...sampleComponents.figure_2[F].data))return e}).filter((e,t)=>void 0!==e)),[a,i,r,c,m,p]=weightedMeanValue(d[0],d[1]),[n,o,s,l]=calc_age(a,i),dict_update(sampleComponents[0].results.age_plateau[0],{Ar39:P[P.length-1][0]-P[0][0],F:a,MSWD:c,Pvalue:p,Num:r,age:n,s1:o,s2:s,s3:l,sF:i,rs:NaN,Chisq:m}),sampleComponents.figure_1.text1.text=""}catch(e){}try{F="set2",d=b.map((e,t)=>calcAr40r_39k(x[t],f[t],w[t],v[t],$[t],k[t],b[t],_[t],S[t],C[t])),T=numeric.transpose(b.map((e,t)=>calc_age(...d[t],t))),P=ageSpectraPoints(e[9],T[0],T[2],sampleComponents.figure_2[F].data),sampleComponents.figure_1[F].data=P,d=numeric.transpose(d.map((e,t)=>{if(t>=Math.min(...sampleComponents.figure_2[F].data)&&t<=Math.max(...sampleComponents.figure_2[F].data))return e}).filter((e,t)=>void 0!==e)),[a,i,r,c,m,p]=weightedMeanValue(d[0],d[1]),[n,o,s,l]=calc_age(a,i),dict_update(sampleComponents[0].results.age_plateau[1],{Ar39:P[P.length-1][0]-P[0][0],F:a,MSWD:c,Pvalue:p,Num:r,age:n,s1:o,s2:s,s3:l,sF:i,rs:NaN,Chisq:m}),sampleComponents.figure_1.text2.text=""}catch(e){}}function calc_age(e,t,a=!0,i=0,n=!0){var o,s,l,r,c,m,p,d,u,g,h,x,f,y,b,_,w,v,S,C=numeric.transpose(sampleComponents[8].data),$=C[69],k=arr_multiply_by_number(arr_mul(C[70],$),.01),P=C[36],T=arr_multiply_by_number(arr_mul(C[37],P),.01);return!a||(b=C[38],_=arr_multiply_by_number(arr_mul(C[39],b),.01),w=C[40],v=arr_multiply_by_number(arr_mul(C[41],w),.01),S=C[50],o=arr_multiply_by_number(arr_mul(C[51],S),.01),s=C[52],l=arr_multiply_by_number(arr_mul(C[53],s),.01),r=C[54],c=arr_multiply_by_number(arr_mul(C[55],r),.01),m=C[61],p=arr_multiply_by_number(arr_mul(C[62],m),.01),d=C[83],u=arr_multiply_by_number(arr_mul(C[84],d),.01),g=C[87],h=arr_multiply_by_number(arr_mul(C[88],g),.01),x=C[89],f=arr_multiply_by_number(arr_mul(C[90],x),.01),y=C[85],C=arr_multiply_by_number(arr_mul(C[86],y),.01),b={L:P[i],sL:T[i],Le:b[i],sLe:_[i],Lb:w[i],sLb:v[i],A:S[i],sA:o[i],Ae:s[i],sAe:l[i],Ab:r[i],sAb:c[i],t:m[i],st:p[i],J:$[i],sJ:k[i],W:d[i],sW:u[i],No:y[i],sNo:C[i],Y:g[i],sY:h[i],f:x[i],sf:f[i],Min:a},[_,w,v,S]=calcAgeMin(e,t,b),isNaN(_)&&n)?calcAgeGeneral(e,t,$[i],k[i],P[i],T[i]):[_,w,v,S]}function deepMerge(e,t){if(t.constructor===Array)return t;for(var a in t)a in e&&t[a]instanceof Object?e[a]=deepMerge(e[a],t[a]):e[a]=t[a];return e}function extendChartFuncs(o){o.addSeries=(e,t=!0)=>{var a=o.getOption().series;a.push(e),o.setOption({series:a}),t&&o.resize()},o.updateSeries=(t,a=!0)=>{var e=void 0===t.id?"":t.id,i=void 0===t.name?"":t.name;try{var n=deepMerge(o.getSeries(e,i),t);o.setOption({series:n}),a&&o.resize()}catch(e){o.addSeries(t,a)}},o.showLegend=(e=!0)=>{o.setOption({legend:{show:e}}),o.resize()},o.getSeries=(e="",t="")=>{for(var a of o.getOption().series)if((a.hasOwnProperty("id")||a.hasOwnProperty("name"))&&(a.id===e||a.name===t))return a},o.registerDrag=(i,n)=>{o.on("mousedown",{seriesId:i},function(e){var t,a=o.getSeries(i);a?.draggable&&(a=o.convertToPixel({xAxisIndex:a.xAxisIndex,yAxisIndex:a.yAxisIndex},a.data[0]),t=e.event.offsetX-a?.[0],a=e.event.offsetY-a?.[1],o.updateSeries({id:i,onDragged:!0,dragOffset:[t,a]},!1),n(e))}),o.getZr().on("mousemove",function(e){var t,a=o.getSeries(i);a?.onDragged&&(t=a.dragOffset,a=o.convertFromPixel({xAxisIndex:a.xAxisIndex,yAxisIndex:a.yAxisIndex},[e.event.zrX-t?.[0],e.event.zrY-t?.[1]]),o.updateSeries({id:i,data:[a],animation:!1},!1))}),o.getZr().on("mouseup",function(e){o.getSeries(i);o.updateSeries({id:i,onDragged:!1,animation:!1},!1)})},o.getPlotData=()=>{console.log(o);var e={},t=o._model._componentsMap;return e.xAxis=t.get("xAxis").map((e,t)=>({extent:e.axis.scale._extent,interval:e.axis.scale.getTicks().map(e=>e.value),title:e.option.name,nameLocation:e.option.nameLocation})),e.yAxis=t.get("yAxis").map((e,t)=>({extent:e.axis.scale._extent,interval:e.axis.scale.getTicks().map(e=>e.value),title:e.option.name,nameLocation:e.option.nameLocation})),e.series=t.get("series").map((a,e)=>({type:a.type,myType:a.myType,name:a.name,id:a.id,color:a.option.color,data:a.option.data.map((e,t)=>[e[a.option.encode.x],e[a.option.encode.y]]),text:a.option.myText})),e}}function splitByConsecutive(i){return i.reduce((e,t,a)=>(0!==a&&t===i[a-1]+1||(e.push([]),1<e.length&&e[e.length-1].push(...e[e.length-2])),e[e.length-1].push(t),e),[])}function handsontableRemoveRow(e,t){const i=[],n=splitByConsecutive(rows_to_delete);t.forEach(e=>{for(let a=Math.min(e.start.row,e.end.row);a<=Math.max(e.start.row,e.end.row);a++){i.push(a);let t=!1;for(let e=n.length-1;0<=e;e--)if(a>Math.max(...n[e])-n[e].length){rows_to_delete.push(a+n[e].length),t=!0;break}t||rows_to_delete.push(a)}}),rows_to_delete.sort((e,t)=>e-t),console.log("The following rows will be deleted: "+rows_to_delete);var t=sampleComponents[getCurrentTableId()],a=hot.getSourceData().filter((e,t)=>!i.includes(t));hot.updateSettings({colHeaders:t.header,data:extendData(a),columns:t.coltypes})}function exportChart(e,t,a,i=!0){let n="";return $.ajax({url:url_export_chart,type:"POST",async:!1,data:JSON.stringify({data:e,file_name:t,plot_names:a}),contentType:"application/json",success:function(e){i&&(document.getElementById("export_path_link").href=e.href,document.getElementById("export_path_link").click(),document.getElementById("export_path_link").href=""),n=e.href}}),n}