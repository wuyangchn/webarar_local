function arr_sum(r){return Array.isArray(r)?r.reduce((r,a)=>r+a,0):(console.error("array is not an array"),r)}function arr_sub(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>0===t?a:r-a,0))}function arr_add(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>r+a,0))}function arr_div(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>0===t?a:r/a,1))}function arr_mul(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>0===t?a:r*a,1))}function arr_pow(r,a){return r.map(r=>Array.isArray(r)?arr_pow(r,a):Math.pow(r,a))}function arr_multiply_by_number(r,a){return Array.isArray(r)?r.map(r=>arr_multiply_by_number(r,a)):r*a}function arr_mean(r){return 0===r.length?NaN:arr_sum(r)/r.length}function arr_diag(r){return r.map((r,a)=>r[a])}function arr_slice(r,t,e=0,u=!0){var a=[];return 0<(a=0<t.length?numeric.transpose(r).filter((a,r)=>{if(!t.includes(r-e))return!1;if(u)for(let r=0;r<a.length;r++)if("string"==typeof a[r]||a[r]instanceof String)return!1;return!0}):a).length?numeric.transpose(a):[[],[],[],[],[],[],[],[],[],[],[],[]]}function dict_update(r,a={}){for(var[t,e]of Object.entries(a))e.constructor===Object?dict_update(r[t],e):r[t]=e;return r}function errAdd(...r){return Math.sqrt(r.reduce((r,a)=>r+a**2,0))}function errMul(r,a,t,e){return Math.sqrt(t**2*a**2+r**2*e**2)}function errDiv(r,a,t,e){return Math.sqrt(1/t**2*a**2+r**2*e**2/t**4)}function linest(e,u,...n){const r=[];for(let t=0;t<e.length;t++){let a=null!==e[t]&&null!==u[t];for(let r=0;r<n.length;r++)a=a&&null!==n[r][t];a&&r.push(t)}if(e=r.map(r=>e[r]),u=r.map(r=>u[r]),0===(_=0===(n=n.map(a=>r.map(r=>a[r]))).length?numeric.transpose([[...Array(u.length).fill(1)],u]):numeric.transpose([[...Array(u.length).fill(1)],u,...n])).length)return!1;var a=_.length,t=_[0].length,m=numeric.transpose([e]);let s;try{s=numeric.inv(numeric.dot(numeric.transpose(_),_))}catch(r){throw new Error("The determinant of the given matrix must not be zero")}console.log(_),console.log(m),console.log(s),m=numeric.dot(s,numeric.dot(numeric.transpose(_),m));const i=numeric.dot(_,m);var _=arr_pow(arr_sub(numeric.transpose(i)[0],e),2),l=arr_pow(i.map(r=>r-arr_mean(numeric.transpose(i)[0])),2),_=arr_sum(_),p=(l=arr_sum(l))+_,_=_/(a-t),a=arr_pow(arr_multiply_by_number(arr_diag(s),_),.5);const o=numeric.transpose(m)[0];return t=arr_div(a,o),[o[0],a[0],100*t[0],0!==p?l/p:1/0,_,o,a,function(...r){const a=[[...Array(r[0].length).fill(1)],...r];return a[0].map((r,t)=>arr_sum(a.map((r,a)=>r[t]*o[a])))},_]}function york2(a,t,e,u,n,O=0,r=.001,m=100){const s=a.length;if(s<3)return!1;let i=[],_=[],l=[],p=[],o=[];for(let r=0;r<s;r++)isFinite(a[r])&&!isNaN(a[r])&&isFinite(t[r])&&!isNaN(t[r])&&isFinite(e[r])&&!isNaN(e[r])&&isFinite(u[r])&&!isNaN(u[r])&&isFinite(n[r])&&!isNaN(n[r])&&(i.push(a[r]),_.push(t[r]),l.push(e[r]),p.push(u[r]),o.push(n[r]));const c=_.map(r=>1/r**2),h=p.map(r=>1/r**2),f=(t,r)=>c.map((r,a)=>r*h[a]/(t**2*h[a]+r-2*t*o[a]*(r*h[a])**.5)),g=(r,a)=>{const e=f(r);return i.reduce((r,a,t)=>r+a*e[t],0)/e.reduce((r,a)=>r+a,0)},d=(r,a)=>{const e=f(r);return l.reduce((r,a,t)=>r+a*e[t],0)/e.reduce((r,a)=>r+a,0)};let[M,b,v,y,A]=[0,0,0,0,1e10];if(!(x=linest(l,i)))return!1;[M,b,v,y]=[x[5][0],x[6][0],x[5][1],x[6][1]];let q=d(v)-v*g(v),N=0,w=1,L=1;for(;Math.abs(v-A)>=Math.abs(v*r/100);){A=v;const E=i.map((r,a)=>r-g(v,q)),J=l.map((r,a)=>r-d(v,q));var j=f(v,q).map((r,a)=>r**2*J[a]*(E[a]/h[a]+v*J[a]/c[a]-o[a]*(J[a]+v*E[a])/(c[a]*h[a])**.5)),F=f(v,q).map((r,a)=>r**2*E[a]*(E[a]/h[a]+v*J[a]/c[a]-o[a]*(J[a]+v*E[a])/(c[a]*h[a])**.5)),j=(v=j.reduce((r,a)=>r+a,0)/F.reduce((r,a)=>r+a,0),q=d(v,q)-v*g(v,q),E.map((r,a)=>r**2*f(v,q)[a]).reduce((r,a)=>r+a,0)),F=i.map((r,a)=>r**2*f(v,q)[a]).reduce((r,a)=>r+a,0);if(y=1/j**.5,b=(F/f(v,q).reduce((r,a)=>r+a,0))**.5*y,w=((e,u)=>f(e).reduce((r,a,t)=>r+a*(l[t]-e*i[t]-u)**2,0))(v,q)/(s-2),L=1<w?w**.5:1,y*=L,b*=L,++N>=m)break}const P=i.map((r,a)=>q+v*r);var S,k,x=P.map((r,a)=>(r-l[a])**2),D=P.map((r,a)=>(r-P.reduce((r,a)=>r+a,0)/s)**2),x=x.reduce((r,a)=>r+a,0),D=0!==(x=(D=D.reduce((r,a)=>r+a,0))+x)?D/x:1/0,x=w*(s-2),W=1-jStat.chisquare.cdf(x,s-2),Y=100*arr_mean((S=v,k=q,f(S).map((r,a)=>(1/r)**.5/Math.abs(l[a]-S*i[a]-k))));return[q,b,v,y,w,Math.abs(v-A),N,L,D,x,W,Y]}function wtd3DRegression(W,Y,z,C,G,I,R,T,V,a=1,s=.001,or=100){Number.isInteger(a)&&1<a&&(Y=Y.map(r=>r/a),C=C.map(r=>r/a),I=I.map(r=>r/a));var r=W.length;if(r<=3)return!1;let cr=0;const B=(t,e)=>W.map((r,a)=>1/(t**2*Y[a]**2+e**2*C[a]**2+I[a]**2+2*t*e*R[a]*Y[a]*C[a]-2*t*T[a]*Y[a]*I[a]-2*e*V[a]*C[a]*I[a])),H=(e,u)=>W.reduce((r,a,t)=>r+B(e,u)[t]*a,0)/arr_sum(B(e,u)),K=(e,u)=>z.reduce((r,a,t)=>r+B(e,u)[t]*a,0)/arr_sum(B(e,u)),hr=(e,u)=>G.reduce((r,a,t)=>r+B(e,u)[t]*a,0)/arr_sum(B(e,u));var fr=(t,e,u)=>arr_sum(B(t,e).map((r,a)=>r*(t*W[a]+e*z[a]+u-G[a])**2));let[Q,U,,,,[,X,Z],[,$,rr]]=linest(G,W,z).slice(0,7),ar=1e10,tr=1,er=1e3;for(;Math.abs(X-ar)>=Math.abs(X*s/100);){ar=X;let t=W.map((r,a)=>r-H(X,Z)),e=z.map((r,a)=>r-K(X,Z)),u=G.map((r,a)=>r-hr(X,Z)),n=B(X,Z).map((r,a)=>r*((X*Y[a]**2+Z*R[a]*Y[a]*C[a]-T[a]*Y[a]*I[a])*(u[a]-Z*e[a])+(X*Z*R[a]*Y[a]*C[a]+Z**2*C[a]**2-X*T[a]*Y[a]*I[a]-2*Z*V[a]*C[a]*I[a]+I[a]**2)*t[a])),m=B(X,Z).map((r,a)=>r*((Z*C[a]**2+X*R[a]*Y[a]*C[a]-V[a]*C[a]*I[a])*(u[a]-X*t[a])+(X*Z*R[a]*Y[a]*C[a]+X**2*Y[a]**2-Z*V[a]*C[a]*I[a]-2*X*T[a]*Y[a]*I[a]+I[a]**2)*e[a]));var gr=(arr_sum(arr_mul(B(X,Z),n,u))*arr_sum(arr_mul(B(X,Z),m,e))-arr_sum(arr_mul(B(X,Z),n,e))*arr_sum(arr_mul(B(X,Z),m,u)))/(lr=arr_sum(arr_mul(B(X,Z),n,t))*arr_sum(arr_mul(B(X,Z),m,e))-arr_sum(arr_mul(B(X,Z),n,e))*arr_sum(arr_mul(B(X,Z),m,t))),dr=(arr_sum(arr_mul(B(X,Z),m,u))*arr_sum(arr_mul(B(X,Z),n,t))-arr_sum(arr_mul(B(X,Z),n,u))*arr_sum(arr_mul(B(X,Z),m,t)))/(pr=arr_sum(arr_mul(B(X,Z),n,t))*arr_sum(arr_mul(B(X,Z),m,e))-arr_sum(arr_mul(B(X,Z),n,e))*arr_sum(arr_mul(B(X,Z),m,t)));let s=arr_sum(arr_mul(B(X,Z),t))/arr_sum(B(X,Z)),i=arr_sum(arr_mul(B(X,Z),e))/arr_sum(B(X,Z)),_=arr_sum(arr_mul(B(X,Z),n))/arr_sum(B(X,Z)),l=arr_sum(arr_mul(B(X,Z),m))/arr_sum(B(X,Z)),p=arr_sum(arr_mul(B(X,Z),n,t)),o=arr_sum(arr_mul(B(X,Z),m,t)),c=arr_sum(arr_mul(B(X,Z),m,e)),h=arr_sum(arr_mul(B(X,Z),n,e)),f=arr_sum(arr_mul(B(X,Z),m,u)),g=arr_sum(arr_mul(B(X,Z),n,u)),d=B(X,Z).map((r,a)=>r*(X*Z*R[a]*Y[a]*C[a]+Z**2*C[a]**2-X*T[a]*Y[a]*I[a]-2*Z*V[a]*C[a]*I[a]+I[a]**2)),M=B(X,Z).map((r,a)=>-1*X*r*(Z*C[a]**2+X*R[a]*Y[a]*C[a]-V[a]*C[a]*I[a])),b=B(X,Z).map((r,a)=>-1*Z*r*(X*Y[a]**2+Z*R[a]*Y[a]*C[a]-T[a]*Y[a]*I[a])),v=B(X,Z).map((r,a)=>r*(X*Z*R[a]*Y[a]*C[a]+X**2*Y[a]**2-Z*V[a]*C[a]*I[a]-2*X*T[a]*Y[a]*I[a]+I[a]**2)),y=B(X,Z).map((r,a)=>r*(X*Y[a]**2+Z*R[a]*Y[a]*C[a]-T[a]*Y[a]*I[a])),A=B(X,Z).map((r,a)=>r*(Z*C[a]**2+X*R[a]*Y[a]*C[a]-V[a]*C[a]*I[a])),q=B(X,Z).map((r,a)=>1-r/arr_sum(B(X,Z))),N=B(X,Z).map((r,a)=>1-r/arr_sum(B(X,Z))),w=B(X,Z).map((r,a)=>1-r/arr_sum(B(X,Z))),L=B(X,Z).map((r,a)=>-1*r**2*(2*X*Y[a]**2+2*Z*R[a]*Y[a]*C[a]-2*T[a]*Y[a]*I[a])),j=B(X,Z).map((r,a)=>-1*r**2*(2*Z*C[a]**2+2*X*R[a]*Y[a]*C[a]-2*V[a]*C[a]*I[a])),F=B(X,Z).map((r,a)=>r*q[a]*(X*(p*e[a]*M[a]+c*(t[a]*d[a]+n[a])-o*e[a]*d[a]-h*(m[a]+t[a]*M[a]))-(g*e[a]*M[a]+c*u[a]*d[a])+(f*e[a]*d[a]+h*u[a]*M[a]))),P=B(X,Z).map((r,a)=>r*N[a]*(X*(p*(m[a]+e[a]*v[a])+c*t[a]*b[a]-o*(n[a]+e[a]*b[a])-h*t[a]*v[a])-(g*(m[a]+e[a]*v[a])+c*u[a]*b[a])+(f*(n[a]+e[a]*b[a])+h*u[a]*v[a]))),S=B(X,Z).map((r,a)=>r*w[a]*(X*(p*e[a]*A[a]+c*t[a]*y[a]-o*e[a]*y[a]-h*t[a]*A[a])-(g*e[a]*A[a]+c*(n[a]+u[a]*y[a]))+(f*e[a]*y[a]+h*(m[a]+u[a]*A[a]))));var ur=t.map((r,a)=>L[a]*n[a]*t[a]),nr=t.map((r,a)=>L[a]*m[a]*e[a]),mr=t.map((r,a)=>L[a]*m[a]*t[a]),sr=t.map((r,a)=>L[a]*n[a]*e[a]),ir=t.map((r,a)=>L[a]*n[a]*u[a]),_r=t.map((r,a)=>L[a]*m[a]*u[a]),lr=lr+X*(arr_sum(ur)*c+arr_sum(nr)*p-arr_sum(mr)*h-arr_sum(sr)*o)-(arr_sum(ir)*c+arr_sum(nr)*g-arr_sum(_r)*h-arr_sum(sr)*f);let k=B(X,Z).map((r,a)=>r*q[a]*(Z*(p*e[a]*M[a]+c*(n[a]+t[a]*d[a])-o*e[a]*d[a]-h*(m[a]+t[a]*M[a]))-(f*(n[a]+t[a]*d[a])+p*u[a]*M[a])+(g*(m[a]+t[a]*M[a])+o*u[a]*d[a]))),x=B(X,Z).map((r,a)=>r*N[a]*(Z*(p*(m[a]+e[a]*v[a])+c*t[a]*b[a]-o*(n[a]+e[a]*b[a])-h*t[a]*v[a])-(f*(t[a]*b[a])+p*(u[a]*v[a]))+(g*(t[a]*v[a])+o*(u[a]*b[a])))),D=B(X,Z).map((r,a)=>r*w[a]*(Z*(p*e[a]*A[a]+c*(t[a]*y[a])-o*e[a]*y[a]-h*(t[a]*A[a]))-(f*(t[a]*y[a])+p*(m[a]+u[a]*A[a]))+(g*(t[a]*A[a])+o*(n[a]+u[a]*y[a]))));var ur=t.map((r,a)=>j[a]*n[a]*t[a]),mr=t.map((r,a)=>j[a]*m[a]*e[a]),ir=t.map((r,a)=>j[a]*m[a]*t[a]),nr=t.map((r,a)=>j[a]*n[a]*e[a]),_r=t.map((r,a)=>j[a]*n[a]*u[a]),sr=t.map((r,a)=>j[a]*m[a]*u[a]),pr=pr+Z*(arr_sum(ur)*c+arr_sum(mr)*p-arr_sum(ir)*h-arr_sum(nr)*o)-(arr_sum(sr)*p+arr_sum(ur)*f-arr_sum(_r)*o-arr_sum(ir)*g),mr=arr_sum(t.map((r,a)=>F[a]**2*Y[a]**2+P[a]**2*C[a]**2+S[a]**2*I[a]**2+2*R[a]*Y[a]*C[a]*F[a]*P[a]+2*T[a]*Y[a]*I[a]*F[a]*S[a]+2*V[a]*C[a]*I[a]*P[a]*S[a])),nr=arr_sum(t.map((r,a)=>k[a]**2*Y[a]**2+x[a]**2*C[a]**2+D[a]**2*I[a]**2+2*R[a]*Y[a]*C[a]*k[a]*x[a]+2*T[a]*Y[a]*I[a]*k[a]*D[a]+2*V[a]*C[a]*I[a]*x[a]*D[a]));let E=B(X,Z).map((r,a)=>-1*X*r/arr_sum(B(X,Z))-F[a]*(2*_-2*s+H(X,Z))-k[a]*(2*l-2*i+K(X,Z))),J=B(X,Z).map((r,a)=>-1*Z*r/arr_sum(B(X,Z))-P[a]*(2*_-2*s+H(X,Z))-x[a]*(2*l-2*i+K(X,Z))),O=B(X,Z).map((r,a)=>r/arr_sum(B(X,Z))-S[a]*(2*_-2*s)-D[a]*(2*l-2*i));if(sr=arr_sum(E.map((r,a)=>E[a]**2*Y[a]**2+J[a]**2*C[a]**2+O[a]**2*I[a]**2+2*R[a]*Y[a]*C[a]*E[a]*J[a]+2*T[a]*Y[a]*I[a]*E[a]*O[a]+2*V[a]*C[a]*I[a]*J[a]*O[a])),$=Math.sqrt(mr/lr),rr=Math.sqrt(nr/pr),U=Math.sqrt(sr),er=fr(X,Z,Q)/(r-3),tr=1<er?Math.sqrt(er):1,$*=tr,rr*=tr,U*=tr,X=gr,Z=dr,Q=hr(ur=gr,_r=dr)-ur*H(ur,_r)-_r*K(ur,_r),++cr>=or)break}const t=W.map((r,a)=>Q+X*r+Z*z[a]);var e,u,i,n=t.map((r,a)=>(r-G[a])**2),m=t.map((r,a)=>(r-arr_mean(t))**2),n=arr_sum(n),m=0!==(n=(m=arr_sum(m))+n)?m/n:np.inf,n=er*(r-3),_=1-jStat.chisquare.cdf(n,r-3),l=100*arr_mean((e=X,u=Z,i=Q,B(e,u).map((r,a)=>Math.sqrt(1/r)/Math.abs(e*W[a]+u*z[a]+i-G[a]))));return[Q,U,X,$,Z,rr,fr(X,Z,Q),er,m,Math.abs(X-ar),cr,tr,n,_,l]}function calcAgeMin(r,a,t){var e=t.J,u=t.sJ,n=t.A,m=(t.sA,t.Ae),s=t.sAe,i=t.Ab,_=t.sAb,l=t.W,p=t.sW,o=t.Y,c=t.sY,h=t.f,f=t.No,g=t.sNo,d=t.L,M=(t.sL,t.Le,t.sLe,t.Lb,t.sLb,1e6*t.t),t=(t.st,h*f/((i+m)*l*o)),d=(Math.sqrt((t/h*0)**2+(t/f*g)**2+(t/(i+m))**2*(_**2+s**2)+(t/l*p)**2+(t/o*c)**2),(Math.exp(M*d)-1)/e),e=Math.sqrt((d/e)**2*u**2),u=r/d,r=Math.sqrt((a/d)**2+(r*e/d**2)**2),e=Math.sqrt((a/d)**2),d=(a=Math.exp(M/t)-1)*u+1,M=t*Math.log(d),h=(Math.log(d),(Math.log(d)*t/f)**2*g**2),f=(-1*Math.log(d)*t/n+a*u/(n*d))**2*_**2,g=(-1*Math.log(d)*t/n-i*a*u/(m**2*d))**2*s**2,_=(-1*Math.log(d)*t/l-t*a*u/(l*d))**2*p**2,n=(Math.log(d)*t/o)**2*c**2,i=(t*a/d)**2*r**2;return[M/1e6,Math.sqrt((t*a*u/(u*d))**2*e**2)/1e6,Math.sqrt((t*a*u/(u*d))**2*r**2)/1e6,Math.sqrt(0+h+f+g+_+n+i)/1e6]}function calcAgeGeneral(r,a,t,e,u,n){var m=Math.log(1+t*r)/u,a=a**2*(t/(u*(1+t*r)))**2,e=e**2*(r/(u*(1+t*r)))**2,n=n**2*(Math.log(1+t*r)/u**2)**2;return[m/1e6,Math.sqrt(a)/1e6,Math.sqrt(a+e)/1e6,Math.sqrt(a+e+n)/1e6]}function getLinePoints(a,t,e){if(!Array.isArray(e)||e.length<2)throw new Error("Coeffs should be an array with length at least 2.");var r=r=>e[0]+e[1]*r,u=r=>(r-e[0])/e[1]!=0?(r-e[0])/e[1]:null;const n=[];return[[a[0],r(a[0])],[a[1],r(a[1])],[u(t[0]),t[0]],[u(t[1]),t[1]]].forEach(r=>{a[0]<=r[0]&&r[0]<=a[1]&&t[0]<=r[1]&&r[1]<=t[1]&&n.push(r)}),n}function stepLinePoints(t,e){var r=t.length;return t=Array.from({length:r+1},(r,a)=>0===a?0:arr_sum(t.slice(0,a))),Array.from({length:2*r},(r,a)=>a%2==0?[t[a/2],e[a/2]]:[t[(a+1)/2],e[(a-1)/2]])}function ageSpectraPoints(r,a,t,e=null){var u=a.map((r,a)=>a%2==0?r-t[a]:r+t[a]),a=a.map((r,a)=>a%2==0?r+t[a]:r-t[a]),u=stepLinePoints(r,u);const n=stepLinePoints(r,a);return e=e||r.map((r,a)=>a),(a=u.map((r,a)=>[...r,n[a][1]]).filter((r,a)=>(a=Math.trunc(a/2))>=Math.min(...e)&&a<=Math.max(...e))).splice(0,0,[a[0][0],a[0][2],a[0][1]]),a.push([a[a.length-1][0],a[a.length-1][2],a[a.length-1][1]]),a}function calcAr40r_39k(r,a,t,e,u,n,m,s,i,_){return[(m=m-i-t*r)/u,errDiv(m,errAdd(s,_,errMul(t,e,r,a)),u,n)]}function weightedMeanValue(r,a,t=!0){const e=a.map(r=>1/r**2),u=arr_sum(e);var a=r.length-1,n=r.length;const m=arr_sum(r.map((r,a)=>r*e[a]/u));var s=(r=arr_sum(r.map((r,a)=>(r-m)**2*e[a])))/a,t=t?Math.sqrt(s/u):Math.sqrt(1/u),a=1-jStat.chisquare.cdf(r,a);return[m,t,n,s,r,a]}