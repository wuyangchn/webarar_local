function arr_sum(r){return Array.isArray(r)?r.reduce((r,a)=>r+a,0):(console.error("array is not an array"),r)}function arr_sub(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>0===t?a:r-a,0))}function arr_add(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>r+a,0))}function arr_div(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>0===t?a:r/a,1))}function arr_mul(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>0===t?a:r*a,1))}function arr_pow(r,a){return r.map(r=>Array.isArray(r)?arr_pow(r,a):Math.pow(r,a))}function arr_multiply_by_number(r,a){return Array.isArray(r)?r.map(r=>arr_multiply_by_number(r,a)):r*a}function arr_mean(r){return 0===r.length?NaN:arr_sum(r)/r.length}function arr_diag(r){return r.map((r,a)=>r[a])}function arr_slice(r,t,e=0,u=!0){let a=[];return 0<(a=0<t.length?numeric.transpose(r).filter((a,r)=>{if(!t.includes(r-e))return!1;if(u)for(let r=0;r<a.length;r++)if("string"==typeof a[r]||a[r]instanceof String)return!1;return!0}):a).length?numeric.transpose(a):[[],[],[],[],[],[],[],[],[],[],[],[]]}function dict_update(r,a={}){for(var[t,e]of Object.entries(a))e.constructor===Object?dict_update(r[t],e):r[t]=e;return r}function errAdd(...r){return Math.sqrt(r.reduce((r,a)=>r+a**2,0))}function errMul(r,a,t,e){return Math.sqrt(t**2*a**2+r**2*e**2)}function errDiv(r,a,t,e){return Math.sqrt(1/t**2*a**2+r**2*e**2/t**4)}function linest(r,a,...t){let e;if(0===(e=0===t.length?numeric.transpose([[...Array(a.length).fill(1)],a]):numeric.transpose([[...Array(a.length).fill(1)],a,...t])).length)return!1;var a=e.length,t=e[0].length,u=numeric.transpose([r]);let m;try{m=numeric.inv(numeric.dot(numeric.transpose(e),e))}catch(r){throw new Error("The determinant of the given matrix must not be zero")}u=numeric.dot(m,numeric.dot(numeric.transpose(e),u));const n=numeric.dot(e,u);var r=arr_pow(arr_sub(numeric.transpose(n)[0],r),2),s=arr_pow(n.map(r=>r-arr_mean(numeric.transpose(n)[0])),2),r=arr_sum(r),s=arr_sum(s),i=s+r,r=r/(a-t),a=arr_pow(arr_multiply_by_number(arr_diag(m),r),.5);const _=numeric.transpose(u)[0];t=arr_div(a,_);return[_[0],a[0],100*t[0],0!==i?s/i:1/0,r,_,a,function(...r){const a=[[...Array(r[0].length).fill(1)],...r];return a[0].map((r,t)=>arr_sum(a.map((r,a)=>r[t]*_[a])))},r]}function york2(a,t,e,u,m,O=0,r=.001,n=100){const s=a.length;if(s<3)return!1;let i=[],_=[],p=[],l=[],c=[];for(let r=0;r<s;r++)isFinite(a[r])&&!isNaN(a[r])&&isFinite(t[r])&&!isNaN(t[r])&&isFinite(e[r])&&!isNaN(e[r])&&isFinite(u[r])&&!isNaN(u[r])&&isFinite(m[r])&&!isNaN(m[r])&&(i.push(a[r]),_.push(t[r]),p.push(e[r]),l.push(u[r]),c.push(m[r]));const o=_.map(r=>1/r**2),h=l.map(r=>1/r**2),f=(t,r)=>o.map((r,a)=>r*h[a]/(t**2*h[a]+r-2*t*c[a]*(r*h[a])**.5)),d=(r,a)=>{const e=f(r);return i.reduce((r,a,t)=>r+a*e[t],0)/e.reduce((r,a)=>r+a,0)},M=(r,a)=>{const e=f(r);return p.reduce((r,a,t)=>r+a*e[t],0)/e.reduce((r,a)=>r+a,0)};let[g,b,v,y,A]=[0,0,0,0,1e10];var q=linest(p,i);if(!q)return!1;[g,b,v,y]=[q[5][0],q[6][0],q[5][1],q[6][1]];let N=M(v)-v*d(v),w=0,L=1,j=1;for(;Math.abs(v-A)>=Math.abs(v*r/100);){A=v;const E=i.map((r,a)=>r-d(v,N)),J=p.map((r,a)=>r-M(v,N));var F=f(v,N).map((r,a)=>r**2*J[a]*(E[a]/h[a]+v*J[a]/o[a]-c[a]*(J[a]+v*E[a])/(o[a]*h[a])**.5)),P=f(v,N).map((r,a)=>r**2*E[a]*(E[a]/h[a]+v*J[a]/o[a]-c[a]*(J[a]+v*E[a])/(o[a]*h[a])**.5)),F=(v=F.reduce((r,a)=>r+a,0)/P.reduce((r,a)=>r+a,0),N=M(v,N)-v*d(v,N),E.map((r,a)=>r**2*f(v,N)[a]).reduce((r,a)=>r+a,0)),P=i.map((r,a)=>r**2*f(v,N)[a]).reduce((r,a)=>r+a,0);if(y=1/F**.5,b=(P/f(v,N).reduce((r,a)=>r+a,0))**.5*y,L=((e,u)=>{return f(e).reduce((r,a,t)=>r+a*(p[t]-e*i[t]-u)**2,0)})(v,N)/(s-2),j=1<L?L**.5:1,y*=j,b*=j,++w>=n)break}const S=i.map((r,a)=>N+v*r);var k,x,q=S.map((r,a)=>(r-p[a])**2),D=S.map((r,a)=>(r-S.reduce((r,a)=>r+a,0)/s)**2),q=q.reduce((r,a)=>r+a,0),D=D.reduce((r,a)=>r+a,0),q=D+q,D=0!==q?D/q:1/0,q=L*(s-2),W=1-jStat.chisquare.cdf(q,s-2),Y=100*arr_mean((k=v,x=N,f(k).map((r,a)=>(1/r)**.5/Math.abs(p[a]-k*i[a]-x))));return[N,b,v,y,L,Math.abs(v-A),w,j,D,q,W,Y]}function wtd3DRegression(W,Y,z,C,G,I,R,T,V,a=1,m=.001,hr=100){Number.isInteger(a)&&1<a&&(Y=Y.map(r=>r/a),C=C.map(r=>r/a),I=I.map(r=>r/a));var r=W.length;if(r<=3)return!1;let fr=0;const B=(t,e)=>W.map((r,a)=>1/(t**2*Y[a]**2+e**2*C[a]**2+I[a]**2+2*t*e*R[a]*Y[a]*C[a]-2*t*T[a]*Y[a]*I[a]-2*e*V[a]*C[a]*I[a])),H=(e,u)=>W.reduce((r,a,t)=>r+B(e,u)[t]*a,0)/arr_sum(B(e,u)),K=(e,u)=>z.reduce((r,a,t)=>r+B(e,u)[t]*a,0)/arr_sum(B(e,u)),dr=(e,u)=>G.reduce((r,a,t)=>r+B(e,u)[t]*a,0)/arr_sum(B(e,u));var Mr=(t,e,u)=>arr_sum(B(t,e).map((r,a)=>r*(t*W[a]+e*z[a]+u-G[a])**2));let[Q,U,,,,[,X,Z],[,$,rr]]=linest(G,W,z).slice(0,7),ar=1e10,tr=1,er=1e3;for(;Math.abs(X-ar)>=Math.abs(X*m/100);){ar=X;let t=W.map((r,a)=>r-H(X,Z)),e=z.map((r,a)=>r-K(X,Z)),u=G.map((r,a)=>r-dr(X,Z)),m=B(X,Z).map((r,a)=>r*((X*Y[a]**2+Z*R[a]*Y[a]*C[a]-T[a]*Y[a]*I[a])*(u[a]-Z*e[a])+(X*Z*R[a]*Y[a]*C[a]+Z**2*C[a]**2-X*T[a]*Y[a]*I[a]-2*Z*V[a]*C[a]*I[a]+I[a]**2)*t[a])),n=B(X,Z).map((r,a)=>r*((Z*C[a]**2+X*R[a]*Y[a]*C[a]-V[a]*C[a]*I[a])*(u[a]-X*t[a])+(X*Z*R[a]*Y[a]*C[a]+X**2*Y[a]**2-Z*V[a]*C[a]*I[a]-2*X*T[a]*Y[a]*I[a]+I[a]**2)*e[a]));var ur=arr_sum(arr_mul(B(X,Z),m,u))*arr_sum(arr_mul(B(X,Z),n,e))-arr_sum(arr_mul(B(X,Z),m,e))*arr_sum(arr_mul(B(X,Z),n,u)),mr=arr_sum(arr_mul(B(X,Z),m,t))*arr_sum(arr_mul(B(X,Z),n,e))-arr_sum(arr_mul(B(X,Z),m,e))*arr_sum(arr_mul(B(X,Z),n,t)),ur=ur/mr,nr=arr_sum(arr_mul(B(X,Z),n,u))*arr_sum(arr_mul(B(X,Z),m,t))-arr_sum(arr_mul(B(X,Z),m,u))*arr_sum(arr_mul(B(X,Z),n,t)),sr=arr_sum(arr_mul(B(X,Z),m,t))*arr_sum(arr_mul(B(X,Z),n,e))-arr_sum(arr_mul(B(X,Z),m,e))*arr_sum(arr_mul(B(X,Z),n,t)),nr=nr/sr;let s=arr_sum(arr_mul(B(X,Z),t))/arr_sum(B(X,Z)),i=arr_sum(arr_mul(B(X,Z),e))/arr_sum(B(X,Z)),_=arr_sum(arr_mul(B(X,Z),m))/arr_sum(B(X,Z)),p=arr_sum(arr_mul(B(X,Z),n))/arr_sum(B(X,Z)),l=arr_sum(arr_mul(B(X,Z),m,t)),c=arr_sum(arr_mul(B(X,Z),n,t)),o=arr_sum(arr_mul(B(X,Z),n,e)),h=arr_sum(arr_mul(B(X,Z),m,e)),f=arr_sum(arr_mul(B(X,Z),n,u)),d=arr_sum(arr_mul(B(X,Z),m,u)),M=B(X,Z).map((r,a)=>r*(X*Z*R[a]*Y[a]*C[a]+Z**2*C[a]**2-X*T[a]*Y[a]*I[a]-2*Z*V[a]*C[a]*I[a]+I[a]**2)),g=B(X,Z).map((r,a)=>-1*X*r*(Z*C[a]**2+X*R[a]*Y[a]*C[a]-V[a]*C[a]*I[a])),b=B(X,Z).map((r,a)=>-1*Z*r*(X*Y[a]**2+Z*R[a]*Y[a]*C[a]-T[a]*Y[a]*I[a])),v=B(X,Z).map((r,a)=>r*(X*Z*R[a]*Y[a]*C[a]+X**2*Y[a]**2-Z*V[a]*C[a]*I[a]-2*X*T[a]*Y[a]*I[a]+I[a]**2)),y=B(X,Z).map((r,a)=>r*(X*Y[a]**2+Z*R[a]*Y[a]*C[a]-T[a]*Y[a]*I[a])),A=B(X,Z).map((r,a)=>r*(Z*C[a]**2+X*R[a]*Y[a]*C[a]-V[a]*C[a]*I[a])),q=B(X,Z).map((r,a)=>1-r/arr_sum(B(X,Z))),N=B(X,Z).map((r,a)=>1-r/arr_sum(B(X,Z))),w=B(X,Z).map((r,a)=>1-r/arr_sum(B(X,Z))),L=B(X,Z).map((r,a)=>-1*r**2*(2*X*Y[a]**2+2*Z*R[a]*Y[a]*C[a]-2*T[a]*Y[a]*I[a])),j=B(X,Z).map((r,a)=>-1*r**2*(2*Z*C[a]**2+2*X*R[a]*Y[a]*C[a]-2*V[a]*C[a]*I[a])),F=B(X,Z).map((r,a)=>r*q[a]*(X*(l*e[a]*g[a]+o*(t[a]*M[a]+m[a])-c*e[a]*M[a]-h*(n[a]+t[a]*g[a]))-(d*e[a]*g[a]+o*u[a]*M[a])+(f*e[a]*M[a]+h*u[a]*g[a]))),P=B(X,Z).map((r,a)=>r*N[a]*(X*(l*(n[a]+e[a]*v[a])+o*t[a]*b[a]-c*(m[a]+e[a]*b[a])-h*t[a]*v[a])-(d*(n[a]+e[a]*v[a])+o*u[a]*b[a])+(f*(m[a]+e[a]*b[a])+h*u[a]*v[a]))),S=B(X,Z).map((r,a)=>r*w[a]*(X*(l*e[a]*A[a]+o*t[a]*y[a]-c*e[a]*y[a]-h*t[a]*A[a])-(d*e[a]*A[a]+o*(m[a]+u[a]*y[a]))+(f*e[a]*y[a]+h*(n[a]+u[a]*A[a]))));var ir=t.map((r,a)=>L[a]*m[a]*t[a]),_r=t.map((r,a)=>L[a]*n[a]*e[a]),pr=t.map((r,a)=>L[a]*n[a]*t[a]),lr=t.map((r,a)=>L[a]*m[a]*e[a]),cr=t.map((r,a)=>L[a]*m[a]*u[a]),or=t.map((r,a)=>L[a]*n[a]*u[a]),mr=mr+X*(arr_sum(ir)*o+arr_sum(_r)*l-arr_sum(pr)*h-arr_sum(lr)*c)-(arr_sum(cr)*o+arr_sum(_r)*d-arr_sum(or)*h-arr_sum(lr)*f);let k=B(X,Z).map((r,a)=>r*q[a]*(Z*(l*e[a]*g[a]+o*(m[a]+t[a]*M[a])-c*e[a]*M[a]-h*(n[a]+t[a]*g[a]))-(f*(m[a]+t[a]*M[a])+l*u[a]*g[a])+(d*(n[a]+t[a]*g[a])+c*u[a]*M[a]))),x=B(X,Z).map((r,a)=>r*N[a]*(Z*(l*(n[a]+e[a]*v[a])+o*t[a]*b[a]-c*(m[a]+e[a]*b[a])-h*t[a]*v[a])-(f*(t[a]*b[a])+l*(u[a]*v[a]))+(d*(t[a]*v[a])+c*(u[a]*b[a])))),D=B(X,Z).map((r,a)=>r*w[a]*(Z*(l*e[a]*A[a]+o*(t[a]*y[a])-c*e[a]*y[a]-h*(t[a]*A[a]))-(f*(t[a]*y[a])+l*(n[a]+u[a]*A[a]))+(d*(t[a]*A[a])+c*(m[a]+u[a]*y[a]))));var ir=t.map((r,a)=>j[a]*m[a]*t[a]),pr=t.map((r,a)=>j[a]*n[a]*e[a]),cr=t.map((r,a)=>j[a]*n[a]*t[a]),_r=t.map((r,a)=>j[a]*m[a]*e[a]),or=t.map((r,a)=>j[a]*m[a]*u[a]),lr=t.map((r,a)=>j[a]*n[a]*u[a]),sr=sr+Z*(arr_sum(ir)*o+arr_sum(pr)*l-arr_sum(cr)*h-arr_sum(_r)*c)-(arr_sum(lr)*l+arr_sum(ir)*f-arr_sum(or)*c-arr_sum(cr)*d),pr=arr_sum(t.map((r,a)=>F[a]**2*Y[a]**2+P[a]**2*C[a]**2+S[a]**2*I[a]**2+2*R[a]*Y[a]*C[a]*F[a]*P[a]+2*T[a]*Y[a]*I[a]*F[a]*S[a]+2*V[a]*C[a]*I[a]*P[a]*S[a])),_r=arr_sum(t.map((r,a)=>k[a]**2*Y[a]**2+x[a]**2*C[a]**2+D[a]**2*I[a]**2+2*R[a]*Y[a]*C[a]*k[a]*x[a]+2*T[a]*Y[a]*I[a]*k[a]*D[a]+2*V[a]*C[a]*I[a]*x[a]*D[a]));let E=B(X,Z).map((r,a)=>-1*X*r/arr_sum(B(X,Z))-F[a]*(2*_-2*s+H(X,Z))-k[a]*(2*p-2*i+K(X,Z))),J=B(X,Z).map((r,a)=>-1*Z*r/arr_sum(B(X,Z))-P[a]*(2*_-2*s+H(X,Z))-x[a]*(2*p-2*i+K(X,Z))),O=B(X,Z).map((r,a)=>r/arr_sum(B(X,Z))-S[a]*(2*_-2*s)-D[a]*(2*p-2*i));lr=arr_sum(E.map((r,a)=>E[a]**2*Y[a]**2+J[a]**2*C[a]**2+O[a]**2*I[a]**2+2*R[a]*Y[a]*C[a]*E[a]*J[a]+2*T[a]*Y[a]*I[a]*E[a]*O[a]+2*V[a]*C[a]*I[a]*J[a]*O[a]));if($=Math.sqrt(pr/mr),rr=Math.sqrt(_r/sr),U=Math.sqrt(lr),er=Mr(X,Z,Q)/(r-3),tr=1<er?Math.sqrt(er):1,$*=tr,rr*=tr,U*=tr,X=ur,Z=nr,Q=dr(ir=ur,or=nr)-ir*H(ir,or)-or*K(ir,or),++fr>=hr)break}const t=W.map((r,a)=>Q+X*r+Z*z[a]);var n,s,i,e=t.map((r,a)=>(r-G[a])**2),u=t.map((r,a)=>(r-arr_mean(t))**2),e=arr_sum(e),u=arr_sum(u),e=u+e,u=0!==e?u/e:np.inf,e=er*(r-3),_=1-jStat.chisquare.cdf(e,r-3),p=100*arr_mean((n=X,s=Z,i=Q,B(n,s).map((r,a)=>Math.sqrt(1/r)/Math.abs(n*W[a]+s*z[a]+i-G[a]))));return[Q,U,X,$,Z,rr,Mr(X,Z,Q),er,u,Math.abs(X-ar),fr,tr,e,_,p]}function calcAgeMin(r,a,t){var e=t.J,u=t.sJ,m=t.A,n=(t.sA,t.Ae),s=t.sAe,i=t.Ab,_=t.sAb,p=t.W,l=t.sW,c=t.Y,o=t.sY,h=t.f,f=t.No,d=t.sNo,M=t.L,g=(t.sL,t.Le,t.sLe,t.Lb,t.sLb,1e6*t.t),t=(t.st,h*f/((i+n)*p*c)),M=(Math.sqrt((t/h*0)**2+(t/f*d)**2+(t/(i+n))**2*(_**2+s**2)+(t/p*l)**2+(t/c*o)**2),(Math.exp(g*M)-1)/e),e=Math.sqrt((M/e)**2*u**2),u=r/M,r=Math.sqrt((a/M)**2+(r*e/M**2)**2),e=Math.sqrt((a/M)**2),a=Math.exp(g/t)-1,M=a*u+1,g=t*Math.log(M);let b=(Math.log(M)*t/h-t*a*u/(h*M))**2*0;h=(Math.log(M)*t/f)**2*d**2,f=(-1*Math.log(M)*t/m+a*u/(m*M))**2*_**2,d=(-1*Math.log(M)*t/m-i*a*u/(n**2*M))**2*s**2,_=(-1*Math.log(M)*t/p-t*a*u/(p*M))**2*l**2,m=(Math.log(M)*t/c)**2*o**2,i=(t*a/M)**2*r**2;let v=0;b=0,v=0;n=Math.sqrt((t*a*u/(u*M))**2*e**2);return[g/1e6,n/1e6,Math.sqrt((t*a*u/(u*M))**2*r**2)/1e6,Math.sqrt(b+h+f+d+_+m+i+0+v)/1e6]}function calcAgeGeneral(r,a,t,e,u,m){var n=Math.log(1+t*r)/u,a=a**2*(t/(u*(1+t*r)))**2,e=e**2*(r/(u*(1+t*r)))**2,m=m**2*(Math.log(1+t*r)/u**2)**2;return[n/1e6,Math.sqrt(a)/1e6,Math.sqrt(a+e)/1e6,Math.sqrt(a+e+m)/1e6]}function getLinePoints(a,t,e){if(!Array.isArray(e)||e.length<2)throw new Error("Coeffs should be an array with length at least 2.");var r=r=>e[0]+e[1]*r,u=r=>(r-e[0])/e[1]!=0?(r-e[0])/e[1]:null;const m=[];return[[a[0],r(a[0])],[a[1],r(a[1])],[u(t[0]),t[0]],[u(t[1]),t[1]]].forEach(r=>{a[0]<=r[0]&&r[0]<=a[1]&&t[0]<=r[1]&&r[1]<=t[1]&&m.push(r)}),m}function stepLinePoints(t,e){var r=t.length;return t=Array.from({length:r+1},(r,a)=>0===a?0:arr_sum(t.slice(0,a))),Array.from({length:2*r},(r,a)=>a%2==0?[t[a/2],e[a/2]]:[t[(a+1)/2],e[(a-1)/2]])}function ageSpectraPoints(r,a,t,e=null){var u=a.map((r,a)=>a%2==0?r-t[a]:r+t[a]),a=a.map((r,a)=>a%2==0?r+t[a]:r-t[a]),u=stepLinePoints(r,u);const m=stepLinePoints(r,a);e=e||r.map((r,a)=>a);a=u.map((r,a)=>[...r,m[a][1]]).filter((r,a)=>{a=Math.trunc(a/2);return a>=Math.min(...e)&&a<=Math.max(...e)});return a.splice(0,0,[a[0][0],a[0][2],a[0][1]]),a.push([a[a.length-1][0],a[a.length-1][2],a[a.length-1][1]]),a}function calcAr40r_39k(r,a,t,e,u,m,n,s,i,_){n=n-i-t*r;return[n/u,errDiv(n,errAdd(s,_,errMul(t,e,r,a)),u,m)]}function weightedMeanValue(r,a,t=!0){const e=a.map(r=>1/r**2),u=arr_sum(e);var a=r.length-1,m=r.length;const n=arr_sum(r.map((r,a)=>r*e[a]/u));var r=arr_sum(r.map((r,a)=>(r-n)**2*e[a])),s=r/a,t=t?Math.sqrt(s/u):Math.sqrt(1/u),a=1-jStat.chisquare.cdf(r,a);return[n,t,m,s,r,a]}