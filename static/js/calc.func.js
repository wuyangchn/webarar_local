function arr_sum(r){return Array.isArray(r)?r.reduce((r,a)=>r+a,0):(console.error("array is not an array"),r)}function arr_sub(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>0===t?a:r-a,0))}function arr_add(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>r+a,0))}function arr_div(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>0===t?a:r/a,1))}function arr_mul(...r){return numeric.transpose(r).map(r=>r.reduce((r,a,t)=>0===t?a:r*a,1))}function arr_pow(r,a){return r.map(r=>Array.isArray(r)?arr_pow(r,a):Math.pow(r,a))}function arr_multiply_by_number(r,a){return Array.isArray(r)?r.map(r=>arr_multiply_by_number(r,a)):r*a}function arr_mean(r){return 0===r.length?NaN:arr_sum(r)/r.length}function arr_diag(r){return r.map((r,a)=>r[a])}function arr_slice(r,t,e=0,u=!0){let a=[];return 0<(a=0<t.length?numeric.transpose(r).filter((a,r)=>{if(!t.includes(r-e))return!1;if(u)for(let r=0;r<a.length;r++)if("string"==typeof a[r]||a[r]instanceof String)return!1;return!0}):a).length?numeric.transpose(a):[[],[],[],[],[],[],[],[],[],[],[],[]]}function dict_update(r,a={}){for(var[t,e]of Object.entries(a))e.constructor===Object?dict_update(r[t],e):r[t]=e;return r}function errAdd(...r){return Math.sqrt(r.reduce((r,a)=>r+a**2,0))}function errMul(r,a,t,e){return Math.sqrt(t**2*a**2+r**2*e**2)}function errDiv(r,a,t,e){return Math.sqrt(1/t**2*a**2+r**2*e**2/t**4)}function linest(e,u,...n){const r=[];for(let t=0;t<e.length;t++){let a=null!==e[t]&&null!==u[t];for(let r=0;r<n.length;r++)a=a&&null!==n[r][t];a&&r.push(t)}e=r.map(r=>e[r]),u=r.map(r=>u[r]),n=n.map(a=>r.map(r=>a[r]));let a;if(0===(a=0===n.length?numeric.transpose([[...Array(u.length).fill(1)],u]):numeric.transpose([[...Array(u.length).fill(1)],u,...n])).length)return!1;var t=a.length,m=a[0].length,s=numeric.transpose([e]);let i;try{i=numeric.inv(numeric.dot(numeric.transpose(a),a))}catch(r){throw new Error("The determinant of the given matrix must not be zero")}console.log(a),console.log(s),console.log(i);s=numeric.dot(i,numeric.dot(numeric.transpose(a),s));const l=numeric.dot(a,s);var _=arr_pow(arr_sub(numeric.transpose(l)[0],e),2),p=arr_pow(l.map(r=>r-arr_mean(numeric.transpose(l)[0])),2),_=arr_sum(_),p=arr_sum(p),o=p+_,_=_/(t-m),t=arr_pow(arr_multiply_by_number(arr_diag(i),_),.5);const c=numeric.transpose(s)[0];m=arr_div(t,c);return[c[0],t[0],100*m[0],0!==o?p/o:1/0,_,c,t,function(...r){const a=[[...Array(r[0].length).fill(1)],...r];return a[0].map((r,t)=>arr_sum(a.map((r,a)=>r[t]*c[a])))},_]}function york2(a,t,e,u,n,O=0,r=.001,m=100){const s=a.length;if(s<3)return!1;let i=[],l=[],_=[],p=[],o=[];for(let r=0;r<s;r++)isFinite(a[r])&&!isNaN(a[r])&&isFinite(t[r])&&!isNaN(t[r])&&isFinite(e[r])&&!isNaN(e[r])&&isFinite(u[r])&&!isNaN(u[r])&&isFinite(n[r])&&!isNaN(n[r])&&(i.push(a[r]),l.push(t[r]),_.push(e[r]),p.push(u[r]),o.push(n[r]));const c=l.map(r=>1/r**2),h=p.map(r=>1/r**2),f=(t,r)=>c.map((r,a)=>r*h[a]/(t**2*h[a]+r-2*t*o[a]*(r*h[a])**.5)),g=(r,a)=>{const e=f(r);return i.reduce((r,a,t)=>r+a*e[t],0)/e.reduce((r,a)=>r+a,0)},d=(r,a)=>{const e=f(r);return _.reduce((r,a,t)=>r+a*e[t],0)/e.reduce((r,a)=>r+a,0)};let[M,b,v,y,A]=[0,0,0,0,1e10];var q=linest(_,i);if(!q)return!1;[M,b,v,y]=[q[5][0],q[6][0],q[5][1],q[6][1]];let N=d(v)-v*g(v),w=0,L=1,j=1;for(;Math.abs(v-A)>=Math.abs(v*r/100);){A=v;const E=i.map((r,a)=>r-g(v,N)),J=_.map((r,a)=>r-d(v,N));var F=f(v,N).map((r,a)=>r**2*J[a]*(E[a]/h[a]+v*J[a]/c[a]-o[a]*(J[a]+v*E[a])/(c[a]*h[a])**.5)),P=f(v,N).map((r,a)=>r**2*E[a]*(E[a]/h[a]+v*J[a]/c[a]-o[a]*(J[a]+v*E[a])/(c[a]*h[a])**.5)),F=(v=F.reduce((r,a)=>r+a,0)/P.reduce((r,a)=>r+a,0),N=d(v,N)-v*g(v,N),E.map((r,a)=>r**2*f(v,N)[a]).reduce((r,a)=>r+a,0)),P=i.map((r,a)=>r**2*f(v,N)[a]).reduce((r,a)=>r+a,0);if(y=1/F**.5,b=(P/f(v,N).reduce((r,a)=>r+a,0))**.5*y,L=((e,u)=>{return f(e).reduce((r,a,t)=>r+a*(_[t]-e*i[t]-u)**2,0)})(v,N)/(s-2),j=1<L?L**.5:1,y*=j,b*=j,++w>=m)break}const S=i.map((r,a)=>N+v*r);var k,x,q=S.map((r,a)=>(r-_[a])**2),D=S.map((r,a)=>(r-S.reduce((r,a)=>r+a,0)/s)**2),q=q.reduce((r,a)=>r+a,0),D=D.reduce((r,a)=>r+a,0),q=D+q,D=0!==q?D/q:1/0,q=L*(s-2),W=1-jStat.chisquare.cdf(q,s-2),Y=100*arr_mean((k=v,x=N,f(k).map((r,a)=>(1/r)**.5/Math.abs(_[a]-k*i[a]-x))));return[N,b,v,y,L,Math.abs(v-A),w,j,D,q,W,Y]}function wtd3DRegression(W,Y,z,C,G,I,R,T,V,a=1,n=.001,hr=100){Number.isInteger(a)&&1<a&&(Y=Y.map(r=>r/a),C=C.map(r=>r/a),I=I.map(r=>r/a));var r=W.length;if(r<=3)return!1;let fr=0;const B=(t,e)=>W.map((r,a)=>1/(t**2*Y[a]**2+e**2*C[a]**2+I[a]**2+2*t*e*R[a]*Y[a]*C[a]-2*t*T[a]*Y[a]*I[a]-2*e*V[a]*C[a]*I[a])),H=(e,u)=>W.reduce((r,a,t)=>r+B(e,u)[t]*a,0)/arr_sum(B(e,u)),K=(e,u)=>z.reduce((r,a,t)=>r+B(e,u)[t]*a,0)/arr_sum(B(e,u)),gr=(e,u)=>G.reduce((r,a,t)=>r+B(e,u)[t]*a,0)/arr_sum(B(e,u));var dr=(t,e,u)=>arr_sum(B(t,e).map((r,a)=>r*(t*W[a]+e*z[a]+u-G[a])**2));let[Q,U,,,,[,X,Z],[,$,rr]]=linest(G,W,z).slice(0,7),ar=1e10,tr=1,er=1e3;for(;Math.abs(X-ar)>=Math.abs(X*n/100);){ar=X;let t=W.map((r,a)=>r-H(X,Z)),e=z.map((r,a)=>r-K(X,Z)),u=G.map((r,a)=>r-gr(X,Z)),n=B(X,Z).map((r,a)=>r*((X*Y[a]**2+Z*R[a]*Y[a]*C[a]-T[a]*Y[a]*I[a])*(u[a]-Z*e[a])+(X*Z*R[a]*Y[a]*C[a]+Z**2*C[a]**2-X*T[a]*Y[a]*I[a]-2*Z*V[a]*C[a]*I[a]+I[a]**2)*t[a])),m=B(X,Z).map((r,a)=>r*((Z*C[a]**2+X*R[a]*Y[a]*C[a]-V[a]*C[a]*I[a])*(u[a]-X*t[a])+(X*Z*R[a]*Y[a]*C[a]+X**2*Y[a]**2-Z*V[a]*C[a]*I[a]-2*X*T[a]*Y[a]*I[a]+I[a]**2)*e[a]));var ur=arr_sum(arr_mul(B(X,Z),n,u))*arr_sum(arr_mul(B(X,Z),m,e))-arr_sum(arr_mul(B(X,Z),n,e))*arr_sum(arr_mul(B(X,Z),m,u)),nr=arr_sum(arr_mul(B(X,Z),n,t))*arr_sum(arr_mul(B(X,Z),m,e))-arr_sum(arr_mul(B(X,Z),n,e))*arr_sum(arr_mul(B(X,Z),m,t)),ur=ur/nr,mr=arr_sum(arr_mul(B(X,Z),m,u))*arr_sum(arr_mul(B(X,Z),n,t))-arr_sum(arr_mul(B(X,Z),n,u))*arr_sum(arr_mul(B(X,Z),m,t)),sr=arr_sum(arr_mul(B(X,Z),n,t))*arr_sum(arr_mul(B(X,Z),m,e))-arr_sum(arr_mul(B(X,Z),n,e))*arr_sum(arr_mul(B(X,Z),m,t)),mr=mr/sr;let s=arr_sum(arr_mul(B(X,Z),t))/arr_sum(B(X,Z)),i=arr_sum(arr_mul(B(X,Z),e))/arr_sum(B(X,Z)),l=arr_sum(arr_mul(B(X,Z),n))/arr_sum(B(X,Z)),_=arr_sum(arr_mul(B(X,Z),m))/arr_sum(B(X,Z)),p=arr_sum(arr_mul(B(X,Z),n,t)),o=arr_sum(arr_mul(B(X,Z),m,t)),c=arr_sum(arr_mul(B(X,Z),m,e)),h=arr_sum(arr_mul(B(X,Z),n,e)),f=arr_sum(arr_mul(B(X,Z),m,u)),g=arr_sum(arr_mul(B(X,Z),n,u)),d=B(X,Z).map((r,a)=>r*(X*Z*R[a]*Y[a]*C[a]+Z**2*C[a]**2-X*T[a]*Y[a]*I[a]-2*Z*V[a]*C[a]*I[a]+I[a]**2)),M=B(X,Z).map((r,a)=>-1*X*r*(Z*C[a]**2+X*R[a]*Y[a]*C[a]-V[a]*C[a]*I[a])),b=B(X,Z).map((r,a)=>-1*Z*r*(X*Y[a]**2+Z*R[a]*Y[a]*C[a]-T[a]*Y[a]*I[a])),v=B(X,Z).map((r,a)=>r*(X*Z*R[a]*Y[a]*C[a]+X**2*Y[a]**2-Z*V[a]*C[a]*I[a]-2*X*T[a]*Y[a]*I[a]+I[a]**2)),y=B(X,Z).map((r,a)=>r*(X*Y[a]**2+Z*R[a]*Y[a]*C[a]-T[a]*Y[a]*I[a])),A=B(X,Z).map((r,a)=>r*(Z*C[a]**2+X*R[a]*Y[a]*C[a]-V[a]*C[a]*I[a])),q=B(X,Z).map((r,a)=>1-r/arr_sum(B(X,Z))),N=B(X,Z).map((r,a)=>1-r/arr_sum(B(X,Z))),w=B(X,Z).map((r,a)=>1-r/arr_sum(B(X,Z))),L=B(X,Z).map((r,a)=>-1*r**2*(2*X*Y[a]**2+2*Z*R[a]*Y[a]*C[a]-2*T[a]*Y[a]*I[a])),j=B(X,Z).map((r,a)=>-1*r**2*(2*Z*C[a]**2+2*X*R[a]*Y[a]*C[a]-2*V[a]*C[a]*I[a])),F=B(X,Z).map((r,a)=>r*q[a]*(X*(p*e[a]*M[a]+c*(t[a]*d[a]+n[a])-o*e[a]*d[a]-h*(m[a]+t[a]*M[a]))-(g*e[a]*M[a]+c*u[a]*d[a])+(f*e[a]*d[a]+h*u[a]*M[a]))),P=B(X,Z).map((r,a)=>r*N[a]*(X*(p*(m[a]+e[a]*v[a])+c*t[a]*b[a]-o*(n[a]+e[a]*b[a])-h*t[a]*v[a])-(g*(m[a]+e[a]*v[a])+c*u[a]*b[a])+(f*(n[a]+e[a]*b[a])+h*u[a]*v[a]))),S=B(X,Z).map((r,a)=>r*w[a]*(X*(p*e[a]*A[a]+c*t[a]*y[a]-o*e[a]*y[a]-h*t[a]*A[a])-(g*e[a]*A[a]+c*(n[a]+u[a]*y[a]))+(f*e[a]*y[a]+h*(m[a]+u[a]*A[a]))));var ir=t.map((r,a)=>L[a]*n[a]*t[a]),lr=t.map((r,a)=>L[a]*m[a]*e[a]),_r=t.map((r,a)=>L[a]*m[a]*t[a]),pr=t.map((r,a)=>L[a]*n[a]*e[a]),or=t.map((r,a)=>L[a]*n[a]*u[a]),cr=t.map((r,a)=>L[a]*m[a]*u[a]),nr=nr+X*(arr_sum(ir)*c+arr_sum(lr)*p-arr_sum(_r)*h-arr_sum(pr)*o)-(arr_sum(or)*c+arr_sum(lr)*g-arr_sum(cr)*h-arr_sum(pr)*f);let k=B(X,Z).map((r,a)=>r*q[a]*(Z*(p*e[a]*M[a]+c*(n[a]+t[a]*d[a])-o*e[a]*d[a]-h*(m[a]+t[a]*M[a]))-(f*(n[a]+t[a]*d[a])+p*u[a]*M[a])+(g*(m[a]+t[a]*M[a])+o*u[a]*d[a]))),x=B(X,Z).map((r,a)=>r*N[a]*(Z*(p*(m[a]+e[a]*v[a])+c*t[a]*b[a]-o*(n[a]+e[a]*b[a])-h*t[a]*v[a])-(f*(t[a]*b[a])+p*(u[a]*v[a]))+(g*(t[a]*v[a])+o*(u[a]*b[a])))),D=B(X,Z).map((r,a)=>r*w[a]*(Z*(p*e[a]*A[a]+c*(t[a]*y[a])-o*e[a]*y[a]-h*(t[a]*A[a]))-(f*(t[a]*y[a])+p*(m[a]+u[a]*A[a]))+(g*(t[a]*A[a])+o*(n[a]+u[a]*y[a]))));var ir=t.map((r,a)=>j[a]*n[a]*t[a]),_r=t.map((r,a)=>j[a]*m[a]*e[a]),or=t.map((r,a)=>j[a]*m[a]*t[a]),lr=t.map((r,a)=>j[a]*n[a]*e[a]),cr=t.map((r,a)=>j[a]*n[a]*u[a]),pr=t.map((r,a)=>j[a]*m[a]*u[a]),sr=sr+Z*(arr_sum(ir)*c+arr_sum(_r)*p-arr_sum(or)*h-arr_sum(lr)*o)-(arr_sum(pr)*p+arr_sum(ir)*f-arr_sum(cr)*o-arr_sum(or)*g),_r=arr_sum(t.map((r,a)=>F[a]**2*Y[a]**2+P[a]**2*C[a]**2+S[a]**2*I[a]**2+2*R[a]*Y[a]*C[a]*F[a]*P[a]+2*T[a]*Y[a]*I[a]*F[a]*S[a]+2*V[a]*C[a]*I[a]*P[a]*S[a])),lr=arr_sum(t.map((r,a)=>k[a]**2*Y[a]**2+x[a]**2*C[a]**2+D[a]**2*I[a]**2+2*R[a]*Y[a]*C[a]*k[a]*x[a]+2*T[a]*Y[a]*I[a]*k[a]*D[a]+2*V[a]*C[a]*I[a]*x[a]*D[a]));let E=B(X,Z).map((r,a)=>-1*X*r/arr_sum(B(X,Z))-F[a]*(2*l-2*s+H(X,Z))-k[a]*(2*_-2*i+K(X,Z))),J=B(X,Z).map((r,a)=>-1*Z*r/arr_sum(B(X,Z))-P[a]*(2*l-2*s+H(X,Z))-x[a]*(2*_-2*i+K(X,Z))),O=B(X,Z).map((r,a)=>r/arr_sum(B(X,Z))-S[a]*(2*l-2*s)-D[a]*(2*_-2*i));pr=arr_sum(E.map((r,a)=>E[a]**2*Y[a]**2+J[a]**2*C[a]**2+O[a]**2*I[a]**2+2*R[a]*Y[a]*C[a]*E[a]*J[a]+2*T[a]*Y[a]*I[a]*E[a]*O[a]+2*V[a]*C[a]*I[a]*J[a]*O[a]));if($=Math.sqrt(_r/nr),rr=Math.sqrt(lr/sr),U=Math.sqrt(pr),er=dr(X,Z,Q)/(r-3),tr=1<er?Math.sqrt(er):1,$*=tr,rr*=tr,U*=tr,X=ur,Z=mr,Q=gr(ir=ur,cr=mr)-ir*H(ir,cr)-cr*K(ir,cr),++fr>=hr)break}const t=W.map((r,a)=>Q+X*r+Z*z[a]);var m,s,i,e=t.map((r,a)=>(r-G[a])**2),u=t.map((r,a)=>(r-arr_mean(t))**2),e=arr_sum(e),u=arr_sum(u),e=u+e,u=0!==e?u/e:np.inf,e=er*(r-3),l=1-jStat.chisquare.cdf(e,r-3),_=100*arr_mean((m=X,s=Z,i=Q,B(m,s).map((r,a)=>Math.sqrt(1/r)/Math.abs(m*W[a]+s*z[a]+i-G[a]))));return[Q,U,X,$,Z,rr,dr(X,Z,Q),er,u,Math.abs(X-ar),fr,tr,e,l,_]}function calcAgeMin(r,a,t){var e=t.J,u=t.sJ,n=t.A,m=(t.sA,t.Ae),s=t.sAe,i=t.Ab,l=t.sAb,_=t.W,p=t.sW,o=t.Y,c=t.sY,h=t.f,f=t.No,g=t.sNo,d=t.L,M=(t.sL,t.Le,t.sLe,t.Lb,t.sLb,1e6*t.t),t=(t.st,h*f/((i+m)*_*o)),d=(Math.sqrt((t/h*0)**2+(t/f*g)**2+(t/(i+m))**2*(l**2+s**2)+(t/_*p)**2+(t/o*c)**2),(Math.exp(M*d)-1)/e),e=Math.sqrt((d/e)**2*u**2),u=r/d,r=Math.sqrt((a/d)**2+(r*e/d**2)**2),e=Math.sqrt((a/d)**2),a=Math.exp(M/t)-1,d=a*u+1,M=t*Math.log(d);let b=(Math.log(d)*t/h-t*a*u/(h*d))**2*0;h=(Math.log(d)*t/f)**2*g**2,f=(-1*Math.log(d)*t/n+a*u/(n*d))**2*l**2,g=(-1*Math.log(d)*t/n-i*a*u/(m**2*d))**2*s**2,l=(-1*Math.log(d)*t/_-t*a*u/(_*d))**2*p**2,n=(Math.log(d)*t/o)**2*c**2,i=(t*a/d)**2*r**2;let v=0;b=0,v=0;m=Math.sqrt((t*a*u/(u*d))**2*e**2);return[M,m,Math.sqrt((t*a*u/(u*d))**2*r**2),Math.sqrt(b+h+f+g+l+n+i+0+v)]}function calcAgeGeneral(r,a,t,e,u,n){var m=Math.log(1+t*r)/u,a=a**2*(t/(u*(1+t*r)))**2,e=e**2*(r/(u*(1+t*r)))**2,n=n**2*(Math.log(1+t*r)/u**2)**2;return[m,Math.sqrt(a),Math.sqrt(a+e),Math.sqrt(a+e+n)]}function getLinePoints(a,t,e){if(!Array.isArray(e)||e.length<2)throw new Error("Coeffs should be an array with length at least 2.");var r=r=>e[0]+e[1]*r,u=r=>(r-e[0])/e[1]!=0?(r-e[0])/e[1]:null;const n=[];return[[a[0],r(a[0])],[a[1],r(a[1])],[u(t[0]),t[0]],[u(t[1]),t[1]]].forEach(r=>{a[0]<=r[0]&&r[0]<=a[1]&&t[0]<=r[1]&&r[1]<=t[1]&&n.push(r)}),n}function stepLinePoints(t,e){var r=t.length;return t=Array.from({length:r+1},(r,a)=>0===a?0:arr_sum(t.slice(0,a))),Array.from({length:2*r},(r,a)=>a%2==0?[t[a/2],e[a/2]]:[t[(a+1)/2],e[(a-1)/2]])}function ageSpectraPoints(r,a,t,e=null){var u=a.map((r,a)=>a%2==0?r-t[a]:r+t[a]),a=a.map((r,a)=>a%2==0?r+t[a]:r-t[a]),u=stepLinePoints(r,u);const n=stepLinePoints(r,a);e=e||r.map((r,a)=>a);a=u.map((r,a)=>[...r,n[a][1]]).filter((r,a)=>{a=Math.trunc(a/2);return a>=Math.min(...e)&&a<=Math.max(...e)});return a.splice(0,0,[a[0][0],a[0][2],a[0][1]]),a.push([a[a.length-1][0],a[a.length-1][2],a[a.length-1][1]]),a}function calcAr40r_39k(r,a,t,e,u,n,m,s,i,l){m=m-i-t*r;return[m/u,errDiv(m,errAdd(s,l,errMul(t,e,r,a)),u,n)]}function weightedMeanValue(r,a,t=!0){const e=a.map(r=>1/r**2),u=arr_sum(e);var a=r.length-1,n=r.length;const m=arr_sum(r.map((r,a)=>r*e[a]/u));var r=arr_sum(r.map((r,a)=>(r-m)**2*e[a])),s=r/a,t=t?Math.sqrt(s/u):Math.sqrt(1/u),a=1-jStat.chisquare.cdf(r,a);return[m,t,n,s,r,a]}